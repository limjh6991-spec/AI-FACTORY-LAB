{
  "router": {
    "path": "src/server/api/routers/screen982157.ts",
    "code": "import { z } from \"zod\";\nimport { createTRPCRouter, publicProcedure } from \"~/server/api/trpc\";\n\nexport const screen982157Router = createTRPCRouter {\n  getData: publicProcedure\n    .input(\n      z.object({\n        yearMonth: z.string().min(6, \"기준년월을 입력해주세요 (YYYYMM)\"),\n        site: z.string().optional(),\n      }),\n    )\n    .query(async ({ ctx, input }) => {\n      const sql = `\n        SELECT \n            CASE \n                WHEN a.acct_name IS NOT NULL THEN a.acct_name\n                ELSE '합계'\n            END AS \"구분_부서별\",\n            COALESCE(SUM(ae.acct_amt), 0) AS \"계획\",\n            COALESCE(SUM(ae.acct_amt), 0) AS \"합계\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '전사' THEN ae.acct_amt ELSE 0 END), 0) AS \"전사\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '장애인운동선수' THEN ae.acct_amt ELSE 0 END), 0) AS \"장애인운동선수\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '판매공통' THEN ae.acct_amt ELSE 0 END), 0) AS \"판매공통\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '경영지원실' THEN ae.acct_amt ELSE 0 END), 0) AS \"경영지원실\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '지원팀' THEN ae.acct_amt ELSE 0 END), 0) AS \"지원팀\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '자금그룹' THEN ae.acct_amt ELSE 0 END), 0) AS \"자금그룹\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '회계그룹' THEN ae.acct_amt ELSE 0 END), 0) AS \"회계그룹\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '인사총무그룹' THEN ae.acct_amt ELSE 0 END), 0) AS \"인사총무그룹\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '시스템지원그룹' THEN ae.acct_amt ELSE 0 END), 0) AS \"시스템지원그룹\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '구매그룹' THEN ae.acct_amt ELSE 0 END), 0) AS \"구매그룹\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '전략팀' THEN ae.acct_amt ELSE 0 END), 0) AS \"전략팀\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '도우VINA' THEN ae.acct_amt ELSE 0 END), 0) AS \"도우VINA\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '개발실' THEN ae.acct_amt ELSE 0 END), 0) AS \"개발실\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '연구팀' THEN ae.acct_amt ELSE 0 END), 0) AS \"연구팀\",\n            COALESCE(SUM(CASE WHEN d.dept_name = 'HTG개발그룹' THEN ae.acct_amt ELSE 0 END), 0) AS \"HTG개발그룹\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '선행연구그룹' THEN ae.acct_amt ELSE 0 END), 0) AS \"선행연구그룹\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '개발팀' THEN ae.acct_amt ELSE 0 END), 0) AS \"개발팀\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '공정개발그룹' THEN ae.acct_amt ELSE 0 END), 0) AS \"공정개발그룹\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '제품개발그룹' THEN ae.acct_amt ELSE 0 END), 0) AS \"제품개발그룹\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '설비개발팀' THEN ae.acct_amt ELSE 0 END), 0) AS \"설비개발팀\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '설계그룹' THEN ae.acct_amt ELSE 0 END), 0) AS \"설계그룹\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '제어그룹' THEN ae.acct_amt ELSE 0 END), 0) AS \"제어그룹\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '사업기획그룹' THEN ae.acct_amt ELSE 0 END), 0) AS \"사업기획그룹\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '마케팅그룹' THEN ae.acct_amt ELSE 0 END), 0) AS \"마케팅그룹\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '기술기획그룹' THEN ae.acct_amt ELSE 0 END), 0) AS \"기술기획그룹\",\n            COALESCE(SUM(CASE WHEN d.dept_name = '지원그룹' THEN ae.acct_amt ELSE 0 END), 0) AS \"지원그룹\"\n        FROM doi_acct_expen ae\n        LEFT JOIN doi_acct a ON ae.yyyymm = a.yyyymm \n            AND ae.acct = a.acct \n            AND ae.site = a.site\n            AND a.계정대분류 = '판매관리비'\n        LEFT JOIN doi_dept d ON ae.yyyymm = d.yyyymm \n            AND ae.dept = d.dept \n            AND ae.site = d.site\n        WHERE ae.yyyymm = $1\n            AND ($2::text IS NULL OR ae.site = $2)\n            AND a.계정대분류 = '판매관리비'\n        GROUP BY ROLLUP(a.acct_name)\n        ORDER BY CASE WHEN a.acct_name IS NULL THEN 1 ELSE 0 END, a.acct_name\n      `;\n\n      const result = await ctx.db.$queryRawUnsafe(\n        sql,\n        input.yearMonth,\n        input.site || null\n      );\n\n      // 컬럼명을 그리드 필드명으로 매핑\n      const mappedData = (result as any[]).map((row) => ({\n        col_0: row['구분_부서별'],\n        col_1: Number(row['계획'] || 0),\n        col_2: Number(row['합계'] || 0),\n        col_3: Number(row['전사'] || 0),\n        col_4: Number(row['장애인운동선수'] || 0),\n        col_5: Number(row['판매공통'] || 0),\n        col_6: Number(row['경영지원실'] || 0),\n        col_7: Number(row['지원팀'] || 0),\n        col_8: Number(row['자금그룹'] || 0),\n        col_9: Number(row['회계그룹'] || 0),\n        col_10: Number(row['인사총무그룹'] || 0),\n        col_11: Number(row['시스템지원그룹'] || 0),\n        col_12: Number(row['구매그룹'] || 0),\n        col_13: Number(row['전략팀'] || 0),\n        col_14: Number(row['도우VINA'] || 0),\n        col_15: Number(row['개발실'] || 0),\n        col_16: Number(row['연구팀'] || 0),\n        col_17: Number(row['HTG개발그룹'] || 0),\n        col_18: Number(row['선행연구그룹'] || 0),\n        col_19: Number(row['개발팀'] || 0),\n        col_20: Number(row['공정개발그룹'] || 0),\n        col_21: Number(row['제품개발그룹'] || 0),\n        col_22: Number(row['설비개발팀'] || 0),\n        col_23: Number(row['설계그룹'] || 0),\n        col_24: Number(row['제어그룹'] || 0),\n        col_25: Number(row['사업기획그룹'] || 0),\n        col_26: Number(row['마케팅그룹'] || 0),\n        col_27: Number(row['기술기획그룹'] || 0),\n        col_28: Number(row['지원그룹'] || 0),\n      }));\n\n      return {\n        data: mappedData,\n        total: mappedData.length,\n      };\n    }),\n});"
  },
  "pageModifications": {
    "path": "src/app/screens/sc982157/page.tsx",
    "imports": "import { api } from '~/trpc/react';",
    "hooks": "  // tRPC 쿼리 hook\n  const { data, isLoading, refetch } = api.screen982157.getData.useQuery(\n    {\n      yearMonth,\n      site: site === 'all' ? undefined : site,\n    },\n    {\n      enabled: false, // 수동 실행\n    }\n  );",
    "handleSearch": "  const handleSearch = async () => {\n    if (!yearMonth) {\n      alert('기준년월을 입력해주세요.');\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const result = await refetch();\n      if (result.data) {\n        setRowData(result.data.data);\n      }\n    } catch (error) {\n      console.error('데이터 조회 중 오류:', error);\n      alert('데이터 조회 중 오류가 발생했습니다.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // loading 상태를 tRPC isLoading과 동기화\n  useEffect(() => {\n    setLoading(isLoading);\n  }, [isLoading]);"
  },
  "rootModification": {
    "import": "import { screen982157Router } from \"./routers/screen982157\";",
    "router": "screen982157: screen982157Router,"
  }
}