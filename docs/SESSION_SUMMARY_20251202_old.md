# 작업 세션 요약 - 2025년 12월 2일

## 📋 작업 개요
- **작업 일자**: 2025년 12월 2일
- **주요 목표**: Excel 기반 화면 자동 생성 시스템 기술적 타당성 분석
- **작업 시간**: 약 1시간

---

## 🎯 프로젝트 방향 전환

### 새로운 비전
**"Excel 장표 → 즉시 화면 생성"**

기존: Vue/Spring Boot AI 생성기  
→ 새 방향: **Excel 파일 업로드 → 자동 화면 생성 시스템**

### 제안된 워크플로우
```
1. 사용자가 업무에서 사용하는 Excel 파일 업로드
   ↓
2. 시스템이 Excel 분석 (테이블, 컬럼, 로직 파악)
   ↓
3. Excel 표 서식으로 그리드 자동 구성 (차트 포함)
   ↓
4. 선택 옵션 처리 (미정)
   ↓
5. 임시 메뉴에 화면 생성
   ↓
6. 사용자가 메뉴 관리 화면에서 정식 메뉴로 등록
```

---

## ✅ 완료된 작업

### 1. 기술적 분석 문서 작성
**파일**: `docs/EXCEL_TO_SCREEN_TECHNICAL_ANALYSIS.md` (500+ lines)

#### 주요 내용
1. **비판적 분석 - 6개 단계별 문제점**
   - 1단계: Excel 파일 분석 (비정형 데이터 구조)
   - 2단계: DB 분석 (역공학의 한계)
   - 3단계: 그리드 구성 (표 서식 변환)
   - 4단계: 선택 옵션 (의사결정 필요)
   - 5-6단계: 메뉴 등록 (기술적으로 가능)

2. **근본적인 문제점**
   - Excel ≠ Database (패러다임 차이)
   - 정보 손실 문제 (의미 파악 불가)
   - 일관성 문제 (사용자마다 다른 형식)

3. **현실적인 해결 방안 3가지**
   - 방안 1: 템플릿 기반 (추천) ⭐⭐☆☆☆
   - 방안 2: AI 기반 스마트 파싱 ⭐⭐⭐⭐☆
   - 방안 3: 하이브리드 (추천) ⭐⭐⭐☆☆

4. **기술 스택 제안**
   - Excel 파싱: SheetJS (XLSX.js)
   - DB 분석: Prisma Introspection
   - AI 통합: Google Gemini 2.0 Flash
   - 차트 생성: Recharts

5. **단계적 접근 전략 (MVP → 고도화)**
   - Phase 1: 템플릿 기반 (2주) - 위험도 낮음
   - Phase 2: DB 자동 매핑 (2주) - 위험도 중간
   - Phase 3: AI 보조 (3주) - 위험도 높음
   - Phase 4: 차트 지원 (2주) - 위험도 중간

---

## 🔴 발견된 주요 문제점

### 문제 1: 비정형 Excel 구조
**증상:**
```excel
실제 원가 장표:
┌─────────────────────────────┐
│  2025년 11월 공정별 원가     │  ← 병합된 타이틀
├────────┬────────┬────────┤
│        │ 자재비  │ 인건비  │  ← 2단계 헤더
│ 공정명  ├───┬───┼───┬───┤
│        │계획│실적│계획│실적│  ← 3단계 헤더
```

**문제:**
- ❌ 병합 셀의 의미 파악 불가능
- ❌ 다중 헤더 구조 자동 변환 어려움
- ❌ 수식 포함 시 비즈니스 로직 추론 불가

### 문제 2: DB 역공학의 한계
**증상:**
```javascript
Excel: "공정명" 컬럼
↓
DB: 어느 테이블? 어느 컬럼?
- process_master.process_name?
- cost_process.proc_nm?
- production_line.line_name?
```

**문제:**
- ❌ 한글명 → 영문 테이블/컬럼 매핑 불가
- ❌ JOIN 조건 자동 생성 불가 (FK 없는 경우)
- ❌ 레거시 DB는 네이밍이 암호 같음

### 문제 3: Excel 수식 변환
**증상:**
```excel
Excel: =IF(B2>1000, B2*0.9, B2*0.95)
↓
SQL? JavaScript? 어디에 둘까?
```

**문제:**
- ❌ 100% 정확도로 변환 불가
- ❌ VLOOKUP, INDEX, MATCH 같은 복잡한 수식
- ❌ 성능 최적화 위치 결정 불가

---

## 💡 제안된 해결 방안

### ✅ 방안 1: 템플릿 기반 (가장 현실적)

**개념:**
표준 Excel 템플릿 제공 → 사용자가 템플릿에 맞게 작성

**템플릿 구조:**
```excel
Sheet 1: 메타정보
- 화면ID, 화면명, 테이블명

Sheet 2: 컬럼 정의
- 컬럼ID, 한글명, 타입, 너비

Sheet 3: 데이터 (선택)
```

**장점:**
- ✅ 파싱 로직 단순화
- ✅ 검증 가능
- ✅ 재현 가능

**단점:**
- ⚠️ 기존 Excel을 템플릿에 맞게 변환 필요
- ⚠️ 자유로운 Excel 사용 불가

**구현 난이도:** ⭐⭐☆☆☆

### ✅ 방안 2: AI 기반 스마트 파싱

**개념:**
Gemini API로 Excel 구조 이해 → 화면 스키마 생성

**워크플로우:**
```javascript
1. Excel 업로드 → SheetJS로 데이터 추출
2. Gemini API 전송 (Excel JSON + DB 스키마)
3. AI가 화면 스키마 생성
4. 사용자 검토
5. 화면 생성
```

**장점:**
- ✅ 자유로운 Excel 사용
- ✅ AI가 의미 추론
- ✅ 병합, 수식도 이해

**단점:**
- ❌ 정확도 보장 불가
- ❌ API 비용 ($4/월)
- ❌ 속도 느림 (2-5초)

**구현 난이도:** ⭐⭐⭐⭐☆

### ✅ 방안 3: 하이브리드 (추천!)

**개념:**
AI 초안 작성 + 사용자 검증

**워크플로우:**
```javascript
1. 일반 Excel 업로드
2. AI 자동 분석 → 템플릿 변환 제안
3. 사용자가 매핑 검토/수정
4. 최종 확정 후 생성
```

**장점:**
- ✅ AI가 초안 작성 (편의성)
- ✅ 사용자 검증 (정확도)
- ✅ 완전 자동보다 신뢰도 높음

**단점:**
- ⚠️ 개발 범위 넓음

**구현 난이도:** ⭐⭐⭐☆☆

---

## 📊 기술 스택 결정

### Excel 처리
```javascript
// SheetJS (XLSX.js)
import * as XLSX from 'xlsx';

// Frontend에서 먼저 파싱
const workbook = XLSX.read(file);
const jsonData = XLSX.utils.sheet_to_json(sheet);

// 스키마만 Backend 전송
```

### DB 분석
```typescript
// Prisma Introspection
const dbSchema = await prisma.$queryRaw`
  SELECT table_name, column_name, data_type
  FROM information_schema.columns
  WHERE table_schema = 'public'
`;
```

### AI 통합
```typescript
import { GoogleGenerativeAI } from "@google/generative-ai";

const model = genAI.getGenerativeModel({ 
  model: "gemini-2.0-flash-exp" 
});

const result = await model.generateContent(prompt);
```

### 차트
```typescript
// Recharts
<BarChart data={data}>
  <Bar dataKey="cost" />
</BarChart>
```

---

## 🎯 단계적 실행 계획 (수정)

### Phase 0: 초기 학습 셋업 (1주)
```
✅ 목표:
- DB 메타데이터 전체 수집
- Vector Store 구축 (Pinecone)
- 네이밍 규칙 학습 데이터 생성
- 도메인 용어 사전 구축

📊 예상 시간: 30분 (자동) + 2시간 (검토)
위험도: 낮음 ⭐⭐☆☆☆
```

### Phase 1: 템플릿 기반 MVP + RAG (3주)
```
✅ 목표:
- 표준 Excel 템플릿 제공
- RAG 기반 컬럼 매핑 제안
- 사용자 피드백 수집 UI
- 강화 학습 루프 구축

📊 인터랙티브 학습: 첫 10개 화면
   - AI 제안 → 사용자 검토 → 학습 반영
   - 정확도: 40% → 75%
   
위험도: 중간 ⭐⭐⭐☆☆
```

### Phase 2: 자동화 고도화 (2주)
```
✅ 추가:
- 신뢰도 기반 자동/수동 분기
- 컨텍스트 인식 매핑
- JOIN 조건 자동 생성
- 캐싱 및 성능 최적화

📊 목표 정확도: 85-95%
📊 사용자 검토: 10-20% 항목만

위험도: 중간 ⭐⭐⭐☆☆
```

### Phase 3: Excel 검증 강화 (1주)
```
✅ 추가:
- Excel 규칙 검증 도구
- 템플릿 준수 체크
- 오류 보고서 생성
- 가이드라인 문서

📚 사용자 교육:
- Excel 작성 가이드
- 체크리스트
- 샘플 파일

위험도: 낮음 ⭐⭐☆☆☆
```

### Phase 4: 차트 지원 (2주)
```
✅ 추가:
- 기본 차트만 (Bar, Line, Pie)
- 사용자 입력 기반 설정
- Recharts 통합

위험도: 중간 ⭐⭐⭐☆☆
```

---

## 🚨 해결 과제

### 1. 표준화 협의 (필수)
```
❗ Excel 작성 가이드라인:
- 헤더는 첫 번째 행
- 병합 셀 최소화
- 수식은 계산 결과로
- 시트당 하나의 테이블
```

### 2. 사용자 교육
```
❗ 트레이닝 필요:
- 템플릿 사용법
- 매핑 개념 이해
- 오류 해결
```

### 3. 폴백 전략
```
❗ 자동 생성 실패 시:
- 수동 스키마 입력 모드
- 부분 생성 (그리드만)
- 에러 로그
```

---

## 📈 예상 성과 (수정)

### 정량적 목표
- ✅ **초기 (1-10개 화면)**: 60-75% 자동화 (학습 중)
- ✅ **학습 후 (11개 이상)**: 85-95% 자동화
- ✅ **개발 속도**: 기존 대비 **6배 빠름**
  - Before: 화면 1개 = 30분 (수동 매핑)
  - After: 화면 1개 = 5분 (자동 매핑 + 검토)

### 강화 학습 효과
```
초기 셋업: 2시간 (DB 분석 + 용어 사전)
학습 기간: 10개 화면 (8시간)
정확도 향상: 40% → 85%
ROI: 2개월 후 회수

비용:
- Pinecone: $25/월
- OpenAI Embeddings: $15/월
- Gemini API: $10/월
합계: $50/월

절감:
- 화면당 25분 절약
- 월 20개 화면 시: 8.3시간 절약
- 인건비 $50/시: $415/월 절감
```

### 정성적 목표
- ✅ 비개발자도 화면 생성 가능
- ✅ Excel 자산 재활용
- ✅ **프로젝트별 학습 지식 축적** ⬅️ NEW
- ✅ **지속적 정확도 개선** ⬅️ NEW
- ✅ 표준화된 화면 품질

---

## 📌 결론 (업데이트)

### 실현 가능성: **75%** (RAG 강화 학습 적용 시)

**가능한 것:**
- ✅ 템플릿 기반 화면 생성
- ✅ 단순 그리드 (차트 제외)
- ✅ **DB 컬럼 매핑 (RAG 강화 학습)** ⬅️ NEW!
- ✅ 임시/정식 메뉴 관리
- ✅ **프로젝트별 학습된 네이밍 규칙** ⬅️ NEW!

**사용자 교육으로 해결:**
- 📚 매크로/VBA 사용 금지 (규칙)
- 📚 비정형 Excel 표준화 (가이드라인)
- 📚 암묵적 규칙 명시화 (체크리스트)
- 📚 복잡한 수식 금지 (단순 수식만)
- 📚 Excel 검증 도구 제공

**RAG 강화 학습으로 해결:**
- 🤖 한글명 → DB 테이블/컬럼 자동 매핑
- 🤖 JOIN 조건 자동 생성 (학습 기반)
- 🤖 레거시 네이밍 규칙 학습 (proc, nm 등)
- 🤖 프로젝트별 도메인 지식 축적
- 🤖 사용자 피드백으로 지속 개선

**여전히 어려운 것:**
- ⚠️ 자유 형식 Excel 100% 파싱 (규칙으로 해결)
- ⚠️ 차트 자동 생성 (Phase 4로 연기)

### 최종 권장사항

```
✅ MVP: 템플릿 기반 시스템 (80% 자동화)
✅ AI 보조: 템플릿 변환 도움 (사용자 검토 필수)
✅ 점진적 고도화: 피드백 반영

핵심 메시지:
"100% 자동화는 불가능하지만,
 80% 자동화 + 20% 사용자 검토는 충분히 가능합니다."
```

---

## 🗂️ 생성된 파일

### 신규 문서
```
docs/EXCEL_TO_SCREEN_TECHNICAL_ANALYSIS.md  (500+ lines)
docs/SESSION_SUMMARY_20251202.md            (this file)
```

---

## 🔄 다음 단계

### 즉시 작업 (우선순위 높음)
1. ✅ **의사결정**: 방안 1/2/3 중 선택
2. ✅ **Excel 템플릿 설계**: 5개 시트 구조 확정
3. ✅ **프로토타입 개발**: 템플릿 검증 로직
4. ✅ **UI 목업**: Excel 업로드 → 매핑 → 생성 플로우

### Phase 1 실행 (2주)
```
Week 1:
- Excel 업로드 UI (Drag & Drop)
- SheetJS 파싱 로직
- 템플릿 검증 (스키마 체크)

Week 2:
- 그리드 자동 생성 (TanStack Table)
- 임시 메뉴 등록
- 테스트 (샘플 Excel 3종)
```

### 기술 검증 (병행)
```
- Gemini API 테스트 (Excel → Schema)
- Prisma Introspection 테스트
- Recharts 통합 가능성 검토
```

---

## 💬 논의 필요 사항

### 1. 템플릿 vs 자유 형식
```
Q: 사용자에게 템플릿 강제?
A: 협의 필요
```

### 2. AI 사용 범위
```
Q: Gemini API 비용 ($4/월)?
A: 승인 필요
```

### 3. 차트 지원 범위
```
Q: 모든 차트? 기본 차트만?
A: 요구사항 확인 필요
```

### 4. 성능 목표
```
Q: 몇 초 이내 생성?
A: SLA 정의 필요
```

---

## 📚 참고 문서

### 프로젝트 문서
- `EXCEL_TO_SCREEN_TECHNICAL_ANALYSIS.md` - 기술 분석 (신규)
- `resources/excel/EXCEL_LIBRARIES_COMPARISON.md` - 라이브러리 비교
- `resources/excel/SCREEN_GENERATOR_TEMPLATE_SPEC.md` - 템플릿 명세

### 이전 세션
- `docs/SESSION_SUMMARY_20251201.md` - Next.js 마이그레이션

---

## ✨ 핵심 인사이트

### 기술적 인사이트
1. **Excel ≠ Database**: 패러다임이 다름, 완벽한 자동 변환 불가
2. **AI는 보조 도구**: 100% 신뢰 불가, 사용자 검증 필수
3. **템플릿이 현실적**: 표준화가 자동화의 핵심

### 전략적 인사이트
1. **MVP 먼저**: 템플릿 기반으로 시작, 점진적 고도화
2. **사용자 참여**: 80% 자동 + 20% 검토 = 실용적
3. **표준화 투자**: 가이드라인 수립이 성공의 열쇠

---

**작업 완료 시각**: 2025년 12월 2일 09:30  
**다음 세션 우선순위**: 템플릿 설계 및 프로토타입 개발

**작성자**: GitHub Copilot (JARVIS)
