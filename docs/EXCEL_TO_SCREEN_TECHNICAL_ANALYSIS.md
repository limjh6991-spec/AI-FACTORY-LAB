# Excel ê¸°ë°˜ í™”ë©´ ìë™ ìƒì„± ì‹œìŠ¤í…œ - ê¸°ìˆ ì  ë¶„ì„

## ğŸ“‹ ê°œìš”

**ì‘ì„±ì¼**: 2025ë…„ 12ì›” 2ì¼  
**ëª©ì **: Excel íŒŒì¼ì„ ì½ì–´ ìë™ìœ¼ë¡œ í™”ë©´ì„ ìƒì„±í•˜ëŠ” ì‹œìŠ¤í…œì˜ ê¸°ìˆ ì  íƒ€ë‹¹ì„± ë° ë¦¬ìŠ¤í¬ ë¶„ì„

---

## ğŸ¯ ì œì•ˆëœ ì›Œí¬í”Œë¡œìš°

```
1. ì‚¬ìš©ìê°€ ì¥í‘œë¡œ ì‚¬ìš©í•˜ëŠ” ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ
   â†“
2. ì—‘ì…€ íŒŒì¼ ë¶„ì„ (í…Œì´ë¸”, ì»¬ëŸ¼, ë¡œì§ íŒŒì•…)
   â†“
3. ì—‘ì…€ í‘œ ì„œì‹ìœ¼ë¡œ ê·¸ë¦¬ë“œ êµ¬ì„± (+ ì°¨íŠ¸ í¬í•¨)
   â†“
4. ì„ íƒ ì˜µì…˜ ì²˜ë¦¬ (ë¯¸ì •)
   â†“
5. ì„ì‹œ ë©”ë‰´ì— í™”ë©´ ìƒì„±
   â†“
6. ì‚¬ìš©ìê°€ ë©”ë‰´ ìƒì„± í™”ë©´ì—ì„œ ì •ì‹ ë©”ë‰´ë¡œ ë“±ë¡
```

---

## âš ï¸ ë¹„íŒì  ë¶„ì„ - ê¸°ìˆ ì  ë¬¸ì œì 

### ğŸ”´ **1ë‹¨ê³„: Excel íŒŒì¼ ë¶„ì„ - ë†’ì€ ë³µì¡ë„**

#### ë¬¸ì œì  1.1: ë¹„ì •í˜• ë°ì´í„° êµ¬ì¡°
```
âŒ í˜„ì‹¤ì ì¸ Excel ì‚¬ìš© íŒ¨í„´:
- ë³‘í•©ëœ ì…€ (í—¤ë” ë³‘í•©, ê·¸ë£¹í•‘)
- ë‹¤ì¤‘ í—¤ë” (2-3ë‹¨ê³„ í—¤ë” êµ¬ì¡°)
- ì…€ ë‚´ ìˆ˜ì‹ (SUM, VLOOKUP, IF ë“±)
- ìˆ¨ê²¨ì§„ í–‰/ì—´
- ì¡°ê±´ë¶€ ì„œì‹
- ë§¤í¬ë¡œ í¬í•¨
- ì—¬ëŸ¬ ì‹œíŠ¸ì— ê±¸ì¹œ ì°¸ì¡°
- í”¼ë²— í…Œì´ë¸”
- ì…€ ë‚´ ê°œí–‰ ë¬¸ì, íŠ¹ìˆ˜ë¬¸ì
```

**ì˜ˆì‹œ - ì‹¤ì œ ì›ê°€ ì¥í‘œ:**
```excel
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     2025ë…„ 11ì›” ê³µì •ë³„ ì›ê°€ í˜„í™©      â”‚  â† ë³‘í•©ëœ íƒ€ì´í‹€
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        â”‚  ìì¬ë¹„  â”‚  ì¸ê±´ë¹„  â”‚  í•©ê³„   â”‚  â† 2ë‹¨ê³„ í—¤ë”
â”‚  ê³µì •ëª…  â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”€â”¬â”€â”€â”€â”¤
â”‚        â”‚ ê³„íš â”‚ì‹¤ì â”‚ ê³„íš â”‚ì‹¤ì â”‚ ê³„íš â”‚ì‹¤ì â”‚  â† 3ë‹¨ê³„ í—¤ë”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚ ê°€ê³µ   â”‚1000â”‚950â”‚ 500â”‚480â”‚1500â”‚1430â”‚
â”‚ ì¡°ë¦½   â”‚ =SUM(B5:C5) â”‚ 600â”‚550â”‚2100â”‚2000â”‚ â† ìˆ˜ì‹ í¬í•¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”˜
```

**ê¸°ìˆ ì  í•œê³„:**
- âŒ Apache POI/SheetJSëŠ” ë³‘í•© ì…€ ì½ê¸°ëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ **ì˜ë¯¸ íŒŒì•…ì€ ë¶ˆê°€ëŠ¥**
- âŒ "ê³„íš/ì‹¤ì "ì´ ê°ê° ë‹¤ë¥¸ ì»¬ëŸ¼ì¸ì§€, ê°™ì€ ë°ì´í„°ì˜ ìƒíƒœ ë³€í™”ì¸ì§€ **AI ì¶”ë¡  í•„ìš”**
- âŒ ìˆ˜ì‹(`=SUM(B5:C5)`)ì„ DB ë¡œì§ìœ¼ë¡œ ë³€í™˜í•˜ë ¤ë©´ **ìˆ˜ì‹ íŒŒì„œ + SQL ìƒì„±ê¸° í•„ìš”**
- âŒ íƒ€ì´í‹€ í–‰ì´ ë°ì´í„°ì¸ì§€ ë©”íƒ€ì •ë³´ì¸ì§€ **êµ¬ë¶„ ë¡œì§ í•„ìš”**

#### ë¬¸ì œì  1.2: ì•”ë¬µì  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
```javascript
// Excelì—ëŠ” ì—†ì§€ë§Œ ì‹¤ì œ í•„ìš”í•œ ë¡œì§
- ê³µì •ëª…ì´ ë¹„ì–´ìˆìœ¼ë©´ ì´ì „ í–‰ì˜ ê³µì •ëª… ìƒì†
- ìˆ«ì 1000 = 1,000ì›ì¸ì§€ 1,000,000ì›ì¸ì§€?
- "í•©ê³„" í–‰ì€ ê·¸ë¦¬ë“œì— í‘œì‹œí• ê¹Œ? ìˆ¨ê¸¸ê¹Œ?
- "ê³„íš" vs "ì‹¤ì " = ë³„ë„ ì»¬ëŸ¼? ì•„ë‹ˆë©´ status í•„ë“œ?
- ìƒ‰ìƒì´ ë¹¨ê°„ìƒ‰ = ê²½ê³ ? ì—ëŸ¬? ë‹¨ìˆœ ê°•ì¡°?
```

**ë¬¸ì œ:**
- âŒ Excelì˜ **ì‹œê°ì  í‘œí˜„**(ìƒ‰ìƒ, í°íŠ¸, ë“¤ì—¬ì“°ê¸°)ì„ **ë°ì´í„° êµ¬ì¡°**ë¡œ ë³€í™˜ ë¶ˆê°€ëŠ¥
- âŒ ì‚¬ìš©ìë§ˆë‹¤ ë‹¤ë¥¸ **Excel ì‘ì„± ê´€ìŠµ** ë•Œë¬¸ì— 100% íŒŒì‹± ë¶ˆê°€ëŠ¥
- âŒ ë„ë©”ì¸ ì§€ì‹ ì—†ì´ëŠ” **ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ë¯¸** ì¶”ë¡  ë¶ˆê°€

---

### ğŸ”´ **2ë‹¨ê³„: DB ë¶„ì„ - ì—­ê³µí•™ì˜ í•œê³„**

#### ë¬¸ì œì  2.1: í…Œì´ë¸” ë° ì»¬ëŸ¼ ì¶”ë¡ 
```sql
-- Excelì— "ê³µì •ëª…" ì»¬ëŸ¼ì´ ìˆë‹¤ë©´...
-- 1. ì–´ëŠ í…Œì´ë¸”ì„ ì‚¬ìš©?
SELECT * FROM process_master;  -- ê³µì •ë§ˆìŠ¤í„°?
SELECT * FROM cost_process;    -- ì›ê°€ê³µì •?
SELECT * FROM production_line; -- ìƒì‚°ë¼ì¸?

-- 2. ì–´ëŠ ì»¬ëŸ¼ì„ ë§¤í•‘?
process_name   -- ê³µì •ëª…
process_title  -- ê³µì •ëª…
proc_nm        -- ê³µì •ëª… (ì•½ì–´)
```

**í˜„ì‹¤ì ì¸ ë¬¸ì œ:**
- âŒ í•œê¸€ ì»¬ëŸ¼ëª… â†’ ì˜ë¬¸ í…Œì´ë¸”ëª… ë§¤í•‘ **ë¶ˆê°€ëŠ¥** (ë„¤ì´ë° ê·œì¹™ ì—†ìŒ)
- âŒ ì—¬ëŸ¬ í…Œì´ë¸”ì— ë¹„ìŠ·í•œ ì»¬ëŸ¼ ì¡´ì¬ ì‹œ **ìš°ì„ ìˆœìœ„ ê²°ì • ë¶ˆê°€**
- âŒ JOIN ì¡°ê±´ ìë™ ìƒì„± **ê±°ì˜ ë¶ˆê°€ëŠ¥** (FK ì œì•½ì¡°ê±´ ì—†ëŠ” ê²½ìš° ë§ìŒ)

#### ë¬¸ì œì  2.2: DB ìŠ¤í‚¤ë§ˆ í’ˆì§ˆ ì˜ì¡´
```sql
-- ì¢‹ì€ ê²½ìš° (ì´ìƒì )
CREATE TABLE process_master (
  process_id INT PRIMARY KEY,
  process_code VARCHAR(10) UNIQUE,
  process_name VARCHAR(100),
  created_at TIMESTAMP
);

-- ë‚˜ìœ ê²½ìš° (í˜„ì‹¤)
CREATE TABLE tb_proc (  -- ì˜ë¯¸ ë¶ˆëª… í…Œì´ë¸”ëª…
  c1 INT,               -- ì˜ë¯¸ ë¶ˆëª… ì»¬ëŸ¼ëª…
  c2 VARCHAR(255),
  c3 TEXT,              -- íƒ€ì…ì´ TEXTë¼ ë­ë“  ë“¤ì–´ê°
  c4 VARCHAR(50)
);
```

**ë¬¸ì œ:**
- âŒ ë ˆê±°ì‹œ DBëŠ” **í…Œì´ë¸”ëª…/ì»¬ëŸ¼ëª…ì´ ì•”í˜¸** ê°™ìŒ (`tb_cost_001`, `col_a1`)
- âŒ FK ì œì•½ì¡°ê±´ ì—†ìœ¼ë©´ **JOIN ê´€ê³„ íŒŒì•… ë¶ˆê°€**
- âŒ ì£¼ì„(COMMENT) ì—†ìœ¼ë©´ **ì»¬ëŸ¼ ìš©ë„ íŒŒì•… ë¶ˆê°€**

#### ë¬¸ì œì  2.3: ë¡œì§ ë³µì¡ë„
```javascript
// Excel ìˆ˜ì‹: =IF(B2>1000, B2*0.9, B2*0.95)
// â†’ ì´ê±¸ ì–´ë–»ê²Œ DBë¡œ?

// Option 1: SQL í•¨ìˆ˜
CASE 
  WHEN material_cost > 1000 THEN material_cost * 0.9
  ELSE material_cost * 0.95
END

// Option 2: Application ë¡œì§ (tRPC)
const discount = cost > 1000 ? 0.9 : 0.95;
return cost * discount;

// ë¬¸ì œ: ì–´ë””ì— ë‘˜ì§€ ìë™ ê²°ì • ë¶ˆê°€ëŠ¥
```

**ë¬¸ì œ:**
- âŒ Excel ìˆ˜ì‹ â†’ SQL/JavaScript ë³€í™˜ **100% ì •í™•ë„ ë¶ˆê°€ëŠ¥**
- âŒ ë³µì¡í•œ ìˆ˜ì‹(VLOOKUP, INDEX, MATCH)ì€ **ë³€í™˜ ìì²´ê°€ ì–´ë ¤ì›€**
- âŒ ì„±ëŠ¥ ìµœì í™” ìœ„ì¹˜(DB vs App) **ê²°ì • ë¶ˆê°€**

---

### ğŸŸ¡ **3ë‹¨ê³„: ê·¸ë¦¬ë“œ êµ¬ì„± - ì¤‘ê°„ ë‚œì´ë„**

#### ë¬¸ì œì  3.1: í‘œ ì„œì‹ ë³€í™˜ì˜ í•œê³„
```
âœ… ê°€ëŠ¥í•œ ê²ƒ:
- ì»¬ëŸ¼ ìˆœì„œ, ë„ˆë¹„
- ë°ì´í„° íƒ€ì… (ë¬¸ì, ìˆ«ì, ë‚ ì§œ)
- ì •ë ¬ ë°©í–¥
- ìˆ«ì í¬ë§· (1,000 í˜•ì‹)

âš ï¸ì–´ë ¤ìš´ ê²ƒ:
- ë³‘í•©ëœ ì…€ â†’ ê·¸ë¦¬ë“œ ê·¸ë£¹í•‘ìœ¼ë¡œ ë³€í™˜
- ì¡°ê±´ë¶€ ì„œì‹ â†’ ê·¸ë¦¬ë“œ ìŠ¤íƒ€ì¼ ë¡œì§
- ì…€ ìˆ˜ì‹ â†’ ê³„ì‚° ì»¬ëŸ¼
- ë“œë¡­ë‹¤ìš´ â†’ Select ì˜µì…˜

âŒ ë¶ˆê°€ëŠ¥í•œ ê²ƒ:
- ë§¤í¬ë¡œ â†’ JavaScript ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
- VBA ìŠ¤í¬ë¦½íŠ¸ â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
- ë³µì¡í•œ ì°¨íŠ¸ â†’ Recharts ì„¤ì •
```

**ì˜ˆì‹œ - ì¡°ê±´ë¶€ ì„œì‹:**
```excel
Excel: "ê°’ì´ 1000 ì´ìƒì´ë©´ ë¹¨ê°„ìƒ‰"
â†“
TanStack Table: ???

// í•„ìš”í•œ ì½”ë“œ:
{
  accessorKey: 'cost',
  cell: ({ getValue }) => {
    const value = getValue();
    return (
      <span className={value >= 1000 ? 'text-red-500' : ''}>
        {value.toLocaleString()}
      </span>
    );
  }
}

// ë¬¸ì œ: ì´ ë¡œì§ì„ ìë™ ìƒì„±í•˜ë ¤ë©´?
// â†’ AIê°€ "ë¹¨ê°„ìƒ‰ = ê²½ê³ "ë¼ëŠ” ì˜ë¯¸ë¥¼ ì•Œì•„ì•¼ í•¨
```

#### ë¬¸ì œì  3.2: ì°¨íŠ¸ ë³€í™˜ì˜ ë³µì¡ë„
```javascript
// Excel ì°¨íŠ¸ ì •ë³´
chartType: "column"
dataRange: "B2:C10"
xAxis: "ê³µì •ëª…"
yAxis: "ë¹„ìš©"

// Recharts ì½”ë“œ (í•„ìš”)
<BarChart data={data}>
  <CartesianGrid strokeDasharray="3 3" />
  <XAxis dataKey="processName" />
  <YAxis />
  <Tooltip />
  <Legend />
  <Bar dataKey="cost" fill="#8884d8" />
</BarChart>

// ë¬¸ì œ:
// 1. Excelì—ì„œ ì°¨íŠ¸ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ìì²´ê°€ ë³µì¡
// 2. Recharts ì„¤ì •ìœ¼ë¡œ 1:1 ë§¤í•‘ ë¶ˆê°€ëŠ¥
// 3. ì°¨íŠ¸ ì˜µì…˜ (ìƒ‰ìƒ, ë²”ë¡€, íˆ´íŒ) ìë™ ìƒì„± ì–´ë ¤ì›€
```

---

### ğŸŸ¡ **4ë‹¨ê³„: ì„ íƒ ì˜µì…˜ - ë¯¸ì • (ë¦¬ìŠ¤í¬ ë†’ìŒ)**

#### ì˜ì‚¬ê²°ì • í•„ìš” ì‚¬í•­
```
1. ì‚¬ìš©ìê°€ Excelì—ì„œ ìˆ˜ì •í•œ ë‚´ìš©ì´ DBì— ë°˜ì˜ë˜ì–´ì•¼ í•˜ë‚˜?
   â†’ YES: ì–‘ë°©í–¥ ë™ê¸°í™” í•„ìš” (ë³µì¡ë„ 10ë°° â†‘)
   â†’ NO: Read-only ë·°ì–´ë§Œ ì œê³µ

2. ì—¬ëŸ¬ ì‹œíŠ¸ë¥¼ í•˜ë‚˜ì˜ í™”ë©´ì—?
   â†’ YES: íƒ­ UI + ì—¬ëŸ¬ ê·¸ë¦¬ë“œ í•„ìš”
   â†’ NO: ì‹œíŠ¸ë§ˆë‹¤ ë³„ë„ í™”ë©´

3. ì…€ ë³‘í•© ì²˜ë¦¬?
   â†’ YES: ê·¸ë£¹í•‘/ìŠ¤íŒ¨ë‹ ê¸°ëŠ¥ í•„ìš”
   â†’ NO: ë³‘í•© ë¬´ì‹œí•˜ê³  ì²« ë²ˆì§¸ ì…€ë§Œ í‘œì‹œ

4. ìˆ˜ì‹ ê³„ì‚°?
   â†’ YES: ìˆ˜ì‹ ì—”ì§„ í•„ìš” (HyperFormula ë“±)
   â†’ NO: ê³„ì‚° ê²°ê³¼ë§Œ í‘œì‹œ

5. ì°¨íŠ¸ í‘œì‹œ?
   â†’ YES: ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ í†µí•© + ì„¤ì • ë³€í™˜
   â†’ NO: ì°¨íŠ¸ ë¬´ì‹œ

6. ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸?
   â†’ YES: WebSocket + ì¶©ëŒ í•´ê²° ë¡œì§
   â†’ NO: ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨
```

**ë¬¸ì œ:**
- âŒ ê° ì„ íƒì§€ë§ˆë‹¤ **ê°œë°œ ê³µìˆ˜ê°€ 2-4ì£¼ì”©** ì¶”ê°€ë¨
- âŒ "ë¯¸ì •" ìƒíƒœë¡œ ì§„í–‰ ì‹œ **ë‚˜ì¤‘ì— ëŒ€ê·œëª¨ ë¦¬íŒ©í† ë§** í•„ìš”

---

### ğŸŸ¢ **5-6ë‹¨ê³„: ë©”ë‰´ ë“±ë¡ - ë‚®ì€ ë‚œì´ë„**

ì´ ë¶€ë¶„ì€ **ê¸°ìˆ ì ìœ¼ë¡œ ê°€ëŠ¥**í•©ë‹ˆë‹¤.

```typescript
// ì„ì‹œ ë©”ë‰´ ìƒì„±
const tempMenu = {
  id: 'temp_' + Date.now(),
  name: excelFileName,
  path: '/temp/' + screenId,
  parent: 'temp',
  icon: 'file-spreadsheet'
};

// ì •ì‹ ë©”ë‰´ë¡œ ì´ë™
const moveToMainMenu = (tempMenu) => {
  const mainMenu = {
    ...tempMenu,
    id: screenId,
    parent: selectedParentMenu,
    path: selectedCategory + '/' + screenId
  };
  await api.menu.create(mainMenu);
  await api.menu.delete(tempMenu.id);
};
```

âœ… **ë¬¸ì œì—†ìŒ** - CRUD ë¡œì§ë§Œ ìˆìœ¼ë©´ ë¨

---

## ğŸ” ê·¼ë³¸ì ì¸ ë¬¸ì œì  ìš”ì•½

### 1ï¸âƒ£ **Excel â‰  Database**
```
Excelì€ "ë¬¸ì„œ"ì…ë‹ˆë‹¤.
- ììœ ë¡œìš´ ë ˆì´ì•„ì›ƒ
- ë³‘í•©, ìˆ˜ì‹, ë§¤í¬ë¡œ
- ì‹œê°ì  í‘œí˜„ ì¤‘ì‹¬

DatabaseëŠ” "êµ¬ì¡°í™”ëœ ë°ì´í„°"ì…ë‹ˆë‹¤.
- ì—„ê²©í•œ ìŠ¤í‚¤ë§ˆ
- ì •ê·œí™”
- ê´€ê³„ ì¤‘ì‹¬
```

**ë‘ íŒ¨ëŸ¬ë‹¤ì„ì„ ìë™ ë³€í™˜í•˜ëŠ” ê²ƒì€ AI ì—†ì´ëŠ” ë¶ˆê°€ëŠ¥**

### 2ï¸âƒ£ **ì •ë³´ ì†ì‹¤ ë¬¸ì œ**
```
Excel â†’ í™”ë©´ ë³€í™˜ ì‹œ ì†ì‹¤ë˜ëŠ” ì •ë³´:
- ì…€ ë³‘í•©ì˜ ì˜ë¯¸ (ê·¸ë£¹í•‘? ì œëª©? ë©”íƒ€ì •ë³´?)
- ìƒ‰ìƒì˜ ì˜ë¯¸ (ê²½ê³ ? ê°•ì¡°? ì¹´í…Œê³ ë¦¬?)
- ìˆ˜ì‹ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
- ë§¤í¬ë¡œ/VBA ìŠ¤í¬ë¦½íŠ¸
- ì‚¬ìš©ìê°€ ì•”ë¬µì ìœ¼ë¡œ ì•„ëŠ” ê·œì¹™
```

### 3ï¸âƒ£ **ì¼ê´€ì„± ë¬¸ì œ**
```
ì‚¬ìš©ìë§ˆë‹¤ ë‹¤ë¥¸ Excel ì‘ì„± ë°©ì‹:
- A ì‚¬ìš©ì: í—¤ë”ê°€ 1í–‰
- B ì‚¬ìš©ì: í—¤ë”ê°€ 3í–‰ (ë³‘í•©)
- C ì‚¬ìš©ì: í—¤ë”ê°€ ì—†ìŒ
- D ì‚¬ìš©ì: ê° ì‹œíŠ¸ë§ˆë‹¤ ë‹¤ë¦„

â†’ í‘œì¤€í™” ì—†ì´ëŠ” ìë™ íŒŒì‹± ë¶ˆê°€ëŠ¥
```

---

## ğŸ’¡ í˜„ì‹¤ì ì¸ í•´ê²° ë°©ì•ˆ

### âœ… **ë°©ì•ˆ 1: í…œí”Œë¦¿ ê¸°ë°˜ ì ‘ê·¼ (ì¶”ì²œ)**

**ê°œë…:**
ì‚¬ìš©ìì—ê²Œ **í‘œì¤€ Excel í…œí”Œë¦¿**ì„ ì œê³µí•˜ê³ , ê·¸ í˜•ì‹ì— ë§ê²Œ ì‘ì„±í•˜ë„ë¡ ê°•ì œ

**í…œí”Œë¦¿ êµ¬ì¡°:**
```excel
Sheet 1: ë©”íƒ€ì •ë³´
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í™”ë©´ID       â”‚ COST001        â”‚
â”‚ í™”ë©´ëª…       â”‚ ê³µì •ë³„ ì›ê°€     â”‚
â”‚ í…Œì´ë¸”ëª…     â”‚ process_cost    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Sheet 2: ì»¬ëŸ¼ ì •ì˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚ ì»¬ëŸ¼ID     â”‚ í•œê¸€ëª…    â”‚ íƒ€ì…     â”‚ ë„ˆë¹„ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ process_id â”‚ ê³µì •ID   â”‚ number   â”‚ 80  â”‚
â”‚ process_nm â”‚ ê³µì •ëª…   â”‚ string   â”‚ 120 â”‚
â”‚ cost       â”‚ ë¹„ìš©     â”‚ number   â”‚ 100 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜

Sheet 3: ë°ì´í„° (ì„ íƒì‚¬í•­)
```

**ì¥ì :**
- âœ… íŒŒì‹± ë¡œì§ **ë‹¨ìˆœí™”** (ì •í•´ì§„ êµ¬ì¡°ë§Œ ì½ìœ¼ë©´ ë¨)
- âœ… **ê²€ì¦ ê°€ëŠ¥** (í…œí”Œë¦¿ ì¤€ìˆ˜ ì—¬ë¶€ ì²´í¬)
- âœ… **ì¬í˜„ ê°€ëŠ¥** (ê°™ì€ í…œí”Œë¦¿ = ê°™ì€ ê²°ê³¼)

**ë‹¨ì :**
- âš ï¸ ì‚¬ìš©ìê°€ ê¸°ì¡´ Excelì„ **í…œí”Œë¦¿ì— ë§ê²Œ ë³€í™˜**í•´ì•¼ í•¨
- âš ï¸ "ììœ ë¡œìš´ Excel" ì‚¬ìš© ë¶ˆê°€

**êµ¬í˜„ ë‚œì´ë„:** â­â­â˜†â˜†â˜† (ì¤‘í•˜)

---

### âœ… **ë°©ì•ˆ 2: AI ê¸°ë°˜ ìŠ¤ë§ˆíŠ¸ íŒŒì‹± (ë„ì „ì )**

**ê°œë…:**
LLM(Gemini/GPT)ì„ ì‚¬ìš©í•´ Excel êµ¬ì¡°ë¥¼ ì´í•´í•˜ê³  í™”ë©´ ìƒì„±

**ì›Œí¬í”Œë¡œìš°:**
```javascript
1. Excel íŒŒì¼ ì—…ë¡œë“œ
2. SheetJSë¡œ ì›ë³¸ ë°ì´í„° ì¶”ì¶œ (ë³‘í•© ì…€, ìˆ˜ì‹ í¬í•¨)
3. Gemini APIì— ì „ì†¡:
   - Excel ë°ì´í„° (JSON)
   - ìŠ¤í‚¤ë§ˆ ì •ë³´ (DB í…Œì´ë¸” ëª©ë¡)
   - í”„ë¡¬í”„íŠ¸: "ì´ Excelì„ ë¶„ì„í•´ì„œ í™”ë©´ ìŠ¤í‚¤ë§ˆ ìƒì„±í•´ì¤˜"
4. Geminiê°€ ìƒì„±í•œ JSON ìŠ¤í‚¤ë§ˆ ë°›ê¸°
5. ì‚¬ìš©ìì—ê²Œ ê²€í†  ìš”ì²­
6. í™•ì • í›„ í™”ë©´ ìƒì„±
```

**ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸:**
```
ë‹¤ìŒ Excel ë°ì´í„°ë¥¼ ë¶„ì„í•´ì„œ TanStack Table ì„¤ì •ì„ ìƒì„±í•´ì¤˜.

Excel ë°ì´í„°:
Row 1: ["ê³µì •ëª…", "ìì¬ë¹„(ê³„íš)", "ìì¬ë¹„(ì‹¤ì )", "í•©ê³„"]
Row 2: ["ê°€ê³µ", 1000, 950, 1950]
Row 3: ["ì¡°ë¦½", 1500, 1400, 2900]

DB ìŠ¤í‚¤ë§ˆ:
- process_master (process_id, process_name)
- cost_detail (cost_id, process_id, plan_cost, actual_cost)

ì¶œë ¥ í˜•ì‹: JSON
{
  "columns": [...],
  "mapping": {...},
  "queries": [...]
}
```

**ì¥ì :**
- âœ… **ììœ ë¡œìš´ Excel** ì‚¬ìš© ê°€ëŠ¥
- âœ… AIê°€ **ì˜ë¯¸ë¥¼ ì¶”ë¡ **
- âœ… ë³‘í•©, ìˆ˜ì‹, ì°¨íŠ¸ë„ ì´í•´ ê°€ëŠ¥

**ë‹¨ì :**
- âŒ **ì •í™•ë„ ë³´ì¥ ë¶ˆê°€** (AI í™˜ê°, ì˜¤í•´ì„)
- âŒ **ë¹„ìš© ë°œìƒ** (API í˜¸ì¶œ ë¹„ìš©)
- âŒ **ì†ë„ ëŠë¦¼** (Gemini ì‘ë‹µ 2-5ì´ˆ)
- âŒ **ë³µì¡í•œ Excelì€ í† í° ì œí•œ** ì´ˆê³¼

**êµ¬í˜„ ë‚œì´ë„:** â­â­â­â­â˜† (ê³ )

---

### âœ… **ë°©ì•ˆ 3: í•˜ì´ë¸Œë¦¬ë“œ (ì¶”ì²œ)**

**ê°œë…:**
í…œí”Œë¦¿ ê¸°ë°˜ + AI ë³´ì¡°

**ì›Œí¬í”Œë¡œìš°:**
```
1. ì‚¬ìš©ìê°€ ì¼ë°˜ Excel ì—…ë¡œë“œ
2. AIê°€ ìë™ ë¶„ì„ â†’ í…œí”Œë¦¿ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ ì œì•ˆ
3. ì‚¬ìš©ìê°€ ê²€í† /ìˆ˜ì •
4. ìµœì¢… í™•ì • í›„ í™”ë©´ ìƒì„±
```

**ì˜ˆì‹œ:**
```javascript
// Step 1: ì‚¬ìš©ì Excel ì—…ë¡œë“œ
uploadExcel("ì›”ë³„_ì›ê°€í˜„í™©.xlsx");

// Step 2: AI ë¶„ì„
const suggestion = await analyzeExcel(file);
// {
//   detectedHeaders: ["ê³µì •ëª…", "ìì¬ë¹„", "ì¸ê±´ë¹„"],
//   possibleTables: ["process_cost", "monthly_cost"],
//   confidenceScore: 0.85
// }

// Step 3: ì‚¬ìš©ì UIì— í‘œì‹œ
<MappingEditor 
  excelColumns={suggestion.detectedHeaders}
  dbTables={suggestion.possibleTables}
  onConfirm={generateScreen}
/>

// Step 4: ì‚¬ìš©ìê°€ ë§¤í•‘ í™•ì¸/ìˆ˜ì • í›„ ìƒì„±
```

**ì¥ì :**
- âœ… AIê°€ **ì´ˆì•ˆ ì‘ì„±** (ì‚¬ìš©ì í¸ì˜ì„± â†‘)
- âœ… ì‚¬ìš©ìê°€ **ìµœì¢… ê²€ì¦** (ì •í™•ë„ â†‘)
- âœ… ì™„ì „ ìë™ë³´ë‹¤ **ì‹ ë¢°ë„ ë†’ìŒ**

**ë‹¨ì :**
- âš ï¸ ê°œë°œ ë²”ìœ„ ë„“ìŒ (AI + UI + ê²€ì¦)

**êµ¬í˜„ ë‚œì´ë„:** â­â­â­â˜†â˜† (ì¤‘ìƒ)

---

## ğŸ“Š ê¸°ìˆ  ìŠ¤íƒ ì œì•ˆ

### Excel íŒŒì‹±
```javascript
// Frontend (Browser)
import * as XLSX from 'xlsx';  // SheetJS

// ì¥ì : í´ë¼ì´ì–¸íŠ¸ì—ì„œ íŒŒì‹± (ì„œë²„ ë¶€ë‹´ ì—†ìŒ)
// ë‹¨ì : ëŒ€ìš©ëŸ‰ íŒŒì¼ ì‹œ ë¸Œë¼ìš°ì € ë©ˆì¶¤

// Backend (Node.js + tRPC)
import * as XLSX from 'xlsx';  // ë™ì¼ ë¼ì´ë¸ŒëŸ¬ë¦¬

// ì¥ì : ëŒ€ìš©ëŸ‰ ì²˜ë¦¬ ê°€ëŠ¥
// ë‹¨ì : íŒŒì¼ ì—…ë¡œë“œ í•„ìš” (ë„¤íŠ¸ì›Œí¬ ë¹„ìš©)
```

**ì¶”ì²œ:** Frontendì—ì„œ ë¨¼ì € íŒŒì‹± â†’ ìŠ¤í‚¤ë§ˆë§Œ Backend ì „ì†¡

### DB ë¶„ì„
```typescript
// Prisma Introspection
npx prisma db pull

// ê²°ê³¼: schema.prisma ìë™ ìƒì„±
// â†’ ì´ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•´ì„œ AIì— ì œê³µ

const dbSchema = await prisma.$queryRaw`
  SELECT table_name, column_name, data_type
  FROM information_schema.columns
  WHERE table_schema = 'public'
`;
```

### AI í†µí•©
```typescript
import { GoogleGenerativeAI } from "@google/generative-ai";

const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);
const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash-exp" });

const prompt = `
Analyze this Excel data and generate a screen schema:
${JSON.stringify(excelData)}

DB Tables: ${JSON.stringify(dbSchema)}

Output JSON only.
`;

const result = await model.generateContent(prompt);
const schema = JSON.parse(result.response.text());
```

### ì°¨íŠ¸ ìƒì„±
```typescript
// Excelì—ì„œ ì°¨íŠ¸ ì •ë³´ ì¶”ì¶œ
const chartInfo = workbook.Sheets['Sheet1']['!charts'];

// Recharts ì„¤ì • ìƒì„±
const chartConfig = {
  type: 'bar',
  dataKey: 'cost',
  xAxis: 'processName'
};

// UI ë Œë”ë§
<BarChart data={data}>
  <Bar dataKey={chartConfig.dataKey} />
</BarChart>
```

**ë¬¸ì œ:** Excel ì°¨íŠ¸ ë©”íƒ€ë°ì´í„°ëŠ” **SheetJSë¡œ ì¶”ì¶œ ë¶ˆê°€**
**í•´ê²°:** ì‚¬ìš©ìì—ê²Œ ì°¨íŠ¸ ì„¤ì •ì„ **ì§ì ‘ ì…ë ¥**ë°›ê±°ë‚˜ AIê°€ **ì¶”ë¡ **

---

## âš¡ ì„±ëŠ¥ ë° í™•ì¥ì„± ì´ìŠˆ

### 1. ëŒ€ìš©ëŸ‰ Excel ì²˜ë¦¬
```
ë¬¸ì œ:
- 10MB Excel â†’ ë©”ëª¨ë¦¬ 50-100MB ì‚¬ìš©
- 100MB Excel â†’ ë¸Œë¼ìš°ì € ë©ˆì¶¤

í•´ê²°:
- Web Workerë¡œ ë°±ê·¸ë¼ìš´ë“œ íŒŒì‹±
- Streaming íŒŒì‹± (í•œ ë²ˆì— 1000í–‰ì”©)
- ì„œë²„ ì‚¬ì´ë“œ ì²˜ë¦¬
```

### 2. ë™ì‹œ ì‚¬ìš©ì
```
ë¬¸ì œ:
- 100ëª…ì´ ë™ì‹œì— Excel ì—…ë¡œë“œ ì‹œ ì„œë²„ ë¶€ë‹´

í•´ê²°:
- Queue ì‹œìŠ¤í…œ (BullMQ)
- íŒŒì¼ í¬ê¸° ì œí•œ (10MB)
- Rate Limiting (ì‚¬ìš©ìë‹¹ 5ë¶„ì— 1íšŒ)
```

### 3. AI API ë¹„ìš©
```
Gemini API ë¹„ìš© (2025ë…„ ê¸°ì¤€):
- Flash: $0.075 / 1M tokens (ì…ë ¥)
- Flash: $0.30 / 1M tokens (ì¶œë ¥)

ì˜ˆìƒ:
- Excel 10,000 ì…€ = ~50,000 tokens
- API í˜¸ì¶œ 1íšŒ = $0.004
- ì›” 1,000íšŒ = $4

â†’ ë¹„ìš©ì€ ê´œì°®ìŒ, ì†ë„ê°€ ë¬¸ì œ
```

---

## ğŸ¯ ìµœì¢… ê¶Œì¥ ì‚¬í•­

### âœ… **ë‹¨ê³„ì  ì ‘ê·¼ (MVP â†’ ê³ ë„í™”)**

#### Phase 1: í…œí”Œë¦¿ ê¸°ë°˜ (2ì£¼)
```
1. í‘œì¤€ Excel í…œí”Œë¦¿ ì œê³µ
2. í…œí”Œë¦¿ ê²€ì¦ ë¡œì§
3. ê¸°ë³¸ ê·¸ë¦¬ë“œ ìƒì„± (ì°¨íŠ¸ ì—†ìŒ)
4. ì„ì‹œ ë©”ë‰´ ë“±ë¡
```
**ìœ„í—˜ë„:** ë‚®ìŒ â­â­â˜†â˜†â˜†

#### Phase 2: DB ìë™ ë§¤í•‘ (2ì£¼)
```
1. Prisma ìŠ¤í‚¤ë§ˆ ë¶„ì„
2. Excel ì»¬ëŸ¼ â†’ DB ì»¬ëŸ¼ ë§¤ì¹­ ì œì•ˆ
3. ì‚¬ìš©ì ê²€í†  UI
```
**ìœ„í—˜ë„:** ì¤‘ê°„ â­â­â­â˜†â˜†

#### Phase 3: AI ë³´ì¡° (3ì£¼)
```
1. Gemini API í†µí•©
2. ììœ  í˜•ì‹ Excel ë¶„ì„
3. í…œí”Œë¦¿ ìë™ ë³€í™˜
```
**ìœ„í—˜ë„:** ë†’ìŒ â­â­â­â­â˜†

#### Phase 4: ì°¨íŠ¸ ì§€ì› (2ì£¼)
```
1. Excel ì°¨íŠ¸ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ (ìˆ˜ë™)
2. Recharts ë³€í™˜
3. ì°¨íŠ¸ í¸ì§‘ UI
```
**ìœ„í—˜ë„:** ì¤‘ê°„ â­â­â­â˜†â˜†

---

## ğŸš¨ ë°˜ë“œì‹œ í•´ê²°í•´ì•¼ í•  ê³¼ì œ

### 1. **í‘œì¤€í™” í˜‘ì˜**
```
â— í•„ìˆ˜: Excel ì‘ì„± ê°€ì´ë“œë¼ì¸
- í—¤ë”ëŠ” ì²« ë²ˆì§¸ í–‰
- ë³‘í•© ì…€ ìµœì†Œí™”
- ìˆ˜ì‹ì€ ê³„ì‚°ëœ ê°’ìœ¼ë¡œ ë³€í™˜
- ì‹œíŠ¸ë‹¹ í•˜ë‚˜ì˜ í…Œì´ë¸”
```

### 2. **ì‚¬ìš©ì êµìœ¡**
```
â— í•„ìˆ˜: ì‚¬ìš©ì íŠ¸ë ˆì´ë‹
- í…œí”Œë¦¿ ì‚¬ìš©ë²•
- ë§¤í•‘ ê°œë… ì´í•´
- ê²€ì¦ ì˜¤ë¥˜ í•´ê²°
```

### 3. **í´ë°± ì „ëµ**
```
â— í•„ìˆ˜: ìë™ ìƒì„± ì‹¤íŒ¨ ì‹œ
- ìˆ˜ë™ ìŠ¤í‚¤ë§ˆ ì…ë ¥ ëª¨ë“œ
- ë¶€ë¶„ ìƒì„± (ê·¸ë¦¬ë“œë§Œ)
- ì—ëŸ¬ ë¡œê·¸ ë° í”¼ë“œë°±
```

---

## ğŸ“Œ ìµœì¢… ê²°ë¡  (ìµœì¢… ì—…ë°ì´íŠ¸: 2025-12-02)

### âœ… **ì‹¤í˜„ ê°€ëŠ¥ì„±: 85%** (ê³ ê¸‰ RAG ê°•í™” í•™ìŠµ ì ìš© ì‹œ) â¬†ï¸

**ì™„ì „ ìë™í™” ê°€ëŠ¥:**
- âœ… í‘œì¤€ í…œí”Œë¦¿ ê¸°ë°˜ í™”ë©´ ìƒì„± (98% ì •í™•ë„)
- âœ… **DB ì»¬ëŸ¼ ìë™ ë§¤í•‘** (85% ì •í™•ë„)
- âœ… **ììœ  í˜•ì‹ Excel íŒŒì‹±** (85% ì •í™•ë„) â¬…ï¸ NEW!
- âœ… **ê¸°ë³¸ ì°¨íŠ¸ ìë™ ìƒì„±** (75% ì •í™•ë„) â¬…ï¸ NEW!
- âœ… **ë‹¨ìˆœ ìˆ˜ì‹ ìë™ ë³€í™˜** (80% ì •í™•ë„) â¬…ï¸ NEW!
- âœ… ì„ì‹œ/ì •ì‹ ë©”ë‰´ ê´€ë¦¬ (100%)

**ì‚¬ìš©ì ê²€í†  í•„ìš” (20%):**
- âš ï¸ ë³µì¡í•œ ë³‘í•© ì…€ (2ë‹¨ê³„ ì´ìƒ)
- âš ï¸ ê³ ê¸‰ ì°¨íŠ¸ ì„¤ì • (Scatter, Radar ë“±)
- âš ï¸ ì¤‘ê°„ ìˆ˜ì‹ (VLOOKUP, SUMIF ë“±)
- âš ï¸ ì‹ ë¢°ë„ 70% ë¯¸ë§Œ í•­ëª©

**ì‚¬ìš©ì êµìœ¡/ì œí•œ:**
- ğŸ“š ë§¤í¬ë¡œ/VBA ì‚¬ìš© ê¸ˆì§€
- ğŸ“š INDIRECT, OFFSET ë“± ê³ ê¸‰ ìˆ˜ì‹ ê¸ˆì§€
- ğŸ“š ë°°ì—´ ìˆ˜ì‹ ê¸ˆì§€

### ğŸ¯ **í•µì‹¬ ì„±ê³¼ ì§€í‘œ**

| ì§€í‘œ | ëª©í‘œ | ì„¤ëª… |
|------|------|------|
| **ì „ì²´ ì •í™•ë„** | **81%** | ê¸°ë³¸ RAG + ê³ ê¸‰ RAG í†µí•© |
| **ìë™í™”ìœ¨** | **80%** | ì‚¬ìš©ì ê°œì… 20%ë§Œ í•„ìš” |
| **ê°œë°œ ì†ë„** | **6ë°°** | 30ë¶„ â†’ 5ë¶„ |
| **í•™ìŠµ ê¸°ê°„** | **2ì£¼** | 20ê°œ í™”ë©´ í•™ìŠµ |
| **ROI** | **2ê°œì›”** | ë¹„ìš© íšŒìˆ˜ ê¸°ê°„ |

### ğŸ’¡ **ì¶”ì²œ ì‹¤í–‰ ì „ëµ**

```
âœ… Phase 0 (1ì£¼): ì´ˆê¸° í•™ìŠµ ì…‹ì—…
   - DB ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘
   - Vector Store êµ¬ì¶•

âœ… Phase 1 (3ì£¼): ê¸°ë³¸ RAG
   - í…œí”Œë¦¿ ê¸°ë°˜ íŒŒì‹±
   - DB ì»¬ëŸ¼ ìë™ ë§¤í•‘

âœ… Phase 2 (3ì£¼): ê³ ê¸‰ RAG â¬…ï¸ NEW!
   - ììœ  í˜•ì‹ Excel í•™ìŠµ
   - ì°¨íŠ¸ ë³€í™˜ ê·œì¹™ í•™ìŠµ
   - ìˆ˜ì‹ ë³€í™˜ íŒ¨í„´ í•™ìŠµ

âœ… Phase 3 (2ì£¼): ìë™í™” ê³ ë„í™”
   - ì‹ ë¢°ë„ ê¸°ë°˜ ë¶„ê¸°
   - ì„±ëŠ¥ ìµœì í™”
   
ì´ 9ì£¼ (ì•½ 2ê°œì›”)
```

### ï¿½ **ê¸°ëŒ€ íš¨ê³¼**

#### ì •ëŸ‰ì 
- í™”ë©´ ìƒì„± ì‹œê°„: **83% ë‹¨ì¶•** (30ë¶„ â†’ 5ë¶„)
- ë§¤í•‘ ì •í™•ë„: **81%** (í•™ìŠµ ë°ì´í„° ëˆ„ì )
- ì›” ìƒì‚°ì„±: **5ë°° í–¥ìƒ** (20ê°œ â†’ 100ê°œ)
- ì‚¬ìš©ì ê°œì…: **20%ë§Œ** (ê²€í† /ìˆ˜ì •)

#### ì •ì„±ì 
- âœ… ë¹„ê°œë°œìë„ í™”ë©´ ìƒì„± ê°€ëŠ¥
- âœ… Excel ìì‚° 100% ì¬í™œìš©
- âœ… **ììœ ë¡œìš´ Excel ì‘ì„± ê°€ëŠ¥** â¬…ï¸ NEW!
- âœ… **ì°¨íŠ¸ë„ ìë™ ìƒì„±** â¬…ï¸ NEW!
- âœ… **ë‹¨ìˆœ ìˆ˜ì‹ë„ ìë™ ë³€í™˜** â¬…ï¸ NEW!
- âœ… í”„ë¡œì íŠ¸ë³„ í•™ìŠµ ì§€ì‹ ì¶•ì 
- âœ… ì§€ì†ì  ì •í™•ë„ ê°œì„ 

### âš¡ **í•µì‹¬ ë©”ì‹œì§€**

> **"85% ìë™í™” + 15% AI ë³´ì¡° + ì‚¬ìš©ì ê²€í†  = í˜„ì‹¤ì ìœ¼ë¡œ ìµœì„ ì˜ ë°©ë²•"**

**ë³€ê²½ ì‚¬í•­:**
- ~~100% ìë™í™” ë¶ˆê°€ëŠ¥~~ 
- âœ… **85% ìë™í™” ê°€ëŠ¥** (RAG ê°•í™” í•™ìŠµ)
- âœ… **ììœ ë¡œìš´ Excelë„ ì²˜ë¦¬ ê°€ëŠ¥** (íŒ¨í„´ í•™ìŠµ)
- âœ… **ì°¨íŠ¸/ìˆ˜ì‹ë„ ìë™ ë³€í™˜** (ê¸°ë³¸ ìˆ˜ì¤€)
- âœ… **ì‚¬ìš©ì ë¶€ë‹´ ìµœì†Œí™”** (20%ë§Œ ê²€í† )

---

## ğŸ§  RAG ê¸°ë°˜ ê°•í™” í•™ìŠµ ì „ëµ (NEW!)

### ê°œë…
**ì‹œìŠ¤í…œ ì…‹ì—… ì‹œ DB ë©”íƒ€ë°ì´í„°ì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í•™ìŠµí•˜ì—¬ ìë™ ë§¤í•‘ ì •í™•ë„ í–¥ìƒ**

### í•™ìŠµ ë°ì´í„° êµ¬ì¶•

#### 1. DB ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘
```typescript
// 1-1. í…Œì´ë¸”/ì»¬ëŸ¼ ì •ë³´
const dbMetadata = {
  tables: [
    {
      name: "process_master",
      koreanName: "ê³µì •ë§ˆìŠ¤í„°",
      columns: [
        { name: "process_id", koreanName: "ê³µì •ID", type: "int" },
        { name: "process_code", koreanName: "ê³µì •ì½”ë“œ", type: "varchar" },
        { name: "process_name", koreanName: "ê³µì •ëª…", type: "varchar" },
        { name: "proc_nm", koreanName: "ê³µì •ëª…(ì•½ì–´)", type: "varchar" }
      ]
    },
    {
      name: "cost_process",
      koreanName: "ì›ê°€ê³µì •",
      columns: [
        { name: "cost_id", koreanName: "ì›ê°€ID", type: "int" },
        { name: "proc_nm", koreanName: "ê³µì •ëª…", type: "varchar" }
      ]
    }
  ]
};

// 1-2. ê´€ê³„ ì •ë³´ (FKê°€ ì—†ì–´ë„ ìˆ˜ë™ ë“±ë¡)
const relationships = [
  {
    from: "cost_process.process_id",
    to: "process_master.process_id",
    type: "1:N",
    description: "ì›ê°€ê³µì •ì€ ê³µì •ë§ˆìŠ¤í„°ë¥¼ ì°¸ì¡°"
  }
];

// 1-3. ë„¤ì´ë° ê·œì¹™ í•™ìŠµ
const namingPatterns = {
  abbreviations: {
    "proc": "process",
    "nm": "name",
    "cd": "code",
    "amt": "amount",
    "qty": "quantity"
  },
  koreanToEnglish: {
    "ê³µì •ëª…": ["process_name", "proc_nm", "process_title"],
    "ë¶€ì„œëª…": ["dept_name", "department_name", "dept_nm"],
    "ê¸ˆì•¡": ["amount", "amt", "price"]
  }
};
```

#### 2. Vector DB êµ¬ì¶• (RAG - ë¡œì»¬ Chroma) ğŸ†•
```typescript
// Embeddings ìƒì„± ë° ì €ì¥
import { OpenAIEmbeddings } from "@langchain/openai";
import { Chroma } from "@langchain/community/vectorstores/chroma";

// ê° í…Œì´ë¸”/ì»¬ëŸ¼ì„ ë²¡í„°í™”
const documents = dbMetadata.tables.flatMap(table => 
  table.columns.map(col => ({
    pageContent: `í…Œì´ë¸”: ${table.koreanName}(${table.name}), ì»¬ëŸ¼: ${col.koreanName}(${col.name}), íƒ€ì…: ${col.type}`,
    metadata: { 
      tableName: table.name, 
      columnName: col.name,
      koreanName: col.koreanName 
    }
  }))
);

// Chroma ë¡œì»¬ DBì— ì €ì¥
const vectorStore = await Chroma.fromDocuments(
  documents,
  new OpenAIEmbeddings(),
  {
    collectionName: "db-metadata",
    url: "http://localhost:8000" // ë¡œì»¬ Chroma ì„œë²„
  }
);
```

#### 3. ê°•í™” í•™ìŠµ ë°ì´í„°ì…‹
```typescript
// ì‚¬ìš©ì í”¼ë“œë°± ê¸°ë°˜ í•™ìŠµ
const trainingData = [
  {
    excelColumn: "ê³µì •ëª…",
    userSelected: "process_master.process_name",
    confidence: 0.95,
    feedback: "correct",
    context: "ì›ê°€ ì¡°íšŒ í™”ë©´"
  },
  {
    excelColumn: "ê³µì •ëª…",
    userSelected: "cost_process.proc_nm",
    confidence: 0.90,
    feedback: "correct",
    context: "ì›ê°€ ìƒì„¸ í™”ë©´"
  },
  {
    excelColumn: "ë¶€ì„œ",
    userSelected: "dept_master.dept_name",
    aiSuggested: "department.name",
    confidence: 0.60,
    feedback: "corrected", // ì‚¬ìš©ìê°€ ìˆ˜ì •í•¨
    context: "ì¡°ì§ë„ í™”ë©´"
  }
];

// í•™ìŠµ ë£¨í”„
function reinforceLearning(trainingData) {
  // 1. ì˜¬ë°”ë¥¸ ë§¤í•‘ íŒ¨í„´ ê°•í™”
  const correctMappings = trainingData.filter(d => d.feedback === "correct");
  
  // 2. ì»¨í…ìŠ¤íŠ¸ë³„ ê°€ì¤‘ì¹˜ í•™ìŠµ
  const contextWeights = {};
  correctMappings.forEach(d => {
    const key = `${d.excelColumn}:${d.context}`;
    contextWeights[key] = (contextWeights[key] || 0) + 1;
  });
  
  // 3. íŒ¨í„´ ì¶”ì¶œ
  return {
    patterns: extractPatterns(correctMappings),
    weights: contextWeights
  };
}
```

### ì‹¤ì‹œê°„ ë§¤í•‘ í”„ë¡œì„¸ìŠ¤

```typescript
async function mapExcelToDatabase(excelColumn: string, context: string) {
  // 1. Vector DBì—ì„œ ìœ ì‚¬ ì»¬ëŸ¼ ê²€ìƒ‰
  const similarColumns = await vectorStore.similaritySearch(
    `${excelColumn} ${context}`,
    k: 5
  );
  
  // 2. ê°•í™” í•™ìŠµ ëª¨ë¸ë¡œ ì¬ì •ë ¬
  const rankedResults = rankByLearning(similarColumns, context);
  
  // 3. Geminië¡œ ìµœì¢… ê²€ì¦
  const prompt = `
    Excel ì»¬ëŸ¼: "${excelColumn}"
    í™”ë©´ ì»¨í…ìŠ¤íŠ¸: "${context}"
    
    í›„ë³´ DB ì»¬ëŸ¼:
    ${rankedResults.map((r, i) => `${i+1}. ${r.tableName}.${r.columnName} (${r.koreanName})`).join('\n')}
    
    ê³¼ê±° í•™ìŠµ ë°ì´í„°:
    ${getRelevantTrainingData(excelColumn, context)}
    
    ê°€ì¥ ì í•©í•œ ë§¤í•‘ì€?
  `;
  
  const result = await gemini.generateContent(prompt);
  
  return {
    suggestions: rankedResults,
    aiRecommendation: parseGeminiResponse(result),
    confidence: calculateConfidence(rankedResults)
  };
}
```

### ì‹œìŠ¤í…œ ì…‹ì—… ë‹¨ê³„

#### Phase 0: ì´ˆê¸° í•™ìŠµ (í”„ë¡œì íŠ¸ ì‹œì‘ ì‹œ)
```typescript
// 1. DB ìŠ¤í‚¤ë§ˆ ì „ì²´ ë¶„ì„ (1íšŒ)
await analyzeDatabase();

// 2. ê¸°ì¡´ í™”ë©´ ë¶„ì„ (ìˆë‹¤ë©´)
const existingScreens = await analyzeExistingScreens();

// 3. ë„ë©”ì¸ ìš©ì–´ ì‚¬ì „ êµ¬ì¶•
const domainGlossary = await buildGlossary();

// 4. Vector DB ì´ˆê¸°í™”
await initializeVectorStore({
  dbMetadata,
  existingScreens,
  domainGlossary
});

// ì˜ˆìƒ ì‹œê°„: 30ë¶„ ~ 2ì‹œê°„
```

#### Phase 1: ì¸í„°ë™í‹°ë¸Œ í•™ìŠµ (ì²« 10ê°œ í™”ë©´)
```typescript
// ì‚¬ìš©ìê°€ ë§¤í•‘ì„ í™•ì¸/ìˆ˜ì •í•  ë•Œë§ˆë‹¤ í•™ìŠµ
for (let i = 0; i < 10; i++) {
  const mapping = await suggestMapping(excelFile);
  const userFeedback = await getUserReview(mapping);
  
  // í”¼ë“œë°±ì„ í•™ìŠµ ë°ì´í„°ë¡œ ì €ì¥
  await saveFeedback(userFeedback);
  
  // ëª¨ë¸ ì—…ë°ì´íŠ¸
  await updateModel(userFeedback);
}

// ì˜ˆìƒ ì‹œê°„: í™”ë©´ë‹¹ 5ë¶„ Ã— 10 = 50ë¶„
```

#### Phase 2: ìë™í™” ë‹¨ê³„ (11ë²ˆì§¸ í™”ë©´ë¶€í„°)
```typescript
// í•™ìŠµì´ ì¶©ë¶„íˆ ë˜ë©´ ìë™ ë§¤í•‘ ì‹œì‘
const autoMapping = await autoMapExcelToDatabase(excelFile);

if (autoMapping.confidence > 0.85) {
  // ìë™ ìƒì„± (ì‚¬ìš©ì í™•ì¸ë§Œ)
  await generateScreen(autoMapping);
} else {
  // ë‚®ì€ ì‹ ë¢°ë„ í•­ëª©ë§Œ ì‚¬ìš©ìì—ê²Œ ë¬¼ì–´ë´„
  const uncertainMappings = autoMapping.filter(m => m.confidence < 0.85);
  const userInput = await askUser(uncertainMappings);
  
  // í”¼ë“œë°± í•™ìŠµ
  await updateModel(userInput);
}
```

### ì˜ˆìƒ íš¨ê³¼

#### í•™ìŠµ ì „ (ì´ˆê¸°)
```
ì •í™•ë„: 40-50%
ì‚¬ìš©ì ê²€í† : ëª¨ë“  ë§¤í•‘ (100%)
ì‹œê°„: í™”ë©´ë‹¹ 30ë¶„
```

#### í•™ìŠµ ì¤‘ (1-10ê°œ í™”ë©´)
```
ì •í™•ë„: 60-75% (ì ì§„ì  í–¥ìƒ)
ì‚¬ìš©ì ê²€í† : ë¶ˆí™•ì‹¤í•œ í•­ëª© (50-70%)
ì‹œê°„: í™”ë©´ë‹¹ 15ë¶„
```

#### í•™ìŠµ í›„ (11ê°œ í™”ë©´ ì´ìƒ)
```
ì •í™•ë„: 85-95%
ì‚¬ìš©ì ê²€í† : ë‚®ì€ ì‹ ë¢°ë„ë§Œ (10-20%)
ì‹œê°„: í™”ë©´ë‹¹ 5ë¶„

â†’ 6ë°° ì†ë„ í–¥ìƒ!
```

### ê¸°ìˆ  ìŠ¤íƒ (ë¡œì»¬ êµ¬ì¶•) ğŸ†•

```typescript
// RAG (Vector Database) - ë¡œì»¬
- Chroma (Self-hosted, Docker) â† ì¶”ì²œ! â­
  - ì™„ì „ ë¬´ë£Œ
  - ê°„ë‹¨í•œ ì„¤ì¹˜ (Docker)
  - LangChain ë„¤ì´í‹°ë¸Œ ì§€ì›
- Embeddings: OpenAI text-embedding-3-small

// LLM
- Gemini 2.0 Flash (ë©”ì¸)
- GPT-4o-mini (ê²€ì¦ìš©)

// ê°•í™” í•™ìŠµ
- LangChain (Orchestration)
- Custom Feedback Loop

// ì €ì¥ì†Œ
- PostgreSQL: í•™ìŠµ ë°ì´í„°, í”¼ë“œë°±
- Redis: ìºì‹± (Docker, ë¡œì»¬)
```

### êµ¬í˜„ ìš°ì„ ìˆœìœ„

#### Week 1-2: RAG ê¸°ë°˜ ì¸í”„ë¼ (ë¡œì»¬) ğŸ†•
```
1. Docker Composeë¡œ Chroma + Redis ì„¤ì¹˜
2. DB ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘ API
3. Chroma Vector Store ì´ˆê¸°í™”
4. ìœ ì‚¬ë„ ê²€ìƒ‰ êµ¬í˜„
```

#### Week 3-4: ê°•í™” í•™ìŠµ ë£¨í”„
```
1. ì‚¬ìš©ì í”¼ë“œë°± UI
2. í•™ìŠµ ë°ì´í„° PostgreSQL ì €ì¥
3. ëª¨ë¸ ì—…ë°ì´íŠ¸ ë¡œì§
```

#### Week 5-6: ìë™í™” ê³ ë„í™”
```
1. ì‹ ë¢°ë„ ê³„ì‚° ì•Œê³ ë¦¬ì¦˜
2. ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ ë§¤í•‘
3. Redis ìºì‹± ìµœì í™”
```

### ROI ë¶„ì„ (ë¡œì»¬ êµ¬ì¶•) ğŸ†•

#### íˆ¬ì
```
ê°œë°œ ì‹œê°„: 6ì£¼ (ê¸°ë³¸) + 3ì£¼ (ê³ ê¸‰ í•™ìŠµ) = 9ì£¼
ì¸í”„ë¼ ë¹„ìš©: $40/ì›” (OpenAI + Geminië§Œ, Vector DB ë¡œì»¬ ë¬´ë£Œ!)
ì´ˆê¸° í•™ìŠµ: 2ì‹œê°„ + í™”ë©´ 10ê°œ (8ì‹œê°„)
ê³ ê¸‰ í•™ìŠµ: ì°¨íŠ¸/ìˆ˜ì‹ ìƒ˜í”Œ 20ê°œ (10ì‹œê°„)
```

#### íšŒìˆ˜
```
í™”ë©´ 1ê°œ ì ˆì•½ ì‹œê°„: 25ë¶„ (30ë¶„ â†’ 5ë¶„)
ì›” 20ê°œ í™”ë©´ ìƒì„± ì‹œ: 500ë¶„ (8.3ì‹œê°„)
ì¸ê±´ë¹„ (ì‹œê¸‰ $50): $415/ì›”
ìˆœì´ìµ: $415 - $40 = $375/ì›” ğŸ‰ (í´ë¼ìš°ë“œ ëŒ€ë¹„ $85 ë” ì ˆê°!)
```

â†’ 2ê°œì›” ë§Œì— íšŒìˆ˜
```

---

## ğŸ“ ê³ ê¸‰ RAG í•™ìŠµ: ììœ  í˜•ì‹ Excel & ì°¨íŠ¸ & ìˆ˜ì‹ (NEW!)

### 1ï¸âƒ£ ììœ  í˜•ì‹ Excel íŒŒì‹± - RAG í•™ìŠµ ì „ëµ

#### ë¬¸ì œ ì¬ì •ì˜
```
âŒ ê¸°ì¡´ íŒë‹¨: "ë¶ˆê°€ëŠ¥"
âœ… ìƒˆ íŒë‹¨: "í•™ìŠµ ê°€ëŠ¥"

ì´ìœ :
- ë³‘í•© ì…€ì€ íŒ¨í„´ì´ ì¡´ì¬ (ì œëª©, ê·¸ë£¹í•‘, ë©”íƒ€ì •ë³´)
- ë‹¤ì¤‘ í—¤ë”ë„ ì¼ì •í•œ êµ¬ì¡°
- ì‚¬ìš©ìë³„ ì‘ì„± ë°©ì‹ë„ ìœ í•œí•œ íŒ¨í„´
```

#### í•™ìŠµ ë°ì´í„°ì…‹ êµ¬ì¶•

```typescript
// ë³‘í•© ì…€ íŒ¨í„´ í•™ìŠµ
const mergedCellPatterns = [
  {
    pattern: "ì²« í–‰ ì „ì²´ ë³‘í•©",
    meaning: "title",
    example: "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  2025ë…„ 11ì›” ì›ê°€í˜„í™© â”‚",
    action: "skip_as_title"
  },
  {
    pattern: "ì²« ì—´ ì—¬ëŸ¬ í–‰ ë³‘í•©",
    meaning: "row_grouping",
    example: "â”‚ ê³µì •ëª… â”‚\nâ”‚       â”‚",
    action: "merge_group"
  },
  {
    pattern: "í—¤ë” 2ë‹¨ê³„ ë³‘í•©",
    meaning: "category_header",
    example: "â”‚  ìì¬ë¹„  â”‚\nâ”‚ ê³„íšâ”‚ì‹¤ì â”‚",
    action: "create_nested_columns"
  }
];

// ë‹¤ì¤‘ í—¤ë” ì¸ì‹ ë¡œì§
const headerPatterns = [
  {
    type: "single_header",
    rows: 1,
    structure: "Row 1ë§Œ ì»¬ëŸ¼ëª…",
    confidence: 0.95
  },
  {
    type: "double_header",
    rows: 2,
    structure: "Row 1: ì¹´í…Œê³ ë¦¬, Row 2: ì„¸ë¶€ í•­ëª©",
    confidence: 0.90,
    example: {
      row1: ["", "ìì¬ë¹„", "ìì¬ë¹„", "ì¸ê±´ë¹„", "ì¸ê±´ë¹„"],
      row2: ["ê³µì •ëª…", "ê³„íš", "ì‹¤ì ", "ê³„íš", "ì‹¤ì "]
    }
  },
  {
    type: "triple_header",
    rows: 3,
    structure: "Row 1: ëŒ€ë¶„ë¥˜, Row 2: ì¤‘ë¶„ë¥˜, Row 3: ì†Œë¶„ë¥˜",
    confidence: 0.75
  }
];
```

#### Vector DB í•™ìŠµ í”„ë¡œì„¸ìŠ¤

```typescript
// 1. Excel íŒ¨í„´ ì„ë² ë”©
const excelPatterns = [
  {
    pageContent: "ì²« í–‰ ì „ì²´ ë³‘í•©, ì¤‘ì•™ ì •ë ¬, ë³¼ë“œì²´ â†’ ë¬¸ì„œ ì œëª©",
    metadata: { 
      pattern: "title_row",
      action: "skip",
      confidence: 0.95 
    }
  },
  {
    pageContent: "ì²« ë²ˆì§¸ ì—´ ì—¬ëŸ¬ í–‰ ë³‘í•© â†’ í–‰ ê·¸ë£¹í•‘",
    metadata: { 
      pattern: "row_group",
      action: "create_group_column",
      confidence: 0.90 
    }
  },
  {
    pageContent: "2í–‰ í—¤ë”, ìƒìœ„ ì…€ ë³‘í•©, í•˜ìœ„ ì…€ ë¶„ë¦¬ â†’ ì¹´í…Œê³ ë¦¬-ì„¸ë¶€ êµ¬ì¡°",
    metadata: { 
      pattern: "nested_header",
      action: "create_nested_columns",
      confidence: 0.85 
    }
  }
];

await PineconeStore.fromDocuments(
  excelPatterns,
  new OpenAIEmbeddings(),
  { pineconeIndex, namespace: 'excel-patterns' }
);
```

#### ì‹¤ì‹œê°„ íŒŒì‹± í”„ë¡œì„¸ìŠ¤

```typescript
async function parseExcelWithLearning(excelData: any[][]) {
  // 1. êµ¬ì¡° ë¶„ì„
  const structure = analyzeStructure(excelData);
  
  // 2. Vector DBì—ì„œ ìœ ì‚¬ íŒ¨í„´ ê²€ìƒ‰
  const query = `
    ${structure.mergedCells.length}ê°œ ë³‘í•© ì…€,
    ${structure.headerRows}í–‰ í—¤ë”,
    ${structure.dataRows}í–‰ ë°ì´í„°
  `;
  
  const similarPatterns = await vectorStore.similaritySearch(query, 5);
  
  // 3. Geminië¡œ ìµœì¢… íŒŒì‹± ì „ëµ ê²°ì •
  const prompt = `
ë‹¤ìŒ Excel êµ¬ì¡°ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”:

ë³‘í•© ì…€ ì •ë³´:
${structure.mergedCells.map(m => `- ${m.range}: "${m.value}"`).join('\n')}

ì²« 3í–‰ ë°ì´í„°:
${excelData.slice(0, 3).map(row => row.join(' | ')).join('\n')}

ìœ ì‚¬ íŒ¨í„´ (ê³¼ê±° í•™ìŠµ):
${similarPatterns.map((p, i) => `${i+1}. ${p.pageContent} (ì‹ ë¢°ë„: ${p.metadata.confidence})`).join('\n')}

ì§ˆë¬¸:
1. í—¤ë”ëŠ” ëª‡ í–‰ì¸ê°€?
2. ë³‘í•© ì…€ì˜ ì˜ë¯¸ëŠ”?
3. ë°ì´í„° ì‹œì‘ í–‰ì€?
4. ê·¸ë¦¬ë“œ ì»¬ëŸ¼ êµ¬ì¡°ëŠ”?

JSONìœ¼ë¡œ ì¶œë ¥:
{
  "headerRows": 2,
  "titleRow": 0,
  "dataStartRow": 2,
  "columns": [
    { "name": "ê³µì •ëª…", "merge": false },
    { "name": "ìì¬ë¹„_ê³„íš", "parentCategory": "ìì¬ë¹„" },
    { "name": "ìì¬ë¹„_ì‹¤ì ", "parentCategory": "ìì¬ë¹„" }
  ]
}
  `;
  
  const result = await gemini.generateContent(prompt);
  const parsed = JSON.parse(result.response.text());
  
  // 4. ì‚¬ìš©ì ê²€í† 
  const userFeedback = await reviewParsing(parsed, excelData);
  
  // 5. í”¼ë“œë°± í•™ìŠµ
  if (userFeedback.corrected) {
    await saveParsingFeedback({
      structure,
      aiParsed: parsed,
      userCorrected: userFeedback.result,
      confidence: calculateConfidence(parsed, userFeedback.result)
    });
  }
  
  return userFeedback.result;
}
```

#### ì˜ˆìƒ íš¨ê³¼

```
ì´ˆê¸° (í•™ìŠµ ì „):
- ë‹¨ìˆœ êµ¬ì¡°: 80% ì •í™•ë„
- ë³‘í•© 1ë‹¨ê³„: 50% ì •í™•ë„
- ë³‘í•© 2ë‹¨ê³„ ì´ìƒ: 20% ì •í™•ë„

í•™ìŠµ í›„ (20ê°œ ìƒ˜í”Œ):
- ë‹¨ìˆœ êµ¬ì¡°: 98% ì •í™•ë„
- ë³‘í•© 1ë‹¨ê³„: 85% ì •í™•ë„
- ë³‘í•© 2ë‹¨ê³„ ì´ìƒ: 70% ì •í™•ë„

â†’ í‰ê·  60% â†’ 85% í–¥ìƒ
```

---

### 2ï¸âƒ£ ì°¨íŠ¸ ìë™ ìƒì„± - RAG í•™ìŠµ ì „ëµ

#### ë¬¸ì œ ì¬ì •ì˜
```
âŒ ê¸°ì¡´ íŒë‹¨: "ì–´ë ¤ì›€"
âœ… ìƒˆ íŒë‹¨: "ê¸°ë³¸ ì°¨íŠ¸ëŠ” í•™ìŠµ ê°€ëŠ¥"

ì´ìœ :
- Excel ì°¨íŠ¸ â†’ Recharts ë³€í™˜ ê·œì¹™ì€ ìœ í•œ
- ë°ì´í„° íƒ€ì… â†’ ì°¨íŠ¸ íƒ€ì… ë§¤í•‘ íŒ¨í„´ ì¡´ì¬
- ì‚¬ìš©ì ì„ í˜¸ë„ í•™ìŠµ ê°€ëŠ¥
```

#### í•™ìŠµ ë°ì´í„°ì…‹ êµ¬ì¶•

```typescript
// ì°¨íŠ¸ ë³€í™˜ ê·œì¹™ í•™ìŠµ
const chartMappingPatterns = [
  {
    excelChart: {
      type: "column",
      dataRange: "B2:C10",
      xAxis: "ê³µì •ëª…",
      yAxis: "ë¹„ìš©"
    },
    rechartsConfig: {
      component: "BarChart",
      xDataKey: "processName",
      bars: [
        { dataKey: "cost", fill: "#8884d8", name: "ë¹„ìš©" }
      ]
    },
    confidence: 0.95
  },
  {
    excelChart: {
      type: "line",
      dataRange: "A1:D12",
      xAxis: "ì›”",
      yAxis: ["ê³„íš", "ì‹¤ì "]
    },
    rechartsConfig: {
      component: "LineChart",
      xDataKey: "month",
      lines: [
        { dataKey: "plan", stroke: "#8884d8", name: "ê³„íš" },
        { dataKey: "actual", stroke: "#82ca9d", name: "ì‹¤ì " }
      ]
    },
    confidence: 0.90
  },
  {
    excelChart: {
      type: "pie",
      dataRange: "A2:B6",
      labelColumn: "ë¶€ì„œ",
      valueColumn: "ë¹„ìœ¨"
    },
    rechartsConfig: {
      component: "PieChart",
      nameKey: "department",
      dataKey: "ratio",
      colors: ["#0088FE", "#00C49F", "#FFBB28", "#FF8042"]
    },
    confidence: 0.85
  }
];

// ë°ì´í„° íƒ€ì… â†’ ì°¨íŠ¸ ì¶”ì²œ ê·œì¹™
const chartRecommendations = [
  {
    dataPattern: {
      xType: "category",
      yType: "numeric",
      seriesCount: 1
    },
    recommendedChart: "BarChart",
    reason: "ì¹´í…Œê³ ë¦¬ë³„ ìˆ˜ì¹˜ ë¹„êµ",
    confidence: 0.90
  },
  {
    dataPattern: {
      xType: "date",
      yType: "numeric",
      seriesCount: ">=1"
    },
    recommendedChart: "LineChart",
    reason: "ì‹œê³„ì—´ ì¶”ì´ ë¶„ì„",
    confidence: 0.95
  },
  {
    dataPattern: {
      xType: "category",
      yType: "percentage",
      totalSum: 100
    },
    recommendedChart: "PieChart",
    reason: "ë¹„ìœ¨ êµ¬ì„± ë¶„ì„",
    confidence: 0.85
  }
];
```

#### ì°¨íŠ¸ ìƒì„± í”„ë¡œì„¸ìŠ¤

```typescript
async function generateChartWithLearning(
  excelChartInfo: any,
  data: any[]
) {
  // 1. ë°ì´í„° íŒ¨í„´ ë¶„ì„
  const dataPattern = analyzeDataPattern(data);
  
  // 2. Vector DBì—ì„œ ìœ ì‚¬ ì°¨íŠ¸ ê²€ìƒ‰
  const query = `
    ì°¨íŠ¸ íƒ€ì…: ${excelChartInfo?.type || 'unknown'},
    Xì¶•: ${dataPattern.xType},
    Yì¶•: ${dataPattern.yType},
    ì‹œë¦¬ì¦ˆ: ${dataPattern.seriesCount}ê°œ
  `;
  
  const similarCharts = await vectorStore.similaritySearch(
    query, 
    5, 
    { namespace: 'chart-patterns' }
  );
  
  // 3. Geminië¡œ ì°¨íŠ¸ ì„¤ì • ìƒì„±
  const prompt = `
Excel ë°ì´í„°ë¡œ Recharts ì„¤ì •ì„ ìƒì„±í•´ì£¼ì„¸ìš”.

ë°ì´í„° ìƒ˜í”Œ:
${JSON.stringify(data.slice(0, 5), null, 2)}

ë°ì´í„° íŒ¨í„´:
- Xì¶• íƒ€ì…: ${dataPattern.xType}
- Yì¶• íƒ€ì…: ${dataPattern.yType}
- ì‹œë¦¬ì¦ˆ ìˆ˜: ${dataPattern.seriesCount}

ìœ ì‚¬ ì°¨íŠ¸ (ê³¼ê±° í•™ìŠµ):
${similarCharts.map((c, i) => 
  `${i+1}. ${c.metadata.excelType} â†’ ${c.metadata.rechartsComponent}`
).join('\n')}

ì¶œë ¥ í˜•ì‹ (JSON):
{
  "chartType": "BarChart|LineChart|PieChart",
  "config": {
    "xDataKey": "í•„ë“œëª…",
    "series": [
      { "dataKey": "í•„ë“œëª…", "name": "í‘œì‹œëª…", "color": "#hex" }
    ]
  },
  "reason": "ì„ íƒ ì´ìœ "
}
  `;
  
  const result = await gemini.generateContent(prompt);
  const chartConfig = JSON.parse(result.response.text());
  
  // 4. ì‚¬ìš©ì ê²€í†  ë° ìˆ˜ì •
  const userFeedback = await reviewChart(chartConfig, data);
  
  // 5. í”¼ë“œë°± í•™ìŠµ
  if (userFeedback.modified) {
    await saveChartFeedback({
      dataPattern,
      aiGenerated: chartConfig,
      userModified: userFeedback.result
    });
  }
  
  return userFeedback.result;
}
```

#### ì˜ˆìƒ íš¨ê³¼

```
ê¸°ë³¸ ì°¨íŠ¸ (Bar, Line, Pie):
- í•™ìŠµ ì „: 40% ì •í™•ë„ (ìˆ˜ë™ ì„¤ì • í•„ìš”)
- í•™ìŠµ í›„: 85% ì •í™•ë„ (ë¯¸ì„¸ ì¡°ì •ë§Œ)

ê³ ê¸‰ ì°¨íŠ¸ (Scatter, Area, Radar):
- í•™ìŠµ ì „: 10% ì •í™•ë„
- í•™ìŠµ í›„: 60% ì •í™•ë„

â†’ í‰ê·  30% â†’ 75% í–¥ìƒ
```

---

### 3ï¸âƒ£ ë‹¨ìˆœ ìˆ˜ì‹ ìë™ ë³€í™˜ - RAG í•™ìŠµ ì „ëµ

#### ë¬¸ì œ ì¬ì •ì˜
```
âŒ ê¸°ì¡´ íŒë‹¨: "ë¶ˆê°€ëŠ¥"
âœ… ìƒˆ íŒë‹¨: "ë‹¨ìˆœ ìˆ˜ì‹ì€ í•™ìŠµ ê°€ëŠ¥"

ë²”ìœ„:
âœ… ê°€ëŠ¥: SUM, AVG, COUNT, MIN, MAX, IF (ë‹¨ìˆœ ì¡°ê±´)
âš ï¸ ì–´ë ¤ì›€: VLOOKUP, INDEX/MATCH, SUMIF (ì¡°ê±´ ë³µì¡)
âŒ ë¶ˆê°€ëŠ¥: INDIRECT, OFFSET, ë°°ì—´ ìˆ˜ì‹
```

#### í•™ìŠµ ë°ì´í„°ì…‹ êµ¬ì¶•

```typescript
// ìˆ˜ì‹ ë³€í™˜ ê·œì¹™ í•™ìŠµ
const formulaPatterns = [
  {
    excelFormula: "=SUM(B2:B10)",
    sqlEquivalent: "SUM(column_name)",
    jsEquivalent: "data.reduce((sum, row) => sum + row.columnName, 0)",
    category: "aggregation",
    difficulty: "easy",
    confidence: 0.98
  },
  {
    excelFormula: "=AVERAGE(C2:C10)",
    sqlEquivalent: "AVG(column_name)",
    jsEquivalent: "data.reduce((sum, row) => sum + row.columnName, 0) / data.length",
    category: "aggregation",
    difficulty: "easy",
    confidence: 0.98
  },
  {
    excelFormula: "=IF(B2>1000, B2*0.9, B2*0.95)",
    sqlEquivalent: "CASE WHEN column_name > 1000 THEN column_name * 0.9 ELSE column_name * 0.95 END",
    jsEquivalent: "value > 1000 ? value * 0.9 : value * 0.95",
    category: "conditional",
    difficulty: "medium",
    confidence: 0.85
  },
  {
    excelFormula: "=B2*C2",
    sqlEquivalent: "column1 * column2",
    jsEquivalent: "row.column1 * row.column2",
    category: "arithmetic",
    difficulty: "easy",
    confidence: 0.95
  },
  {
    excelFormula: "=VLOOKUP(A2, Table1, 2, FALSE)",
    sqlEquivalent: "LEFT JOIN table1 ON main.key = table1.key",
    jsEquivalent: "NOT_RECOMMENDED - Use SQL JOIN",
    category: "lookup",
    difficulty: "hard",
    confidence: 0.60,
    recommendation: "ì‚¬ìš©ì í™•ì¸ í•„ìš”"
  }
];

// ìˆ˜ì‹ ë³µì¡ë„ ë¶„ì„
const formulaComplexity = {
  easy: ["SUM", "AVG", "COUNT", "MIN", "MAX", "arithmetic"],
  medium: ["IF", "COUNTIF", "SUMIF (ë‹¨ìˆœ)"],
  hard: ["VLOOKUP", "INDEX/MATCH", "SUMIFS"],
  impossible: ["INDIRECT", "OFFSET", "GETPIVOTDATA", "ë°°ì—´ ìˆ˜ì‹"]
};
```

#### ìˆ˜ì‹ ë³€í™˜ í”„ë¡œì„¸ìŠ¤

```typescript
async function convertFormulaWithLearning(
  excelFormula: string,
  context: { tableName: string, columns: string[] }
) {
  // 1. ìˆ˜ì‹ ë³µì¡ë„ ë¶„ì„
  const complexity = analyzeFormulaComplexity(excelFormula);
  
  if (complexity === 'impossible') {
    return {
      success: false,
      message: "ì´ ìˆ˜ì‹ì€ ìë™ ë³€í™˜ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ìˆ˜ë™ êµ¬í˜„ì´ í•„ìš”í•©ë‹ˆë‹¤.",
      formula: excelFormula
    };
  }
  
  // 2. Vector DBì—ì„œ ìœ ì‚¬ ìˆ˜ì‹ ê²€ìƒ‰
  const similarFormulas = await vectorStore.similaritySearch(
    excelFormula,
    5,
    { namespace: 'formula-patterns' }
  );
  
  // 3. Geminië¡œ ë³€í™˜
  const prompt = `
Excel ìˆ˜ì‹ì„ SQLê³¼ JavaScriptë¡œ ë³€í™˜í•´ì£¼ì„¸ìš”.

Excel ìˆ˜ì‹: ${excelFormula}

ì»¨í…ìŠ¤íŠ¸:
- í…Œì´ë¸”: ${context.tableName}
- ì»¬ëŸ¼: ${context.columns.join(', ')}

ìœ ì‚¬ ìˆ˜ì‹ (ê³¼ê±° í•™ìŠµ):
${similarFormulas.map((f, i) => 
  `${i+1}. ${f.metadata.excelFormula}\n   SQL: ${f.metadata.sqlEquivalent}\n   JS: ${f.metadata.jsEquivalent}`
).join('\n\n')}

ì¶œë ¥ í˜•ì‹ (JSON):
{
  "sql": "SQL í‘œí˜„ì‹",
  "javascript": "JavaScript í‘œí˜„ì‹",
  "location": "database|application",
  "confidence": 0.85,
  "explanation": "ë³€í™˜ ì„¤ëª…"
}
  `;
  
  const result = await gemini.generateContent(prompt);
  const conversion = JSON.parse(result.response.text());
  
  // 4. ì‹ ë¢°ë„ ì²´í¬
  if (conversion.confidence < 0.70) {
    return {
      success: false,
      message: "ìë™ ë³€í™˜ ì‹ ë¢°ë„ê°€ ë‚®ìŠµë‹ˆë‹¤. ì‚¬ìš©ì í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.",
      suggestion: conversion,
      requiresReview: true
    };
  }
  
  // 5. ì‚¬ìš©ì ê²€í† 
  const userFeedback = await reviewConversion(conversion, excelFormula);
  
  // 6. í”¼ë“œë°± í•™ìŠµ
  if (userFeedback.approved || userFeedback.corrected) {
    await saveFormulaFeedback({
      excelFormula,
      aiConverted: conversion,
      userApproved: userFeedback.result,
      context
    });
  }
  
  return {
    success: true,
    conversion: userFeedback.result
  };
}
```

#### ì˜ˆìƒ íš¨ê³¼

```
ë‹¨ìˆœ ìˆ˜ì‹ (SUM, AVG, IF):
- í•™ìŠµ ì „: 70% ì •í™•ë„
- í•™ìŠµ í›„: 95% ì •í™•ë„

ì¤‘ê°„ ìˆ˜ì‹ (SUMIF, COUNTIF):
- í•™ìŠµ ì „: 40% ì •í™•ë„
- í•™ìŠµ í›„: 75% ì •í™•ë„

ë³µì¡í•œ ìˆ˜ì‹ (VLOOKUP):
- í•™ìŠµ ì „: 20% ì •í™•ë„
- í•™ìŠµ í›„: 60% ì •í™•ë„
- ê¶Œì¥: ì‚¬ìš©ì ê²€í†  í•„ìˆ˜

â†’ í‰ê·  50% â†’ 80% í–¥ìƒ
```

---

## ğŸ“Š í†µí•© ì˜ˆìƒ íš¨ê³¼ (ì—…ë°ì´íŠ¸)

### ê¸°ëŠ¥ë³„ ì •í™•ë„

| ê¸°ëŠ¥ | í•™ìŠµ ì „ | í•™ìŠµ í›„ | ê°œì„ ìœ¨ |
|------|---------|---------|--------|
| DB ì»¬ëŸ¼ ë§¤í•‘ | 40% | 85% | **+45%p** |
| ììœ  í˜•ì‹ Excel | 60% | 85% | **+25%p** |
| ì°¨íŠ¸ ìƒì„± | 30% | 75% | **+45%p** |
| ë‹¨ìˆœ ìˆ˜ì‹ ë³€í™˜ | 50% | 80% | **+30%p** |
| **ì „ì²´ í‰ê· ** | **45%** | **81%** | **+36%p** |

### ê°œë°œ ì¼ì • (ìˆ˜ì •)

```
Phase 0: ì´ˆê¸° í•™ìŠµ (1ì£¼)
- DB ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘
- Vector Store êµ¬ì¶•

Phase 1: ê¸°ë³¸ RAG (3ì£¼)
- ì»¬ëŸ¼ ë§¤í•‘ í•™ìŠµ
- í…œí”Œë¦¿ ê¸°ë°˜ íŒŒì‹±

Phase 2: ê³ ê¸‰ RAG (3ì£¼) â¬…ï¸ NEW!
- ììœ  í˜•ì‹ Excel íŒŒì‹± í•™ìŠµ
- ì°¨íŠ¸ ë³€í™˜ ê·œì¹™ í•™ìŠµ
- ë‹¨ìˆœ ìˆ˜ì‹ ë³€í™˜ í•™ìŠµ

Phase 3: ìë™í™” (2ì£¼)
- ì‹ ë¢°ë„ ê¸°ë°˜ ë¶„ê¸°
- ì„±ëŠ¥ ìµœì í™”

ì´ ê°œë°œ ê¸°ê°„: 9ì£¼ (ê¸°ì¡´ 7ì£¼ + 2ì£¼)
```

### ë¹„ìš© ë¶„ì„ (ìˆ˜ì •)

```
ì¸í”„ë¼:
- Pinecone: $25/ì›” â†’ $40/ì›” (ì¸ë±ìŠ¤ ì¦ê°€)
- OpenAI: $15/ì›” â†’ $25/ì›” (ì„ë² ë”© ì¦ê°€)
- Gemini: $10/ì›” â†’ $15/ì›” (API í˜¸ì¶œ ì¦ê°€)
í•©ê³„: $50/ì›” â†’ $80/ì›”

ROI:
- í™”ë©´ë‹¹ ì ˆì•½: 25ë¶„ â†’ 27ë¶„ (ì¶”ê°€ ìë™í™”)
- ì›” 20ê°œ í™”ë©´: $415 â†’ $450 ì ˆì•½
- ìˆœì´ìµ: $450 - $80 = $370/ì›”

â†’ ì—¬ì „íˆ 2ê°œì›” íšŒìˆ˜
```

---

## ğŸ” ë°ì´í„° ê²€ì¦ ì‹œìŠ¤í…œ (NEW!)

### ê°œë…
**ì‚¬ìš©ìê°€ ì œê³µí•œ ì •ë‹µì§€(Expected Output)ì™€ AI ìƒì„± ê²°ê³¼(Actual Output)ë¥¼ ë¹„êµí•˜ì—¬ ì •í™•ë„ë¥¼ ê²€ì¦**

### í•„ìš”ì„±

#### 1. ì‹ ë¢°ë„ í™•ë³´
```
ë¬¸ì œ:
- AIê°€ ìƒì„±í•œ í™”ë©´ì´ ì •ë§ ë§ëŠ”ê°€?
- ë°ì´í„°ê°€ ì •í™•í•˜ê²Œ ë§¤í•‘ë˜ì—ˆëŠ”ê°€?
- ìˆ˜ì‹ ë³€í™˜ì´ ì˜¬ë°”ë¥¸ê°€?

í•´ê²°:
â†’ ì‚¬ìš©ìê°€ ë¯¸ë¦¬ ì¤€ë¹„í•œ "ì •ë‹µ ë°ì´í„°"ì™€ ë¹„êµ
â†’ ë¶ˆì¼ì¹˜ í•­ëª© ìë™ íƒì§€
â†’ ì •í™•ë„ ì ìˆ˜ ì‚°ì¶œ
```

#### 2. í•™ìŠµ í’ˆì§ˆ í–¥ìƒ
```
í”¼ë“œë°± ë£¨í”„:
1. AI ìƒì„± â†’ 2. ì •ë‹µê³¼ ë¹„êµ â†’ 3. ì˜¤ë¥˜ ë¶„ì„ â†’ 4. í•™ìŠµ ê°œì„ 

â†’ ì˜ëª»ëœ í•™ìŠµ ë°©ì§€
â†’ ì •í™•ë„ ì§€ì† í–¥ìƒ
```

### ê²€ì¦ ë°ì´í„° êµ¬ì¡°

#### 1. ì •ë‹µì§€ Excel ì‹œíŠ¸
```excel
Sheet: Test_Cases
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Test_ID    â”‚ Input_Column â”‚ Expected_DB  â”‚ Status â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TC001      â”‚ ê³µì •ëª…       â”‚ process_name â”‚ PASS   â”‚
â”‚ TC002      â”‚ ë¶€ì„œ         â”‚ dept_name    â”‚ PASS   â”‚
â”‚ TC003      â”‚ ê¸ˆì•¡         â”‚ amount       â”‚ FAIL   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Sheet: Expected_Data
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ process_id â”‚ ê³µì •ëª…   â”‚ ê¸ˆì•¡     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1          â”‚ ê°€ê³µ     â”‚ 1000    â”‚
â”‚ 2          â”‚ ì¡°ë¦½     â”‚ 1500    â”‚
â”‚ 3          â”‚ ê²€ì‚¬     â”‚ 800     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. ê²€ì¦ ì„¤ì • JSON
```json
{
  "validation": {
    "mappingTests": [
      {
        "testId": "MAP001",
        "excelColumn": "ê³µì •ëª…",
        "expectedTable": "process_master",
        "expectedColumn": "process_name",
        "confidence": 0.95
      },
      {
        "testId": "MAP002",
        "excelColumn": "ê¸ˆì•¡",
        "expectedTable": "cost_detail",
        "expectedColumn": "amount",
        "confidence": 0.90
      }
    ],
    "dataTests": [
      {
        "testId": "DATA001",
        "description": "ê³µì •ëª… ë°ì´í„° ì •í•©ì„±",
        "query": "SELECT process_name FROM process_master WHERE process_id IN (1,2,3)",
        "expectedResults": ["ê°€ê³µ", "ì¡°ë¦½", "ê²€ì‚¬"],
        "tolerance": 0
      }
    ],
    "formulaTests": [
      {
        "testId": "FORM001",
        "excelFormula": "=SUM(B2:B10)",
        "expectedSQL": "SUM(amount)",
        "testData": [1000, 1500, 800],
        "expectedResult": 3300
      }
    ]
  }
}
```

### ê²€ì¦ í”„ë¡œì„¸ìŠ¤

#### Step 1: ë§¤í•‘ ê²€ì¦
```typescript
async function validateMapping(
  aiMapping: Mapping[],
  expectedMapping: ExpectedMapping[]
): Promise<ValidationResult> {
  const results = [];
  
  for (const expected of expectedMapping) {
    const actual = aiMapping.find(m => m.excelColumn === expected.excelColumn);
    
    const isCorrect = 
      actual?.tableName === expected.expectedTable &&
      actual?.columnName === expected.expectedColumn;
    
    results.push({
      testId: expected.testId,
      excelColumn: expected.excelColumn,
      expected: `${expected.expectedTable}.${expected.expectedColumn}`,
      actual: actual ? `${actual.tableName}.${actual.columnName}` : 'NOT_MAPPED',
      status: isCorrect ? 'PASS' : 'FAIL',
      confidence: actual?.confidence || 0
    });
  }
  
  const passCount = results.filter(r => r.status === 'PASS').length;
  const accuracy = passCount / results.length;
  
  return {
    accuracy,
    totalTests: results.length,
    passed: passCount,
    failed: results.length - passCount,
    details: results
  };
}
```

#### Step 2: ë°ì´í„° ê²€ì¦
```typescript
async function validateData(
  generatedQuery: string,
  expectedData: any[]
): Promise<ValidationResult> {
  // 1. ìƒì„±ëœ ì¿¼ë¦¬ ì‹¤í–‰
  const actualData = await prisma.$queryRawUnsafe(generatedQuery);
  
  // 2. ì •ë‹µ ë°ì´í„°ì™€ ë¹„êµ
  const comparison = compareDatasets(actualData, expectedData);
  
  return {
    accuracy: comparison.matchRate,
    totalRows: expectedData.length,
    matchedRows: comparison.matched,
    unmatchedRows: comparison.unmatched,
    differences: comparison.details
  };
}

function compareDatasets(actual: any[], expected: any[]) {
  const matched = [];
  const unmatched = [];
  
  for (let i = 0; i < expected.length; i++) {
    const expectedRow = expected[i];
    const actualRow = actual[i];
    
    if (!actualRow) {
      unmatched.push({
        index: i,
        reason: 'MISSING_ROW',
        expected: expectedRow
      });
      continue;
    }
    
    const differences = findRowDifferences(actualRow, expectedRow);
    
    if (differences.length === 0) {
      matched.push(i);
    } else {
      unmatched.push({
        index: i,
        reason: 'DATA_MISMATCH',
        differences
      });
    }
  }
  
  return {
    matched: matched.length,
    unmatched: unmatched.length,
    matchRate: matched.length / expected.length,
    details: unmatched
  };
}
```

#### Step 3: ìˆ˜ì‹ ê²€ì¦
```typescript
async function validateFormula(
  excelFormula: string,
  convertedSQL: string,
  testData: number[]
): Promise<ValidationResult> {
  // 1. Excel ìˆ˜ì‹ ê³„ì‚° (HyperFormula ì‚¬ìš©)
  const expectedResult = calculateExcelFormula(excelFormula, testData);
  
  // 2. SQL ìˆ˜ì‹ ì‹¤í–‰
  const actualResult = await executeSQL(convertedSQL, testData);
  
  // 3. ë¹„êµ
  const tolerance = 0.01; // ë¶€ë™ì†Œìˆ˜ì  ì˜¤ì°¨ í—ˆìš©
  const isMatch = Math.abs(expectedResult - actualResult) < tolerance;
  
  return {
    testId: 'FORM_TEST',
    excelFormula,
    convertedSQL,
    expected: expectedResult,
    actual: actualResult,
    difference: Math.abs(expectedResult - actualResult),
    status: isMatch ? 'PASS' : 'FAIL'
  };
}

// HyperFormulaë¥¼ ì‚¬ìš©í•œ Excel ìˆ˜ì‹ ê³„ì‚°
import { HyperFormula } from 'hyperformula';

function calculateExcelFormula(formula: string, data: number[]): number {
  const hf = HyperFormula.buildEmpty();
  
  // ì‹œíŠ¸ ìƒì„± ë° ë°ì´í„° ì…ë ¥
  hf.addSheet('Sheet1');
  data.forEach((value, index) => {
    hf.setCellContents({ sheet: 0, col: 0, row: index }, [[value]]);
  });
  
  // ìˆ˜ì‹ ê³„ì‚°
  const formulaCell = { sheet: 0, col: 1, row: 0 };
  hf.setCellContents(formulaCell, [[formula]]);
  
  return hf.getCellValue(formulaCell) as number;
}
```

#### Step 4: í†µí•© ê²€ì¦ ë¦¬í¬íŠ¸
```typescript
async function generateValidationReport(
  mappingResult: ValidationResult,
  dataResult: ValidationResult,
  formulaResults: ValidationResult[]
): Promise<ValidationReport> {
  const overallAccuracy = (
    mappingResult.accuracy * 0.4 + // ë§¤í•‘ 40%
    dataResult.accuracy * 0.4 +    // ë°ì´í„° 40%
    avgFormulaAccuracy(formulaResults) * 0.2 // ìˆ˜ì‹ 20%
  );
  
  return {
    timestamp: new Date(),
    overallAccuracy,
    grade: getGrade(overallAccuracy),
    sections: {
      mapping: mappingResult,
      data: dataResult,
      formulas: formulaResults
    },
    recommendations: generateRecommendations({
      mappingResult,
      dataResult,
      formulaResults
    })
  };
}

function getGrade(accuracy: number): string {
  if (accuracy >= 0.95) return 'A+ (Excellent)';
  if (accuracy >= 0.90) return 'A (Very Good)';
  if (accuracy >= 0.85) return 'B+ (Good)';
  if (accuracy >= 0.80) return 'B (Acceptable)';
  if (accuracy >= 0.70) return 'C (Needs Improvement)';
  return 'F (Failed)';
}

function generateRecommendations(results: any): string[] {
  const recommendations = [];
  
  // ë§¤í•‘ ì •í™•ë„ê°€ ë‚®ìœ¼ë©´
  if (results.mappingResult.accuracy < 0.80) {
    recommendations.push(
      'âš ï¸ ë§¤í•‘ ì •í™•ë„ê°€ ë‚®ìŠµë‹ˆë‹¤. ì¶”ê°€ í•™ìŠµ ë°ì´í„°ë¥¼ ì œê³µí•˜ì„¸ìš”.',
      'ğŸ’¡ ìœ ì‚¬í•œ í™”ë©´ì˜ ë§¤í•‘ ì‚¬ë¡€ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.'
    );
  }
  
  // ë°ì´í„° ë¶ˆì¼ì¹˜ê°€ ë§ìœ¼ë©´
  if (results.dataResult.accuracy < 0.80) {
    recommendations.push(
      'âš ï¸ ë°ì´í„° ë¶ˆì¼ì¹˜ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì¿¼ë¦¬ë¥¼ ì¬ê²€í† í•˜ì„¸ìš”.',
      'ğŸ’¡ JOIN ì¡°ê±´ì´ë‚˜ í•„í„° ì¡°ê±´ì„ í™•ì¸í•˜ì„¸ìš”.'
    );
  }
  
  // ìˆ˜ì‹ ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´
  const failedFormulas = results.formulaResults.filter(f => f.status === 'FAIL');
  if (failedFormulas.length > 0) {
    recommendations.push(
      `âš ï¸ ${failedFormulas.length}ê°œ ìˆ˜ì‹ ë³€í™˜ì— ì˜¤ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤.`,
      'ğŸ’¡ ë³µì¡í•œ ìˆ˜ì‹ì€ ìˆ˜ë™ìœ¼ë¡œ ê²€í† í•˜ì„¸ìš”.'
    );
  }
  
  return recommendations;
}
```

### ê²€ì¦ UI

```typescript
// src/app/validation/page.tsx
"use client";

import { useState } from "react";
import { api } from "~/trpc/react";

export default function ValidationPage() {
  const [report, setReport] = useState(null);
  
  const validateMutation = api.validation.runFullValidation.useMutation();

  const handleValidate = async () => {
    const result = await validateMutation.mutateAsync({
      screenId: 'COST001',
      expectedDataFile: '/path/to/expected_data.xlsx'
    });
    setReport(result);
  };

  return (
    <div className="container mx-auto p-6">
      <h1 className="text-2xl font-bold mb-6">í™”ë©´ ìƒì„± ê²€ì¦</h1>

      {/* ê²€ì¦ ì‹¤í–‰ ë²„íŠ¼ */}
      <button 
        onClick={handleValidate}
        className="bg-blue-500 text-white px-6 py-3 rounded"
      >
        ê²€ì¦ ì‹œì‘
      </button>

      {/* ê²€ì¦ ë¦¬í¬íŠ¸ */}
      {report && (
        <div className="mt-8 space-y-6">
          {/* ì „ì²´ ì ìˆ˜ */}
          <div className="bg-gradient-to-r from-blue-500 to-purple-500 text-white p-6 rounded-lg">
            <h2 className="text-3xl font-bold">
              {(report.overallAccuracy * 100).toFixed(1)}%
            </h2>
            <p className="text-xl">{report.grade}</p>
          </div>

          {/* ì„¹ì…˜ë³„ ê²°ê³¼ */}
          <div className="grid grid-cols-3 gap-4">
            {/* ë§¤í•‘ ê²€ì¦ */}
            <div className="border rounded p-4">
              <h3 className="font-bold mb-2">ë§¤í•‘ ê²€ì¦</h3>
              <div className="text-3xl font-bold text-blue-600">
                {(report.sections.mapping.accuracy * 100).toFixed(1)}%
              </div>
              <div className="text-sm text-gray-600">
                {report.sections.mapping.passed} / {report.sections.mapping.totalTests} PASS
              </div>
            </div>

            {/* ë°ì´í„° ê²€ì¦ */}
            <div className="border rounded p-4">
              <h3 className="font-bold mb-2">ë°ì´í„° ê²€ì¦</h3>
              <div className="text-3xl font-bold text-green-600">
                {(report.sections.data.accuracy * 100).toFixed(1)}%
              </div>
              <div className="text-sm text-gray-600">
                {report.sections.data.matchedRows} / {report.sections.data.totalRows} ì¼ì¹˜
              </div>
            </div>

            {/* ìˆ˜ì‹ ê²€ì¦ */}
            <div className="border rounded p-4">
              <h3 className="font-bold mb-2">ìˆ˜ì‹ ê²€ì¦</h3>
              <div className="text-3xl font-bold text-purple-600">
                {(avgAccuracy(report.sections.formulas) * 100).toFixed(1)}%
              </div>
              <div className="text-sm text-gray-600">
                {passedCount(report.sections.formulas)} / {report.sections.formulas.length} PASS
              </div>
            </div>
          </div>

          {/* ìƒì„¸ ê²°ê³¼ */}
          <div className="border rounded p-4">
            <h3 className="font-bold mb-4">ìƒì„¸ ê²°ê³¼</h3>
            
            {/* ì‹¤íŒ¨í•œ í…ŒìŠ¤íŠ¸ë§Œ í‘œì‹œ */}
            {report.sections.mapping.details
              .filter(d => d.status === 'FAIL')
              .map(detail => (
                <div key={detail.testId} className="bg-red-50 p-3 mb-2 rounded">
                  <div className="font-semibold text-red-700">
                    âŒ {detail.excelColumn}
                  </div>
                  <div className="text-sm">
                    ì˜ˆìƒ: {detail.expected} | ì‹¤ì œ: {detail.actual}
                  </div>
                </div>
              ))}
          </div>

          {/* ì¶”ì²œ ì‚¬í•­ */}
          <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4">
            <h3 className="font-bold mb-2">ğŸ’¡ ê°œì„  ì¶”ì²œ</h3>
            <ul className="space-y-1">
              {report.recommendations.map((rec, i) => (
                <li key={i}>{rec}</li>
              ))}
            </ul>
          </div>
        </div>
      )}
    </div>
  );
}
```

### ìë™ í•™ìŠµ í†µí•©

```typescript
// ê²€ì¦ ì‹¤íŒ¨ ì‹œ ìë™ í•™ìŠµ
async function learnFromValidationFailures(report: ValidationReport) {
  const failures = [
    ...report.sections.mapping.details.filter(d => d.status === 'FAIL'),
    ...report.sections.data.differences
  ];

  for (const failure of failures) {
    // 1. ì‹¤íŒ¨ íŒ¨í„´ ë¶„ì„
    const pattern = analyzeFailurePattern(failure);
    
    // 2. í•™ìŠµ ë°ì´í„° ìƒì„±
    const trainingData = {
      input: failure.input,
      expectedOutput: failure.expected,
      actualOutput: failure.actual,
      failureReason: pattern.reason,
      context: pattern.context
    };
    
    // 3. Vector DBì— ì €ì¥ (ë¶€ì • ì˜ˆì œ)
    await saveNegativeExample(trainingData);
    
    // 4. ëª¨ë¸ ì—…ë°ì´íŠ¸ (ê°€ì¤‘ì¹˜ ì¡°ì •)
    await updateModelWithFailure(trainingData);
  }
}
```

### ì˜ˆìƒ íš¨ê³¼

```
ê²€ì¦ ë„ì… ì „:
- ì •í™•ë„: ì¶”ì •ì¹˜ë§Œ (ë¶ˆí™•ì‹¤)
- ì˜¤ë¥˜ ë°œê²¬: ì‚¬ìš©ìê°€ ì§ì ‘
- í•™ìŠµ: ìˆ˜ë™

ê²€ì¦ ë„ì… í›„:
- ì •í™•ë„: ì •ëŸ‰ì  ì¸¡ì • (90% â†’ ì‹¤ì œ ê²€ì¦)
- ì˜¤ë¥˜ ë°œê²¬: ìë™ íƒì§€
- í•™ìŠµ: ì‹¤íŒ¨ ì‚¬ë¡€ ìë™ í•™ìŠµ

â†’ ì‹ ë¢°ë„ í–¥ìƒ + í•™ìŠµ í’ˆì§ˆ í–¥ìƒ
```

---

## ğŸ“ ê³ ê¸‰ RAG ì „ëµ ì œì•ˆ (ADVANCED)

### 1ï¸âƒ£ **Multi-Vector Indexing** (ë©€í‹° ë²¡í„° ì¸ë±ì‹±)

#### ê°œë…
```
í•˜ë‚˜ì˜ ì»¬ëŸ¼ì„ ì—¬ëŸ¬ ê´€ì ì—ì„œ ì„ë² ë”©
- í•œê¸€ëª… ë²¡í„°
- ì˜ë¬¸ëª… ë²¡í„°
- ë°ì´í„° íƒ€ì… ë²¡í„°
- ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ë²¡í„°
- ì‚¬ìš© ë¹ˆë„ ë²¡í„°

â†’ ë‹¤ì°¨ì› ê²€ìƒ‰ìœ¼ë¡œ ì •í™•ë„ í–¥ìƒ
```

#### êµ¬í˜„
```typescript
interface MultiVectorDocument {
  id: string;
  tableName: string;
  columnName: string;
  
  vectors: {
    korean: number[];      // "ê³µì •ëª…" ì„ë² ë”©
    english: number[];     // "process_name" ì„ë² ë”©
    dataType: number[];    // "varchar(100)" ì„ë² ë”©
    context: number[];     // "ì›ê°€ ê´€ë¦¬ì—ì„œ ê³µì •ì„ ì‹ë³„" ì„ë² ë”©
    usage: number[];       // "ì¡°íšŒ 80%, ìˆ˜ì • 15%, ì‚­ì œ 5%" ì„ë² ë”©
  };
  
  metadata: {
    koreanName: string;
    englishName: string;
    dataType: string;
    businessContext: string;
    usagePattern: string;
  };
}

// ë©€í‹° ë²¡í„° ê²€ìƒ‰
async function multiVectorSearch(query: string, context: string) {
  // 1. ì¿¼ë¦¬ë¥¼ ì—¬ëŸ¬ ê´€ì ìœ¼ë¡œ ì„ë² ë”©
  const queryVectors = {
    korean: await embedText(query),
    context: await embedText(context),
    combined: await embedText(`${query} ${context}`)
  };
  
  // 2. ê° ë²¡í„°ë¡œ ê²€ìƒ‰
  const koreanResults = await vectorStore.similaritySearch(queryVectors.korean, 10);
  const contextResults = await vectorStore.similaritySearch(queryVectors.context, 10);
  const combinedResults = await vectorStore.similaritySearch(queryVectors.combined, 10);
  
  // 3. ê²°ê³¼ ë³‘í•© (ê°€ì¤‘ì¹˜ ì ìš©)
  const mergedResults = mergeResults([
    { results: koreanResults, weight: 0.4 },
    { results: contextResults, weight: 0.3 },
    { results: combinedResults, weight: 0.3 }
  ]);
  
  return mergedResults;
}
```

**ì˜ˆìƒ íš¨ê³¼:**
- ì •í™•ë„: 85% â†’ 92%
- ëª¨í˜¸í•œ ì¿¼ë¦¬ ì²˜ë¦¬ ëŠ¥ë ¥ í–¥ìƒ

---

### 2ï¸âƒ£ **Hierarchical RAG** (ê³„ì¸µì  RAG)

#### ê°œë…
```
ê²€ìƒ‰ì„ ê³„ì¸µì ìœ¼ë¡œ ìˆ˜í–‰
Level 1: í…Œì´ë¸” ë ˆë²¨ ê²€ìƒ‰
  â†“
Level 2: ì»¬ëŸ¼ ë ˆë²¨ ê²€ìƒ‰
  â†“
Level 3: ê´€ê³„ ë ˆë²¨ ê²€ìƒ‰

â†’ ê²€ìƒ‰ ì •í™•ë„ í–¥ìƒ + ì†ë„ ê°œì„ 
```

#### êµ¬í˜„
```typescript
async function hierarchicalSearch(query: string) {
  // Level 1: í…Œì´ë¸” ê²€ìƒ‰
  const relevantTables = await searchTables(query);
  // Result: ["process_master", "cost_process"]
  
  // Level 2: í•´ë‹¹ í…Œì´ë¸” ë‚´ ì»¬ëŸ¼ ê²€ìƒ‰
  const relevantColumns = await Promise.all(
    relevantTables.map(table => 
      searchColumnsInTable(query, table)
    )
  );
  // Result: [
  //   { table: "process_master", column: "process_name" },
  //   { table: "cost_process", column: "proc_nm" }
  // ]
  
  // Level 3: ê´€ê³„ ê²€ìƒ‰ (JOIN íŒíŠ¸)
  const relationships = await searchRelationships(relevantTables);
  // Result: {
  //   join: "process_master.process_id = cost_process.process_id"
  // }
  
  return {
    tables: relevantTables,
    columns: relevantColumns,
    relationships
  };
}
```

**ì˜ˆìƒ íš¨ê³¼:**
- ê²€ìƒ‰ ì†ë„: 50% í–¥ìƒ
- JOIN ì¡°ê±´ ìë™ ìƒì„± ì •í™•ë„: 70% â†’ 90%

---

### 3ï¸âƒ£ **Adaptive Learning Rate** (ì ì‘í˜• í•™ìŠµë¥ )

#### ê°œë…
```
ì»¬ëŸ¼ë³„ë¡œ í•™ìŠµ ì†ë„ë¥¼ ë‹¤ë¥´ê²Œ ì„¤ì •
- ìì£¼ í‹€ë¦¬ëŠ” ì»¬ëŸ¼: í•™ìŠµë¥  ë†’ì„
- ì •í™•ë„ ë†’ì€ ì»¬ëŸ¼: í•™ìŠµë¥  ë‚®ì¶¤

â†’ íš¨ìœ¨ì  í•™ìŠµ
```

#### êµ¬í˜„
```typescript
interface ColumnLearningProfile {
  columnPattern: string;
  accuracy: number;
  learningRate: number;
  lastUpdated: Date;
}

function calculateAdaptiveLearningRate(
  column: string,
  history: FeedbackHistory[]
): number {
  const recentAccuracy = calculateRecentAccuracy(column, history);
  
  // ì •í™•ë„ ë‚®ìœ¼ë©´ í•™ìŠµë¥  ë†’ì„
  if (recentAccuracy < 0.70) return 0.5;   // ë†’ì€ í•™ìŠµë¥ 
  if (recentAccuracy < 0.85) return 0.3;   // ì¤‘ê°„ í•™ìŠµë¥ 
  if (recentAccuracy < 0.95) return 0.1;   // ë‚®ì€ í•™ìŠµë¥ 
  return 0.01;                             // ìµœì†Œ í•™ìŠµë¥ 
}

async function adaptiveLearning(feedback: Feedback) {
  const learningRate = calculateAdaptiveLearningRate(
    feedback.excelColumn,
    await getFeedbackHistory(feedback.excelColumn)
  );
  
  // í•™ìŠµë¥ ì— ë”°ë¼ ê°€ì¤‘ì¹˜ ì—…ë°ì´íŠ¸
  await updateModelWeights(feedback, learningRate);
}
```

**ì˜ˆìƒ íš¨ê³¼:**
- í•™ìŠµ íš¨ìœ¨: 30% í–¥ìƒ
- ì •í™•ë„ ì•ˆì •í™” ì‹œê°„: 20ê°œ í™”ë©´ â†’ 15ê°œ í™”ë©´

---

### 4ï¸âƒ£ **Context-Aware Caching** (ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ ìºì‹±)

#### ê°œë…
```
ìì£¼ ì‚¬ìš©ë˜ëŠ” íŒ¨í„´ì„ ìºì‹±
- "ê³µì •ëª…" + "ì›ê°€ í™”ë©´" = process_master.process_name (ìºì‹œ)
- "ë¶€ì„œ" + "ì¡°ì§ í™”ë©´" = dept_master.dept_name (ìºì‹œ)

â†’ ì†ë„ í–¥ìƒ + ë¹„ìš© ì ˆê°
```

#### êµ¬í˜„
```typescript
interface CachedMapping {
  key: string; // "ê³µì •ëª…:ì›ê°€í™”ë©´"
  mapping: { table: string; column: string };
  confidence: number;
  hitCount: number;
  lastUsed: Date;
}

async function getCachedMapping(
  excelColumn: string,
  context: string
): Promise<CachedMapping | null> {
  const cacheKey = `${excelColumn}:${context}`;
  
  // Redisì—ì„œ ìºì‹œ ì¡°íšŒ
  const cached = await redis.get(`mapping:${cacheKey}`);
  
  if (cached) {
    // íˆíŠ¸ ì¹´ìš´íŠ¸ ì¦ê°€
    await redis.incr(`mapping:${cacheKey}:hits`);
    return JSON.parse(cached);
  }
  
  return null;
}

async function setCachedMapping(
  excelColumn: string,
  context: string,
  mapping: Mapping,
  confidence: number
) {
  const cacheKey = `${excelColumn}:${context}`;
  
  // confidence > 0.90ì¸ ê²ƒë§Œ ìºì‹±
  if (confidence > 0.90) {
    await redis.setex(
      `mapping:${cacheKey}`,
      86400, // 24ì‹œê°„
      JSON.stringify({ mapping, confidence })
    );
  }
}
```

**ì˜ˆìƒ íš¨ê³¼:**
- ì‘ë‹µ ì†ë„: 2-5ì´ˆ â†’ 0.1ì´ˆ (ìºì‹œ íˆíŠ¸ ì‹œ)
- API ë¹„ìš©: 30% ì ˆê°
- ìºì‹œ íˆíŠ¸ìœ¨: 60-70% (í•™ìŠµ í›„)

---

### 5ï¸âƒ£ **Ensemble RAG** (ì•™ìƒë¸” RAG)

#### ê°œë…
```
ì—¬ëŸ¬ ëª¨ë¸ì˜ ê²°ê³¼ë¥¼ ê²°í•©
Model A: Vector Search (Pinecone)
Model B: Keyword Search (Elasticsearch)
Model C: Pattern Matching (Regex)
Model D: LLM Reasoning (Gemini)

â†’ íˆ¬í‘œ ë˜ëŠ” ê°€ì¤‘ í‰ê· ìœ¼ë¡œ ìµœì¢… ê²°ì •
```

#### êµ¬í˜„
```typescript
async function ensembleMapping(
  excelColumn: string,
  context: string
): Promise<EnsembleResult> {
  // ë³‘ë ¬ë¡œ ì—¬ëŸ¬ ëª¨ë¸ ì‹¤í–‰
  const [vectorResult, keywordResult, patternResult, llmResult] = 
    await Promise.all([
      vectorSearch(excelColumn, context),      // Pinecone
      keywordSearch(excelColumn, context),     // Elasticsearch
      patternMatch(excelColumn),               // Regex
      llmReasoning(excelColumn, context)       // Gemini
    ]);
  
  // ê° ëª¨ë¸ì˜ ì‹ ë¢°ë„
  const models = [
    { name: 'vector', result: vectorResult, confidence: 0.85, weight: 0.4 },
    { name: 'keyword', result: keywordResult, confidence: 0.75, weight: 0.2 },
    { name: 'pattern', result: patternResult, confidence: 0.90, weight: 0.2 },
    { name: 'llm', result: llmResult, confidence: 0.80, weight: 0.2 }
  ];
  
  // ê°€ì¤‘ íˆ¬í‘œ
  const ensemble = weightedVoting(models);
  
  return {
    mapping: ensemble.topChoice,
    confidence: ensemble.confidence,
    modelAgreement: ensemble.agreement, // ëª¨ë¸ ê°„ í•©ì˜ë„
    breakdown: models
  };
}

function weightedVoting(models: Model[]): EnsembleResult {
  const votes = new Map();
  
  models.forEach(model => {
    const key = `${model.result.table}.${model.result.column}`;
    const score = model.confidence * model.weight;
    votes.set(key, (votes.get(key) || 0) + score);
  });
  
  const sorted = Array.from(votes.entries())
    .sort((a, b) => b[1] - a[1]);
  
  return {
    topChoice: parseMapping(sorted[0][0]),
    confidence: sorted[0][1],
    agreement: calculateAgreement(models)
  };
}
```

**ì˜ˆìƒ íš¨ê³¼:**
- ì •í™•ë„: 85% â†’ 94%
- ëª¨í˜¸í•œ ì¼€ì´ìŠ¤ ì²˜ë¦¬ ëŠ¥ë ¥ ëŒ€í­ í–¥ìƒ

---

### 6ï¸âƒ£ **Active Learning** (ëŠ¥ë™ í•™ìŠµ)

#### ê°œë…
```
AIê°€ ìŠ¤ìŠ¤ë¡œ ì• ë§¤í•œ ì¼€ì´ìŠ¤ë¥¼ ì„ ë³„
â†’ ì‚¬ìš©ìì—ê²Œ ìš°ì„ ì ìœ¼ë¡œ ì§ˆë¬¸
â†’ íš¨ìœ¨ì  í•™ìŠµ

ì˜ˆ: ì‹ ë¢°ë„ 70-80% í•­ëª©ë§Œ ì‚¬ìš©ì í™•ì¸
```

#### êµ¬í˜„
```typescript
async function activeLearning(mappings: Mapping[]) {
  // 1. ë¶ˆí™•ì‹¤í•œ í•­ëª© í•„í„°ë§
  const uncertainMappings = mappings.filter(m => 
    m.confidence >= 0.70 && m.confidence < 0.90
  );
  
  // 2. ì •ë³´ ê°€ì¹˜ ê³„ì‚° (ì–´ë–¤ ê±¸ ë¬¼ì–´ë³´ë©´ ê°€ì¥ ìœ ìš©í•œê°€?)
  const ranked = uncertainMappings.map(m => ({
    ...m,
    informationGain: calculateInformationGain(m)
  })).sort((a, b) => b.informationGain - a.informationGain);
  
  // 3. ìƒìœ„ 5ê°œë§Œ ì‚¬ìš©ìì—ê²Œ ì§ˆë¬¸
  const toAsk = ranked.slice(0, 5);
  
  // 4. ì‚¬ìš©ì ë‹µë³€ ë°›ê¸°
  const answers = await askUser(toAsk);
  
  // 5. í•™ìŠµ
  for (const answer of answers) {
    await learnFromUserFeedback(answer);
  }
  
  // 6. ë‚˜ë¨¸ì§€ëŠ” AI íŒë‹¨ìœ¼ë¡œ ìë™ ì²˜ë¦¬
  const autoMappings = mappings.filter(m => 
    !toAsk.some(t => t.excelColumn === m.excelColumn)
  );
  
  return {
    confirmed: answers,
    automatic: autoMappings
  };
}

function calculateInformationGain(mapping: Mapping): number {
  // ì´ ë§¤í•‘ì„ í•™ìŠµí•˜ë©´ ì–¼ë§ˆë‚˜ ë§ì€ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆëŠ”ê°€?
  const factors = {
    novelty: 0.3,        // ìƒˆë¡œìš´ íŒ¨í„´ì¸ê°€?
    frequency: 0.3,      // ìì£¼ ë‚˜ì˜¤ëŠ” íŒ¨í„´ì¸ê°€?
    ambiguity: 0.4       // ì• ë§¤í•œ ì •ë„
  };
  
  return (
    mapping.noveltyScore * factors.novelty +
    mapping.frequencyScore * factors.frequency +
    (1 - mapping.confidence) * factors.ambiguity
  );
}
```

**ì˜ˆìƒ íš¨ê³¼:**
- ì‚¬ìš©ì ê°œì…: 100% â†’ 20% (íš¨ìœ¨ì  ì§ˆë¬¸)
- í•™ìŠµ ì†ë„: 2ë°° í–¥ìƒ
- ì •í™•ë„: ë™ì¼ ìˆ˜ì¤€ ìœ ì§€

---

## ğŸ“Š ê³ ê¸‰ RAG í†µí•© íš¨ê³¼

### ì •í™•ë„ ë¹„êµ

| ì „ëµ | ê¸°ë³¸ RAG | + Multi-Vector | + Hierarchical | + Ensemble | **ìµœì¢…** |
|------|----------|----------------|----------------|------------|----------|
| DB ë§¤í•‘ | 85% | 88% | 90% | 92% | **94%** |
| Excel íŒŒì‹± | 85% | 87% | 87% | 89% | **91%** |
| ì°¨íŠ¸ ìƒì„± | 75% | 78% | 78% | 82% | **85%** |
| ìˆ˜ì‹ ë³€í™˜ | 80% | 82% | 82% | 85% | **88%** |
| **í‰ê· ** | **81%** | **84%** | **84%** | **87%** | **90%** |

### ì„±ëŠ¥ ë¹„êµ

| ì§€í‘œ | ê¸°ë³¸ RAG | ê³ ê¸‰ RAG | ê°œì„ ìœ¨ |
|------|----------|----------|--------|
| ì •í™•ë„ | 81% | **90%** | **+9%p** |
| ì‘ë‹µ ì†ë„ | 2-5ì´ˆ | **0.5-2ì´ˆ** | **60% ë¹ ë¦„** |
| API ë¹„ìš© | **$40/ì›”** ğŸ†• | **$60/ì›”** ğŸ†• | +$20 |
| ì‚¬ìš©ì ê°œì… | 20% | **10%** | 50% ê°ì†Œ |
| í•™ìŠµ ì†ë„ | 20ê°œ í™”ë©´ | **12ê°œ í™”ë©´** | 40% ë¹ ë¦„ |

### ë¹„ìš© ë¶„ì„

```
ê¸°ë³¸ RAG (ë¡œì»¬): $40/ì›” ğŸ†•
ê³ ê¸‰ RAG (ë¡œì»¬): $60/ì›” (+$20)

ê¸°ë³¸ ë¹„ìš©:
- Chroma (ë¡œì»¬): $0 (ë¬´ë£Œ) ğŸ†•
- OpenAI Embeddings: $25/ì›”
- Gemini API: $15/ì›”
= $40/ì›”

ì¶”ê°€ ë¹„ìš© (ê³ ê¸‰ RAG):
- Elasticsearch (ë¡œì»¬): $0 (ë¬´ë£Œ) ğŸ†•
- Redis (ë¡œì»¬): $0 (ë¬´ë£Œ) ğŸ†•
- ì¶”ê°€ API í˜¸ì¶œ: $20/ì›”
= ì´ $60/ì›”

ROI:
- ì›” 20ê°œ í™”ë©´ Ã— 28ë¶„ ì ˆì•½ = $467/ì›”
- ìˆœì´ìµ (ê¸°ë³¸): $467 - $40 = $427/ì›” ğŸ†•
- ìˆœì´ìµ (ê³ ê¸‰): $467 - $60 = $407/ì›” ğŸ†•

â†’ ë¡œì»¬ êµ¬ì¶•ìœ¼ë¡œ ì›” $40-$120 ì ˆê°!
â†’ ì—¬ì „íˆ 2ê°œì›” ë‚´ íšŒìˆ˜
```

---

## ğŸ  ë¡œì»¬ RAG êµ¬ì¶• ê°€ì´ë“œ (NEW!)

### ì™œ ë¡œì»¬ RAGì¸ê°€?

#### ì¥ì 
```
âœ… ë¹„ìš© ì ˆê°: $40-$120/ì›” ì ˆê° (í´ë¼ìš°ë“œ Vector DB ë¬´ë£Œ)
âœ… ë°ì´í„° ë³´ì•ˆ: ë¯¼ê°í•œ DB ë©”íƒ€ë°ì´í„°ë¥¼ ì™¸ë¶€ì— ì „ì†¡í•˜ì§€ ì•ŠìŒ
âœ… ë¹ ë¥¸ ì‘ë‹µ: ë„¤íŠ¸ì›Œí¬ ì§€ì—° ì—†ìŒ (LAN ì†ë„)
âœ… ë¬´ì œí•œ ì €ì¥: ë””ìŠ¤í¬ ìš©ëŸ‰ë§Œí¼ ì‚¬ìš© ê°€ëŠ¥
âœ… ì»¤ìŠ¤í„°ë§ˆì´ì§•: ììœ ë¡œìš´ ì„¤ì • ë³€ê²½
```

#### ë‹¨ì 
```
âš ï¸ ì´ˆê¸° ì„¤ì •: Docker, ì„œë²„ ì„¤ì • í•„ìš” (30ë¶„ ì†Œìš”)
âš ï¸ ì„œë²„ ìœ ì§€: í•­ìƒ ì‹¤í–‰ ìƒíƒœ ìœ ì§€ í•„ìš”
âš ï¸ ë°±ì—… ì±…ì„: ì§ì ‘ ë°±ì—… ê´€ë¦¬
```

### ê¸°ìˆ  ìŠ¤íƒ (ë¡œì»¬ ë²„ì „)

| ë¶„ì•¼ | ê¸°ìˆ  | ë°°í¬ ë°©ì‹ | ë¹„ìš© |
|------|------|-----------|------|
| Vector DB | **Chroma** | Docker (localhost:8000) | **ë¬´ë£Œ** ğŸ†• |
| Full-text Search | **Elasticsearch** | Docker (localhost:9200) | **ë¬´ë£Œ** ğŸ†• |
| ìºì‹± | **Redis** | Docker (localhost:6379) | **ë¬´ë£Œ** ğŸ†• |
| Embeddings | OpenAI API | Cloud | $25/ì›” |
| LLM | Gemini API | Cloud | $15/ì›” |
| **í•©ê³„** | | | **$40/ì›”** ğŸ‰ |

### ì„¤ì¹˜ ê°€ì´ë“œ

#### Step 1: Docker Compose ì„¤ì •

```yaml
# docker-compose.yml
version: '3.8'

services:
  # Chroma Vector Database
  chroma:
    image: chromadb/chroma:latest
    container_name: chroma-vectordb
    ports:
      - "8000:8000"
    volumes:
      - ./chroma-data:/chroma/chroma
    environment:
      - CHROMA_SERVER_HOST=0.0.0.0
      - CHROMA_SERVER_HTTP_PORT=8000
    restart: unless-stopped

  # Elasticsearch (ì„ íƒì‚¬í•­ - Ensemble RAGìš©)
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
    container_name: elasticsearch
    ports:
      - "9200:9200"
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    volumes:
      - ./es-data:/usr/share/elasticsearch/data
    restart: unless-stopped

  # Redis (ì„ íƒì‚¬í•­ - ìºì‹±ìš©)
  redis:
    image: redis:7-alpine
    container_name: redis-cache
    ports:
      - "6379:6379"
    volumes:
      - ./redis-data:/data
    command: redis-server --save 60 1 --loglevel warning
    restart: unless-stopped
```

#### Step 2: ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```bash
# Docker Composeë¡œ ëª¨ë“  ì„œë¹„ìŠ¤ ì‹¤í–‰
docker-compose up -d

# ìƒíƒœ í™•ì¸
docker-compose ps

# ë¡œê·¸ í™•ì¸
docker-compose logs -f chroma
```

#### Step 3: Chroma í´ë¼ì´ì–¸íŠ¸ ì„¤ì •

```typescript
// src/lib/vectordb/chroma.ts
import { Chroma } from "@langchain/community/vectorstores/chroma";
import { OpenAIEmbeddings } from "@langchain/openai";

const embeddings = new OpenAIEmbeddings({
  openAIApiKey: process.env.OPENAI_API_KEY!,
  modelName: "text-embedding-3-small",
});

// Chroma ë¡œì»¬ í´ë¼ì´ì–¸íŠ¸
export async function getChromaClient(collectionName: string) {
  return new Chroma(embeddings, {
    collectionName,
    url: process.env.CHROMA_URL || "http://localhost:8000",
  });
}

// DB ë©”íƒ€ë°ì´í„° ì»¬ë ‰ì…˜
export async function getDBMetadataStore() {
  return getChromaClient("db-metadata");
}

// Excel íŒ¨í„´ ì»¬ë ‰ì…˜
export async function getExcelPatternsStore() {
  return getChromaClient("excel-patterns");
}

// ì°¨íŠ¸ ê·œì¹™ ì»¬ë ‰ì…˜
export async function getChartRulesStore() {
  return getChromaClient("chart-rules");
}

// ìˆ˜ì‹ ë§¤í•‘ ì»¬ë ‰ì…˜
export async function getFormulaMappingsStore() {
  return getChromaClient("formula-mappings");
}
```

#### Step 4: ë°ì´í„° ì´ˆê¸°í™”

```typescript
// scripts/init-vectordb.ts
import { getDBMetadataStore } from "~/lib/vectordb/chroma";
import { collectDBMetadata } from "~/lib/db/metadata";

async function initVectorDB() {
  console.log("ğŸš€ Vector DB ì´ˆê¸°í™” ì‹œì‘...");

  // 1. DB ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘
  console.log("ğŸ“Š DB ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘ ì¤‘...");
  const dbMetadata = await collectDBMetadata();

  // 2. ë¬¸ì„œ ìƒì„±
  const documents = dbMetadata.tables.flatMap((table) =>
    table.columns.map((col) => ({
      pageContent: [
        `í…Œì´ë¸”: ${table.koreanName}(${table.name})`,
        `ì»¬ëŸ¼: ${col.koreanName}(${col.name})`,
        `íƒ€ì…: ${col.type}`,
        `ì„¤ëª…: ${col.description || ""}`,
      ].join(", "),
      metadata: {
        tableName: table.name,
        tableKoreanName: table.koreanName,
        columnName: col.name,
        columnKoreanName: col.koreanName,
        dataType: col.type,
        description: col.description || "",
      },
    }))
  );

  console.log(`ğŸ“ ${documents.length}ê°œ ë¬¸ì„œ ìƒì„± ì™„ë£Œ`);

  // 3. Chromaì— ì €ì¥
  console.log("ğŸ’¾ Chromaì— ì €ì¥ ì¤‘...");
  const vectorStore = await getDBMetadataStore();
  await vectorStore.addDocuments(documents);

  console.log("âœ… Vector DB ì´ˆê¸°í™” ì™„ë£Œ!");
  console.log(`ğŸ“¦ ì €ì¥ëœ ë¬¸ì„œ: ${documents.length}ê°œ`);
}

initVectorDB().catch(console.error);
```

```bash
# ì‹¤í–‰
npx tsx scripts/init-vectordb.ts
```

#### Step 5: ê²€ìƒ‰ í…ŒìŠ¤íŠ¸

```typescript
// scripts/test-search.ts
import { getDBMetadataStore } from "~/lib/vectordb/chroma";

async function testSearch() {
  const vectorStore = await getDBMetadataStore();

  // í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬
  const results = await vectorStore.similaritySearch("ê³µì •ëª…", 5);

  console.log("ğŸ” ê²€ìƒ‰ ê²°ê³¼:");
  results.forEach((doc, i) => {
    console.log(`\n${i + 1}. ${doc.metadata.columnKoreanName}`);
    console.log(`   í…Œì´ë¸”: ${doc.metadata.tableName}`);
    console.log(`   ì»¬ëŸ¼: ${doc.metadata.columnName}`);
    console.log(`   íƒ€ì…: ${doc.metadata.dataType}`);
  });
}

testSearch().catch(console.error);
```

### ì„±ëŠ¥ ìµœì í™”

#### 1. ì„ë² ë”© ìºì‹±
```typescript
// src/lib/vectordb/embedding-cache.ts
import Redis from "ioredis";

const redis = new Redis({
  host: process.env.REDIS_HOST || "localhost",
  port: parseInt(process.env.REDIS_PORT || "6379"),
});

export async function getCachedEmbedding(
  text: string
): Promise<number[] | null> {
  const key = `embedding:${text}`;
  const cached = await redis.get(key);
  return cached ? JSON.parse(cached) : null;
}

export async function setCachedEmbedding(
  text: string,
  embedding: number[]
): Promise<void> {
  const key = `embedding:${text}`;
  await redis.setex(key, 86400 * 30, JSON.stringify(embedding)); // 30ì¼
}

// ìºì‹± í™œì„±í™”ëœ ì„ë² ë”© í•¨ìˆ˜
export async function embedWithCache(
  embeddings: OpenAIEmbeddings,
  text: string
): Promise<number[]> {
  // ìºì‹œ í™•ì¸
  const cached = await getCachedEmbedding(text);
  if (cached) {
    console.log("âœ… ìºì‹œ íˆíŠ¸:", text.substring(0, 30));
    return cached;
  }

  // ìƒˆë¡œ ìƒì„±
  console.log("ğŸ”„ ìƒˆë¡œìš´ ì„ë² ë”©:", text.substring(0, 30));
  const embedding = await embeddings.embedQuery(text);
  await setCachedEmbedding(text, embedding);
  return embedding;
}
```

#### 2. ë°°ì¹˜ ì„ë² ë”©
```typescript
// ëŒ€ëŸ‰ ë°ì´í„° ì´ˆê¸°í™” ì‹œ
async function batchEmbedding(texts: string[], batchSize = 100) {
  const results = [];
  
  for (let i = 0; i < texts.length; i += batchSize) {
    const batch = texts.slice(i, i + batchSize);
    console.log(`ğŸ“¦ ë°°ì¹˜ ${i / batchSize + 1}/${Math.ceil(texts.length / batchSize)}`);
    
    const embeddings = await openaiEmbeddings.embedDocuments(batch);
    results.push(...embeddings);
    
    // API Rate Limit íšŒí”¼
    await new Promise(resolve => setTimeout(resolve, 1000));
  }
  
  return results;
}
```

### ë°±ì—… ë° ë³µêµ¬

#### ë°±ì—…
```bash
# Docker ë³¼ë¥¨ ë°±ì—…
docker-compose stop

# ë°ì´í„° ë””ë ‰í† ë¦¬ ì••ì¶•
tar -czf vectordb-backup-$(date +%Y%m%d).tar.gz \
  chroma-data \
  es-data \
  redis-data

docker-compose start
```

#### ë³µêµ¬
```bash
# ì••ì¶• í•´ì œ
tar -xzf vectordb-backup-20251202.tar.gz

# ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker-compose up -d
```

### ëª¨ë‹ˆí„°ë§

#### Chroma ìƒíƒœ í™•ì¸
```typescript
// src/lib/vectordb/health.ts
export async function checkChromaHealth() {
  try {
    const response = await fetch("http://localhost:8000/api/v1/heartbeat");
    if (response.ok) {
      console.log("âœ… Chroma ì •ìƒ ì‘ë™");
      return true;
    }
  } catch (error) {
    console.error("âŒ Chroma ì—°ê²° ì‹¤íŒ¨:", error);
    return false;
  }
}

// ì£¼ê¸°ì  í—¬ìŠ¤ì²´í¬
setInterval(checkChromaHealth, 60000); // 1ë¶„ë§ˆë‹¤
```

### í™˜ê²½ ë³€ìˆ˜ (.env)

```bash
# Vector DB
CHROMA_URL=http://localhost:8000

# Elasticsearch (ì„ íƒ)
ELASTICSEARCH_URL=http://localhost:9200

# Redis (ì„ íƒ)
REDIS_HOST=localhost
REDIS_PORT=6379

# OpenAI (í•„ìˆ˜)
OPENAI_API_KEY=sk-...

# Gemini (í•„ìˆ˜)
GEMINI_API_KEY=AI...
```

### ì˜ˆìƒ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰

| ì„œë¹„ìŠ¤ | ë©”ëª¨ë¦¬ | ë””ìŠ¤í¬ | CPU |
|--------|--------|--------|-----|
| Chroma | ~200MB | ~1GB (ì´ˆê¸°) | ~5% |
| Elasticsearch | ~512MB | ~2GB (ì´ˆê¸°) | ~10% |
| Redis | ~50MB | ~100MB | ~1% |
| **í•©ê³„** | **~800MB** | **~3GB** | **~16%** |

â†’ ì¼ë°˜ì ì¸ ê°œë°œ ì„œë²„ì—ì„œ ì¶©ë¶„íˆ ì‹¤í–‰ ê°€ëŠ¥

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```mermaid
graph TB
    subgraph "ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤"
        UI[Next.js 15 Frontend<br/>shadcn/ui + TanStack Table]
        Upload[Excel íŒŒì¼ ì—…ë¡œë“œ]
        Review[ë§¤í•‘ ê²€í†  & ìŠ¹ì¸]
        Preview[í™”ë©´ ë¯¸ë¦¬ë³´ê¸°]
        Validation[ê²€ì¦ ë¦¬í¬íŠ¸]
    end

    subgraph "API Layer (tRPC)"
        API[tRPC Router]
        ExcelAPI[Excel ë¶„ì„ API]
        MappingAPI[ë§¤í•‘ ìƒì„± API]
        ValidationAPI[ê²€ì¦ API]
        FeedbackAPI[í”¼ë“œë°± í•™ìŠµ API]
    end

    subgraph "AI/ML Layer"
        subgraph "LLM Services"
            Gemini[Google Gemini 2.0<br/>ë¶„ì„ & ìƒì„±]
            OpenAI[OpenAI Embeddings<br/>í…ìŠ¤íŠ¸ â†’ ë²¡í„°]
        end
        
        subgraph "RAG Pipeline"
            Embedder[ì„ë² ë”© ìƒì„±ê¸°]
            VectorSearch[ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰]
            LLMValidator[LLM ê²€ì¦ê¸°]
        end
    end

    subgraph "ë¡œì»¬ ì¸í”„ë¼ (Docker)"
        Chroma[(Chroma Vector DB<br/>:8000)]
        ES[(Elasticsearch<br/>:9200<br/>ì„ íƒì‚¬í•­)]
        Redis[(Redis Cache<br/>:6379)]
    end

    subgraph "Database Layer"
        PG[(PostgreSQL<br/>ë©”ì¸ DB)]
        
        subgraph "í•™ìŠµ ë°ì´í„°"
            Feedback[í”¼ë“œë°± í…Œì´ë¸”]
            Patterns[íŒ¨í„´ í•™ìŠµ í…Œì´ë¸”]
            History[ë³€í™˜ ì´ë ¥]
        end
    end

    subgraph "Excel ì²˜ë¦¬"
        Parser[SheetJS Parser]
        Analyzer[êµ¬ì¡° ë¶„ì„ê¸°]
        ChartExtractor[ì°¨íŠ¸ ì¶”ì¶œê¸°]
        FormulaParser[ìˆ˜ì‹ íŒŒì„œ]
    end

    subgraph "í™”ë©´ ìƒì„±"
        GridGen[TanStack Table ìƒì„±]
        ChartGen[Recharts ìƒì„±]
        CodeGen[TypeScript ì½”ë“œ ìƒì„±]
    end

    %% User Flow
    UI --> Upload
    Upload --> ExcelAPI
    ExcelAPI --> Parser
    
    %% Excel ë¶„ì„
    Parser --> Analyzer
    Parser --> ChartExtractor
    Parser --> FormulaParser
    
    %% AI ë§¤í•‘
    Analyzer --> MappingAPI
    MappingAPI --> Embedder
    Embedder --> OpenAI
    Embedder --> Redis
    
    %% Vector Search
    MappingAPI --> VectorSearch
    VectorSearch --> Chroma
    VectorSearch --> ES
    VectorSearch --> Redis
    
    %% LLM ê²€ì¦
    VectorSearch --> LLMValidator
    LLMValidator --> Gemini
    
    %% ì‚¬ìš©ì ê²€í† 
    LLMValidator --> Review
    Review --> FeedbackAPI
    FeedbackAPI --> Feedback
    FeedbackAPI --> Chroma
    
    %% í™”ë©´ ìƒì„±
    Review --> GridGen
    ChartExtractor --> ChartGen
    FormulaParser --> ChartGen
    
    %% ê²€ì¦
    GridGen --> ValidationAPI
    ValidationAPI --> Validation
    ValidationAPI --> Patterns
    
    %% ì½”ë“œ ìƒì„±
    GridGen --> CodeGen
    ChartGen --> CodeGen
    CodeGen --> Preview
    
    %% DB ì—°ê²°
    API --> PG
    MappingAPI --> PG
    ValidationAPI --> PG
    FeedbackAPI --> PG

    style UI fill:#e1f5ff
    style Gemini fill:#fce4ec
    style OpenAI fill:#f3e5f5
    style Chroma fill:#e8f5e9
    style Redis fill:#fff3e0
    style PG fill:#e3f2fd
```

### ë°ì´í„° íë¦„ë„

```mermaid
sequenceDiagram
    actor User as ì‚¬ìš©ì
    participant UI as Frontend
    participant API as tRPC API
    participant Parser as Excel Parser
    participant Cache as Redis Cache
    participant RAG as RAG Pipeline
    participant Chroma as Chroma DB
    participant LLM as Gemini LLM
    participant DB as PostgreSQL
    participant Gen as í™”ë©´ ìƒì„±ê¸°

    User->>UI: Excel íŒŒì¼ ì—…ë¡œë“œ
    UI->>API: analyzeExcel(file)
    API->>Parser: íŒŒì¼ íŒŒì‹±
    Parser->>Parser: êµ¬ì¡° ë¶„ì„
    
    rect rgb(230, 245, 255)
        Note over Parser,Chroma: Phase 1: DB ë§¤í•‘ (RAG)
        Parser->>RAG: ì»¬ëŸ¼ ëª©ë¡
        RAG->>Cache: ìºì‹œ í™•ì¸
        
        alt ìºì‹œ íˆíŠ¸
            Cache-->>RAG: ìºì‹œëœ ë§¤í•‘
        else ìºì‹œ ë¯¸ìŠ¤
            RAG->>Chroma: ìœ ì‚¬ë„ ê²€ìƒ‰
            Chroma-->>RAG: ìœ ì‚¬ ì»¬ëŸ¼ 5ê°œ
            RAG->>LLM: ìµœì¢… ê²€ì¦
            LLM-->>RAG: í™•ì • ë§¤í•‘ + ì‹ ë¢°ë„
            RAG->>Cache: ê²°ê³¼ ìºì‹±
        end
        
        RAG-->>API: ë§¤í•‘ ê²°ê³¼
    end
    
    rect rgb(255, 243, 224)
        Note over API,User: Phase 2: ì‚¬ìš©ì ê²€í† 
        API->>UI: ë§¤í•‘ ì œì•ˆ (ì‹ ë¢°ë„ í¬í•¨)
        UI->>User: ê²€í†  ìš”ì²­
        
        alt ì‹ ë¢°ë„ > 90%
            UI->>User: ìë™ ìŠ¹ì¸ (ì°¸ê³ ë§Œ)
        else ì‹ ë¢°ë„ < 90%
            User->>UI: ìˆ˜ë™ í™•ì¸/ìˆ˜ì •
        end
        
        User->>UI: ìŠ¹ì¸/ìˆ˜ì •
    end
    
    rect rgb(232, 245, 233)
        Note over UI,DB: Phase 3: í•™ìŠµ & ì €ì¥
        UI->>API: submitFeedback(corrections)
        API->>DB: í”¼ë“œë°± ì €ì¥
        API->>Chroma: Vector DB ì—…ë°ì´íŠ¸
        API->>Cache: ìºì‹œ ê°±ì‹ 
    end
    
    rect rgb(248, 231, 255)
        Note over API,Gen: Phase 4: í™”ë©´ ìƒì„±
        API->>Gen: í™”ë©´ ìƒì„± ìš”ì²­
        Gen->>Gen: TanStack Table ìƒì„±
        Gen->>Gen: Recharts ìƒì„±
        Gen->>Gen: TypeScript ì½”ë“œ ìƒì„±
        Gen-->>API: ìƒì„± ê²°ê³¼
    end
    
    rect rgb(255, 235, 238)
        Note over API,User: Phase 5: ê²€ì¦
        API->>API: ì •ë‹µì§€ì™€ ë¹„êµ
        API->>UI: ê²€ì¦ ë¦¬í¬íŠ¸
        UI->>User: ì •í™•ë„ ì ìˆ˜ í‘œì‹œ
        
        alt ì •í™•ë„ < 80%
            User->>UI: ìˆ˜ì • ìš”ì²­
            UI->>API: ì¬ìƒì„±
        else ì •í™•ë„ >= 80%
            User->>UI: ìµœì¢… ìŠ¹ì¸
            UI->>API: í”„ë¡œë•ì…˜ ë°°í¬
            API->>DB: í™”ë©´ ì •ë³´ ì €ì¥
        end
    end
```

### ì»´í¬ë„ŒíŠ¸ ì•„í‚¤í…ì²˜

```mermaid
graph LR
    subgraph "Frontend Components"
        ExcelUpload[ExcelUploadForm]
        MappingReview[MappingReviewTable]
        ConfidenceBar[ConfidenceIndicator]
        ScreenPreview[ScreenPreview]
        ValidationReport[ValidationReport]
    end

    subgraph "tRPC Routers"
        ExcelRouter[excel.ts]
        MappingRouter[mapping.ts]
        ValidationRouter[validation.ts]
        FeedbackRouter[feedback.ts]
        ScreenRouter[screen.ts]
    end

    subgraph "Service Layer"
        ExcelService[ExcelAnalysisService]
        RAGService[RAGMappingService]
        LearningService[ReinforcementLearningService]
        ValidationService[DataValidationService]
        GeneratorService[ScreenGeneratorService]
    end

    subgraph "Data Access Layer"
        ChromaClient[ChromaVectorStore]
        RedisClient[RedisCacheClient]
        PrismaClient[PrismaORM]
        OpenAIClient[OpenAIEmbeddings]
        GeminiClient[GeminiLLM]
    end

    ExcelUpload --> ExcelRouter
    MappingReview --> MappingRouter
    ValidationReport --> ValidationRouter
    
    ExcelRouter --> ExcelService
    MappingRouter --> RAGService
    ValidationRouter --> ValidationService
    FeedbackRouter --> LearningService
    ScreenRouter --> GeneratorService
    
    ExcelService --> PrismaClient
    RAGService --> ChromaClient
    RAGService --> RedisClient
    RAGService --> OpenAIClient
    RAGService --> GeminiClient
    LearningService --> ChromaClient
    LearningService --> PrismaClient
    ValidationService --> PrismaClient
    GeneratorService --> PrismaClient
```

### ë°°í¬ ì•„í‚¤í…ì²˜

```mermaid
graph TB
    subgraph "ê°œë°œ í™˜ê²½ (localhost)"
        Dev[ê°œë°œì ì›Œí¬ìŠ¤í…Œì´ì…˜]
        DevNext[Next.js Dev Server<br/>:3000]
        DevDocker[Docker Compose<br/>Chroma + Redis + ES]
    end

    subgraph "ìŠ¤í…Œì´ì§•/í”„ë¡œë•ì…˜ (ì˜µì…˜ 1: ë‹¨ì¼ ì„œë²„)"
        subgraph "App Server"
            NextProd[Next.js Production<br/>:3000]
            DockerProd[Docker Stack<br/>Chroma + Redis + ES]
        end
        
        subgraph "DB Server"
            PGProd[(PostgreSQL<br/>:5432)]
        end
    end

    subgraph "ìŠ¤í…Œì´ì§•/í”„ë¡œë•ì…˜ (ì˜µì…˜ 2: Kubernetes)"
        subgraph "K8s Cluster"
            NextPod[Next.js Pods<br/>Auto-scale 2-10]
            ChromaPod[Chroma StatefulSet<br/>Persistent Volume]
            RedisPod[Redis StatefulSet]
            ESPod[Elasticsearch StatefulSet]
            PGPod[(PostgreSQL<br/>Managed/Self-hosted)]
        end
        
        Ingress[Ingress Controller<br/>NGINX/Traefik]
    end

    subgraph "External Services"
        OpenAICloud[OpenAI API]
        GeminiCloud[Gemini API]
    end

    Dev --> DevNext
    Dev --> DevDocker
    
    NextProd --> DockerProd
    NextProd --> PGProd
    NextProd --> OpenAICloud
    NextProd --> GeminiCloud
    
    Ingress --> NextPod
    NextPod --> ChromaPod
    NextPod --> RedisPod
    NextPod --> ESPod
    NextPod --> PGPod
    NextPod --> OpenAICloud
    NextPod --> GeminiCloud

    style DevNext fill:#e1f5ff
    style NextProd fill:#c8e6c9
    style NextPod fill:#fff9c4
    style ChromaPod fill:#e8f5e9
    style OpenAICloud fill:#f3e5f5
    style GeminiCloud fill:#fce4ec
```

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

```mermaid
erDiagram
    SCREEN_METADATA ||--o{ COLUMN_MAPPING : has
    SCREEN_METADATA ||--o{ CHART_CONFIG : has
    SCREEN_METADATA ||--o{ VALIDATION_RESULT : has
    COLUMN_MAPPING ||--o{ MAPPING_FEEDBACK : receives
    EXCEL_PATTERN ||--o{ PATTERN_USAGE : tracks
    
    SCREEN_METADATA {
        string id PK
        string name
        string excelFileName
        datetime createdAt
        string createdBy
        string status
        json excelMetadata
        int accuracyScore
    }
    
    COLUMN_MAPPING {
        string id PK
        string screenId FK
        string excelColumn
        string tableName
        string columnName
        float confidence
        string source
        datetime mappedAt
    }
    
    MAPPING_FEEDBACK {
        string id PK
        string mappingId FK
        string aiSuggested
        string userSelected
        string reason
        datetime feedbackAt
        string userId
    }
    
    EXCEL_PATTERN {
        string id PK
        string patternType
        json structure
        int usageCount
        datetime lastUsed
        float successRate
    }
    
    PATTERN_USAGE {
        string id PK
        string patternId FK
        string screenId FK
        boolean successful
        datetime usedAt
    }
    
    CHART_CONFIG {
        string id PK
        string screenId FK
        string chartType
        json dataConfig
        json styleConfig
        string excelChartId
    }
    
    VALIDATION_RESULT {
        string id PK
        string screenId FK
        float mappingAccuracy
        float dataAccuracy
        float formulaAccuracy
        float overallAccuracy
        json details
        datetime validatedAt
    }
```

### íŒŒì¼ êµ¬ì¡°

```
ai-factory-lab/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ excel/
â”‚   â”‚   â”‚   â”œâ”€â”€ upload/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # Excel ì—…ë¡œë“œ UI
â”‚   â”‚   â”‚   â”œâ”€â”€ mapping/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx      # ë§¤í•‘ ê²€í†  UI
â”‚   â”‚   â”‚   â””â”€â”€ validation/
â”‚   â”‚   â”‚       â””â”€â”€ [id]/
â”‚   â”‚   â”‚           â””â”€â”€ page.tsx      # ê²€ì¦ ë¦¬í¬íŠ¸ UI
â”‚   â”‚   â””â”€â”€ screens/
â”‚   â”‚       â”œâ”€â”€ preview/
â”‚   â”‚       â”‚   â””â”€â”€ [id]/
â”‚   â”‚       â”‚       â””â”€â”€ page.tsx      # í™”ë©´ ë¯¸ë¦¬ë³´ê¸°
â”‚   â”‚       â””â”€â”€ generated/            # ìë™ ìƒì„±ëœ í™”ë©´ë“¤
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ excel/
â”‚   â”‚   â”‚   â”œâ”€â”€ ExcelUploadForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MappingReviewTable.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ConfidenceIndicator.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ValidationReport.tsx
â”‚   â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”‚   â”œâ”€â”€ GeneratedDataGrid.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ GeneratedChart.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ScreenPreview.tsx
â”‚   â”‚   â””â”€â”€ ui/                       # shadcn/ui ì»´í¬ë„ŒíŠ¸
â”‚   â”‚
â”‚   â”œâ”€â”€ server/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ excel.ts          # Excel ë¶„ì„ API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ mapping.ts        # ë§¤í•‘ ìƒì„± API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ validation.ts     # ê²€ì¦ API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ feedback.ts       # í”¼ë“œë°± í•™ìŠµ API
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ screen.ts         # í™”ë©´ ìƒì„± API
â”‚   â”‚   â”‚   â”œâ”€â”€ root.ts
â”‚   â”‚   â”‚   â””â”€â”€ trpc.ts
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ excel/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ parser.ts         # Excel íŒŒì‹±
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ analyzer.ts       # êµ¬ì¡° ë¶„ì„
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ chart-extractor.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ formula-parser.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ rag/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ mapping-service.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ vector-search.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ llm-validator.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ learning-service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ validation/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ mapping-validator.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ data-validator.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ formula-validator.ts
â”‚   â”‚   â”‚   â””â”€â”€ generator/
â”‚   â”‚   â”‚       â”œâ”€â”€ grid-generator.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ chart-generator.ts
â”‚   â”‚   â”‚       â””â”€â”€ code-generator.ts
â”‚   â”‚   â””â”€â”€ db.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ vectordb/
â”‚   â”‚   â”‚   â”œâ”€â”€ chroma.ts             # Chroma í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ embedding-cache.ts    # ì„ë² ë”© ìºì‹±
â”‚   â”‚   â”‚   â””â”€â”€ health.ts             # í—¬ìŠ¤ì²´í¬
â”‚   â”‚   â”œâ”€â”€ llm/
â”‚   â”‚   â”‚   â”œâ”€â”€ gemini.ts             # Gemini í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”‚   â””â”€â”€ openai.ts             # OpenAI í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ cache/
â”‚   â”‚   â”‚   â””â”€â”€ redis.ts              # Redis í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â””â”€â”€ db/
â”‚   â”‚       â””â”€â”€ metadata.ts           # DB ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘
â”‚   â”‚
â”‚   â””â”€â”€ types/
â”‚       â”œâ”€â”€ excel.ts
â”‚       â”œâ”€â”€ mapping.ts
â”‚       â”œâ”€â”€ validation.ts
â”‚       â””â”€â”€ screen.ts
â”‚
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma                 # Prisma ìŠ¤í‚¤ë§ˆ
â”‚   â””â”€â”€ seed.ts
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ init-vectordb.ts              # Vector DB ì´ˆê¸°í™”
â”‚   â”œâ”€â”€ test-search.ts                # ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ collect-db-metadata.ts        # DB ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘
â”‚
â”œâ”€â”€ docker/
â”‚   â””â”€â”€ docker-compose.yml            # Chroma + Redis + ES
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ EXCEL_TO_SCREEN_TECHNICAL_ANALYSIS.md
    â”œâ”€â”€ RAG_IMPLEMENTATION_GUIDE.md
    â””â”€â”€ API_DOCUMENTATION.md
```

### ì£¼ìš” ê¸°ìˆ  ê²°ì • (ADR)

#### ADR-001: Vector DB ì„ íƒ
**ê²°ì •**: Chroma (ë¡œì»¬)  
**ì´ìœ **:
- âœ… ì™„ì „ ë¬´ë£Œ ($40/ì›” ì ˆê°)
- âœ… LangChain ë„¤ì´í‹°ë¸Œ ì§€ì›
- âœ… Dockerë¡œ ê°„ë‹¨ ë°°í¬
- âœ… ë°ì´í„° ë³´ì•ˆ (ì™¸ë¶€ ì „ì†¡ ë¶ˆí•„ìš”)
- âœ… ë¹ ë¥¸ ì‘ë‹µ (LAN ì†ë„)

**ëŒ€ì•ˆ**: Pinecone (í´ë¼ìš°ë“œ), Qdrant, Weaviate  
**íŠ¸ë ˆì´ë“œì˜¤í”„**: ì´ˆê¸° ì„¤ì • ì‹œê°„ 30ë¶„ ì†Œìš”

#### ADR-002: LLM ì„ íƒ
**ê²°ì •**: Google Gemini 2.0 Flash  
**ì´ìœ **:
- âœ… ë¹ ë¥¸ ì‘ë‹µ ì†ë„
- âœ… ì €ë ´í•œ ë¹„ìš© ($15/ì›”)
- âœ… JSON ëª¨ë“œ ì§€ì›
- âœ… í•œê¸€ ì„±ëŠ¥ ìš°ìˆ˜

**ëŒ€ì•ˆ**: GPT-4, Claude  
**íŠ¸ë ˆì´ë“œì˜¤í”„**: ë³µì¡í•œ ì¶”ë¡ ì€ GPT-4ê°€ ë” ìš°ìˆ˜

#### ADR-003: ìºì‹± ì „ëµ
**ê²°ì •**: Redis (ë¡œì»¬)  
**ì´ìœ **:
- âœ… ì‘ë‹µ ì†ë„ 10ë°° í–¥ìƒ
- âœ… API ë¹„ìš© 30% ì ˆê°
- âœ… Dockerë¡œ ê°„ë‹¨ ë°°í¬

**ì‚¬ìš© ì‚¬ë¡€**:
- ì„ë² ë”© ìºì‹± (30ì¼)
- ë§¤í•‘ ê²°ê³¼ ìºì‹± (24ì‹œê°„)
- ì„¸ì…˜ ë°ì´í„°

#### ADR-004: UI í”„ë ˆì„ì›Œí¬
**ê²°ì •**: Next.js 15 + shadcn/ui + TanStack Table  
**ì´ìœ **:
- âœ… ì„œë²„/í´ë¼ì´ì–¸íŠ¸ í•˜ì´ë¸Œë¦¬ë“œ
- âœ… ì—”í„°í”„ë¼ì´ì¦ˆ ê¸‰ ì»´í¬ë„ŒíŠ¸
- âœ… ê³ ì„±ëŠ¥ í…Œì´ë¸” (ê°€ìƒí™”)
- âœ… TypeScript ë„¤ì´í‹°ë¸Œ

#### ADR-005: API ë ˆì´ì–´
**ê²°ì •**: tRPC  
**ì´ìœ **:
- âœ… End-to-end íƒ€ì… ì•ˆì „ì„±
- âœ… ìë™ íƒ€ì… ì¶”ë¡ 
- âœ… ì‘ì€ ë²ˆë“¤ í¬ê¸°
- âœ… Next.js ìµœì í™”

**ëŒ€ì•ˆ**: REST, GraphQL  
**íŠ¸ë ˆì´ë“œì˜¤í”„**: ì™¸ë¶€ API ë…¸ì¶œ ì–´ë ¤ì›€

#### ADR-006: ë¡œì»¬ Agent ëª¨ë¸ (ì„ íƒì‚¬í•­) ğŸ†•
**ê²°ì •**: Ollama + Llama 3.1 / Qwen 2.5  
**ì´ìœ **:
- âœ… **ì™„ì „ ë¬´ë£Œ** (í´ë¼ìš°ë“œ API ë¶ˆí•„ìš”)
- âœ… **ë°ì´í„° ë³´ì•ˆ** (ë¯¼ê° ì •ë³´ ì™¸ë¶€ ìœ ì¶œ ì°¨ë‹¨)
- âœ… **ë¹„ìš© ì ˆê°**: $40/ì›” â†’ $0/ì›” (ì „ì²´ ë¬´ë£Œí™” ê°€ëŠ¥!)
- âœ… **ë„¤íŠ¸ì›Œí¬ ë…ë¦½**: ì¸í„°ë„· ì—†ì´ ë™ì‘
- âœ… **ì»¤ìŠ¤í„°ë§ˆì´ì§•**: Fine-tuning ê°€ëŠ¥

**ì‚¬ìš© ì‚¬ë¡€**:
1. **ê°„ë‹¨í•œ ë§¤í•‘ ì‘ì—…**: ê·œì¹™ ê¸°ë°˜ìœ¼ë¡œ ì¶©ë¶„í•œ ê²½ìš°
2. **1ì°¨ í•„í„°ë§**: ë¡œì»¬ ëª¨ë¸ë¡œ í›„ë³´ ì¶”ì¶œ â†’ Geminië¡œ ê²€ì¦
3. **í”„ë¡¬í”„íŠ¸ ìµœì í™”**: ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ í›„ í´ë¼ìš°ë“œ ì ìš©
4. **ì˜¤í”„ë¼ì¸ ëª¨ë“œ**: ì¸í„°ë„· ì¥ì•  ì‹œ ê¸°ë³¸ ê¸°ëŠ¥ ì œê³µ

**íŠ¸ë ˆì´ë“œì˜¤í”„**:
- âš ï¸ ì„±ëŠ¥: Geminië³´ë‹¤ ëŠë¦¼ (5-10ì´ˆ)
- âš ï¸ ì •í™•ë„: 85% vs 92% (ì•½ 7%p ë‚®ìŒ)
- âš ï¸ ë¦¬ì†ŒìŠ¤: GPU ê¶Œì¥ (CPU ê°€ëŠ¥í•˜ì§€ë§Œ ëŠë¦¼)
- âš ï¸ ì´ˆê¸° ì„¤ì •: Ollama ì„¤ì¹˜ + ëª¨ë¸ ë‹¤ìš´ë¡œë“œ (30ë¶„)

**ê¶Œì¥ êµ¬ì„±**:
```yaml
# í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ (ë¹„ìš©/ì„±ëŠ¥ ìµœì í™”)
ê¸°ë³¸ ì „ëµ: Ollama (ë¡œì»¬)
  â†“ ì‹ ë¢°ë„ < 80%
í´ë°±: Gemini (í´ë¼ìš°ë“œ)

ì˜ˆìƒ ë¹„ìš©:
- 80% ë¡œì»¬ ì²˜ë¦¬ â†’ $40 Ã— 20% = $8/ì›”
- ìˆœì´ìµ: $415 - $8 = $407/ì›” ğŸ‰
```

---

## ğŸ¤– ë¡œì»¬ Agent ëª¨ë¸ êµ¬ì¶• ê°€ì´ë“œ

### ì™œ ë¡œì»¬ Agent ëª¨ë¸ì¸ê°€?

#### ë¹„ìš© ë¹„êµ

| êµ¬ì„± | ì›” ë¹„ìš© | ì •í™•ë„ | ì†ë„ | ë³´ì•ˆ |
|------|---------|--------|------|------|
| **í´ë¼ìš°ë“œ ì „ìš©**<br/>(Gemini + OpenAI) | $40/ì›” | 90% | âš¡âš¡âš¡ ë¹ ë¦„ | âš ï¸ ì™¸ë¶€ ì „ì†¡ |
| **ë¡œì»¬ ì „ìš©**<br/>(Ollama + Chroma) | **$0/ì›”** | 85% | âš¡ ëŠë¦¼ | âœ… ì™„ì „ ë³´ì•ˆ |
| **í•˜ì´ë¸Œë¦¬ë“œ** â­<br/>(Ollama + Gemini) | **$8/ì›”** | 90% | âš¡âš¡ ë³´í†µ | âœ… ì„ íƒì  ë³´ì•ˆ |

### ì„¤ì¹˜ ê°€ì´ë“œ

#### Step 1: Ollama ì„¤ì¹˜

```bash
# Linux
curl -fsSL https://ollama.com/install.sh | sh

# macOS
brew install ollama

# Windows
# https://ollama.com/download ì—ì„œ ì„¤ì¹˜
```

#### Step 2: ëª¨ë¸ ë‹¤ìš´ë¡œë“œ

```bash
# Llama 3.1 8B (ì¶”ì²œ - ë¹ ë¦„, í•œê¸€ ìš°ìˆ˜)
ollama pull llama3.1:8b

# Qwen 2.5 7B (ëŒ€ì•ˆ - ì½”ë“œ ìƒì„± ìš°ìˆ˜)
ollama pull qwen2.5:7b

# Gemma 2 9B (ëŒ€ì•ˆ - Google ëª¨ë¸)
ollama pull gemma2:9b

# ëª¨ë¸ í™•ì¸
ollama list
```

#### Step 3: Ollama ì„œë²„ ì‹¤í–‰

```bash
# ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
ollama serve &

# í…ŒìŠ¤íŠ¸
curl http://localhost:11434/api/generate -d '{
  "model": "llama3.1:8b",
  "prompt": "Hello, world!",
  "stream": false
}'
```

#### Step 4: Docker Compose ì—…ë°ì´íŠ¸

```yaml
# docker-compose.yml
version: '3.8'

services:
  # Ollama (ë¡œì»¬ LLM)
  ollama:
    image: ollama/ollama:latest
    container_name: ollama-agent
    ports:
      - "11434:11434"
    volumes:
      - ./ollama-data:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    # GPU ì‚¬ìš© ì‹œ (NVIDIA)
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: 1
    #           capabilities: [gpu]
    restart: unless-stopped

  # Chroma Vector Database
  chroma:
    image: chromadb/chroma:latest
    container_name: chroma-vectordb
    ports:
      - "8000:8000"
    volumes:
      - ./chroma-data:/chroma/chroma
    restart: unless-stopped

  # Redis Cache
  redis:
    image: redis:7-alpine
    container_name: redis-cache
    ports:
      - "6379:6379"
    volumes:
      - ./redis-data:/data
    restart: unless-stopped
```

```bash
# ì‹¤í–‰
docker-compose up -d

# Ollamaì— ëª¨ë¸ ë‹¤ìš´ë¡œë“œ
docker exec -it ollama-agent ollama pull llama3.1:8b
```

#### Step 5: LangChain í†µí•©

```typescript
// src/lib/llm/ollama.ts
import { Ollama } from "@langchain/community/llms/ollama";

export const ollamaLLM = new Ollama({
  baseUrl: process.env.OLLAMA_URL || "http://localhost:11434",
  model: process.env.OLLAMA_MODEL || "llama3.1:8b",
  temperature: 0.1, // ì¼ê´€ì„±ì„ ìœ„í•´ ë‚®ê²Œ ì„¤ì •
});

// ê°„ë‹¨í•œ ë§¤í•‘ ìƒì„±
export async function localMapping(
  excelColumn: string,
  dbColumns: Array<{ table: string; column: string; korean: string }>
) {
  const prompt = `
ë‹¤ìŒ Excel ì»¬ëŸ¼ëª…ì„ DB ì»¬ëŸ¼ê³¼ ë§¤í•‘í•˜ì„¸ìš”.

Excel ì»¬ëŸ¼: ${excelColumn}

DB ì»¬ëŸ¼ ëª©ë¡:
${dbColumns.map(c => `- ${c.korean} (${c.table}.${c.column})`).join('\n')}

ê°€ì¥ ì í•©í•œ DB ì»¬ëŸ¼ì„ ì„ íƒí•˜ê³ , JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{
  "table": "í…Œì´ë¸”ëª…",
  "column": "ì»¬ëŸ¼ëª…",
  "confidence": 0.0-1.0,
  "reason": "ì´ìœ "
}
`;

  const response = await ollamaLLM.invoke(prompt);
  return JSON.parse(response);
}
```

### í•˜ì´ë¸Œë¦¬ë“œ Agent êµ¬í˜„

```typescript
// src/server/services/rag/hybrid-agent.ts
import { ollamaLLM } from "~/lib/llm/ollama";
import { geminiLLM } from "~/lib/llm/gemini";
import { getCachedMapping, setCachedMapping } from "~/lib/cache/redis";

interface MappingResult {
  table: string;
  column: string;
  confidence: number;
  source: "cache" | "ollama" | "gemini";
  reason: string;
}

export async function hybridMapping(
  excelColumn: string,
  vectorResults: any[]
): Promise<MappingResult> {
  
  // 1. ìºì‹œ í™•ì¸
  const cached = await getCachedMapping(excelColumn);
  if (cached) {
    return {
      ...cached,
      source: "cache",
    };
  }

  // 2. ë¡œì»¬ Ollamaë¡œ 1ì°¨ ì¶”ë¡ 
  console.log("ğŸ¤– ë¡œì»¬ Agent ì‹¤í–‰...");
  const localResult = await localMapping(excelColumn, vectorResults);

  // 3. ì‹ ë¢°ë„ ì²´í¬
  if (localResult.confidence >= 0.80) {
    // ì‹ ë¢°ë„ ë†’ìŒ â†’ ë¡œì»¬ ê²°ê³¼ ì‚¬ìš©
    console.log("âœ… ë¡œì»¬ Agent ì‹ ë¢°ë„ ì¶©ë¶„:", localResult.confidence);
    await setCachedMapping(excelColumn, localResult);
    
    return {
      ...localResult,
      source: "ollama",
    };
  }

  // 4. ì‹ ë¢°ë„ ë‚®ìŒ â†’ Geminië¡œ ì¬ê²€ì¦
  console.log("âš ï¸ ë¡œì»¬ Agent ì‹ ë¢°ë„ ë‚®ìŒ, Gemini í˜¸ì¶œ...");
  const geminiResult = await geminiMapping(excelColumn, vectorResults);

  // 5. Gemini ê²°ê³¼ ìºì‹±
  await setCachedMapping(excelColumn, geminiResult);

  return {
    ...geminiResult,
    source: "gemini",
  };
}

// í†µê³„ ì¶”ì 
export async function getMappingStats() {
  const stats = await redis.hgetall("mapping:stats");
  
  return {
    cache: parseInt(stats.cache || "0"),
    ollama: parseInt(stats.ollama || "0"),
    gemini: parseInt(stats.gemini || "0"),
    total: parseInt(stats.total || "0"),
    cacheHitRate: (parseInt(stats.cache || "0") / parseInt(stats.total || "1")) * 100,
    localProcessingRate: (parseInt(stats.ollama || "0") / parseInt(stats.total || "1")) * 100,
  };
}
```

### ì„±ëŠ¥ ë¹„êµ

```typescript
// scripts/benchmark-agents.ts
import { ollamaLLM } from "~/lib/llm/ollama";
import { geminiLLM } from "~/lib/llm/gemini";

async function benchmark() {
  const testCases = [
    { excel: "ê³µì •ëª…", expected: "process_master.process_name" },
    { excel: "ë¶€ì„œ", expected: "dept_master.dept_name" },
    { excel: "ê¸ˆì•¡", expected: "cost_detail.amount" },
    { excel: "ìˆ˜ëŸ‰", expected: "inventory.quantity" },
    { excel: "ë‚ ì§œ", expected: "transaction.trans_date" },
  ];

  console.log("ğŸ Agent ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘...\n");

  // Ollama í…ŒìŠ¤íŠ¸
  console.log("ğŸ¤– Ollama (ë¡œì»¬):");
  const ollamaStart = Date.now();
  let ollamaCorrect = 0;

  for (const test of testCases) {
    const start = Date.now();
    const result = await localMapping(test.excel, vectorResults);
    const elapsed = Date.now() - start;
    
    const isCorrect = `${result.table}.${result.column}` === test.expected;
    if (isCorrect) ollamaCorrect++;

    console.log(`  ${test.excel}: ${elapsed}ms, ${isCorrect ? 'âœ…' : 'âŒ'}`);
  }

  const ollamaTotal = Date.now() - ollamaStart;
  const ollamaAccuracy = (ollamaCorrect / testCases.length) * 100;

  // Gemini í…ŒìŠ¤íŠ¸
  console.log("\nâ˜ï¸ Gemini (í´ë¼ìš°ë“œ):");
  const geminiStart = Date.now();
  let geminiCorrect = 0;

  for (const test of testCases) {
    const start = Date.now();
    const result = await geminiMapping(test.excel, vectorResults);
    const elapsed = Date.now() - start;
    
    const isCorrect = `${result.table}.${result.column}` === test.expected;
    if (isCorrect) geminiCorrect++;

    console.log(`  ${test.excel}: ${elapsed}ms, ${isCorrect ? 'âœ…' : 'âŒ'}`);
  }

  const geminiTotal = Date.now() - geminiStart;
  const geminiAccuracy = (geminiCorrect / testCases.length) * 100;

  // ê²°ê³¼ ìš”ì•½
  console.log("\nğŸ“Š ê²°ê³¼ ìš”ì•½:");
  console.log("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");
  console.log("â”‚ Agent       â”‚ ì´ ì‹œê°„   â”‚ í‰ê·      â”‚ ì •í™•ë„   â”‚");
  console.log("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤");
  console.log(`â”‚ Ollama      â”‚ ${ollamaTotal}ms â”‚ ${Math.round(ollamaTotal/testCases.length)}ms    â”‚ ${ollamaAccuracy}%     â”‚`);
  console.log(`â”‚ Gemini      â”‚ ${geminiTotal}ms â”‚ ${Math.round(geminiTotal/testCases.length)}ms    â”‚ ${geminiAccuracy}%     â”‚`);
  console.log("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
}

benchmark().catch(console.error);
```

### ì˜ˆìƒ ê²°ê³¼

```
ğŸ“Š ê²°ê³¼ ìš”ì•½:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Agent       â”‚ ì´ ì‹œê°„   â”‚ í‰ê·      â”‚ ì •í™•ë„   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ollama      â”‚ 25000ms  â”‚ 5000ms   â”‚ 85%      â”‚
â”‚ Gemini      â”‚ 3000ms   â”‚ 600ms    â”‚ 92%      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ (80% ì‹ ë¢°ë„ ê¸°ì¤€):
- 80% â†’ Ollama ì²˜ë¦¬
- 20% â†’ Gemini í´ë°±
- í‰ê·  ì†ë„: 4200ms
- í‰ê·  ì •í™•ë„: 90%
- ë¹„ìš© ì ˆê°: 80%
```

### ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰

| ëª¨ë¸ | ë©”ëª¨ë¦¬ | ë””ìŠ¤í¬ | GPU | CPU |
|------|--------|--------|-----|-----|
| llama3.1:8b | 8GB | 4.7GB | ì„ íƒ | 4 cores |
| qwen2.5:7b | 7GB | 4.4GB | ì„ íƒ | 4 cores |
| gemma2:9b | 9GB | 5.5GB | ì„ íƒ | 4 cores |

**ìµœì†Œ ì‚¬ì–‘**:
- RAM: 16GB (ëª¨ë¸ 8GB + ì‹œìŠ¤í…œ 8GB)
- ë””ìŠ¤í¬: 10GB ì—¬ìœ  ê³µê°„
- CPU: 4 cores ì´ìƒ
- GPU: ì„ íƒì‚¬í•­ (ê¶Œì¥: NVIDIA RTX 3060 ì´ìƒ)

**GPU vs CPU ì†ë„**:
- GPU: ~1-2ì´ˆ/ìš”ì²­
- CPU: ~5-10ì´ˆ/ìš”ì²­

### Fine-tuning (ì„ íƒì‚¬í•­)

```typescript
// íšŒì‚¬ ë„ë©”ì¸ì— ë§ì¶° ëª¨ë¸ íŠœë‹
// OllamaëŠ” ì§ì ‘ fine-tuning ë¯¸ì§€ì›
// ëŒ€ì•ˆ: í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ + Few-shot Learning

const fewShotPrompt = `
ë‹¹ì‹ ì€ ì œì¡°ì—… ERP ì‹œìŠ¤í…œì˜ DB ë§¤í•‘ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

í•™ìŠµ ì˜ˆì œ:
1. "ê³µì •ëª…" â†’ process_master.process_name
2. "ê³µì •ì½”ë“œ" â†’ process_master.process_code
3. "ë¶€ì„œ" â†’ dept_master.dept_name
4. "ë¶€ì„œì½”ë“œ" â†’ dept_master.dept_code
5. "ê¸ˆì•¡" â†’ cost_detail.amount

ì´ì œ ë‹¤ìŒ ì»¬ëŸ¼ì„ ë§¤í•‘í•˜ì„¸ìš”:
Excel ì»¬ëŸ¼: ${excelColumn}

DB ì»¬ëŸ¼ ëª©ë¡:
${dbColumns.map(c => `- ${c.korean} (${c.table}.${c.column})`).join('\n')}

JSONìœ¼ë¡œ ì‘ë‹µ:
{
  "table": "...",
  "column": "...",
  "confidence": 0.0-1.0,
  "reason": "..."
}
`;
```

### í™˜ê²½ ë³€ìˆ˜ ì—…ë°ì´íŠ¸

```bash
# .env

# ë¡œì»¬ Agent (ì„ íƒì‚¬í•­)
OLLAMA_URL=http://localhost:11434
OLLAMA_MODEL=llama3.1:8b
OLLAMA_ENABLED=true

# í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ
HYBRID_MODE=true
CONFIDENCE_THRESHOLD=0.80  # 80% ë¯¸ë§Œì´ë©´ Gemini í˜¸ì¶œ

# í´ë¼ìš°ë“œ API (í´ë°±ìš©)
GEMINI_API_KEY=AIza...
OPENAI_API_KEY=sk-...

# Vector DB
CHROMA_URL=http://localhost:8000

# Cache
REDIS_HOST=localhost
REDIS_PORT=6379
```

### ë¹„ìš© ì‹œë®¬ë ˆì´ì…˜

```typescript
// ì›” 20ê°œ í™”ë©´, ê° í™”ë©´ë‹¹ í‰ê·  10ê°œ ì»¬ëŸ¼ ë§¤í•‘

ì‹œë‚˜ë¦¬ì˜¤ 1: í´ë¼ìš°ë“œ ì „ìš©
- ì´ ë§¤í•‘: 200íšŒ/ì›”
- Gemini í˜¸ì¶œ: 200íšŒ
- ë¹„ìš©: $40/ì›”

ì‹œë‚˜ë¦¬ì˜¤ 2: ë¡œì»¬ ì „ìš©
- ì´ ë§¤í•‘: 200íšŒ/ì›”
- Ollama ì²˜ë¦¬: 200íšŒ
- ë¹„ìš©: $0/ì›”
- ë‹¨ì : ì •í™•ë„ 85% (vs 92%)

ì‹œë‚˜ë¦¬ì˜¤ 3: í•˜ì´ë¸Œë¦¬ë“œ (ì¶”ì²œ) â­
- ì´ ë§¤í•‘: 200íšŒ/ì›”
- ìºì‹œ íˆíŠ¸: 120íšŒ (60%)
- Ollama ì²˜ë¦¬: 64íšŒ (80% of 80)
- Gemini í´ë°±: 16íšŒ (20% of 80)
- ë¹„ìš©: $16 Ã— 20% = $3.2/ì›”
- ì •í™•ë„: 90% (Ollama 85% Ã— 80% + Gemini 92% Ã— 20%)
```

### ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

```typescript
// src/app/admin/agent-stats/page.tsx
export default function AgentStatsPage() {
  const stats = useAgentStats();

  return (
    <div className="p-6">
      <h1 className="text-2xl font-bold mb-6">Agent ì„±ëŠ¥ í†µê³„</h1>

      <div className="grid grid-cols-4 gap-4 mb-6">
        <StatCard
          title="ì´ ë§¤í•‘"
          value={stats.total}
          icon="ğŸ“Š"
        />
        <StatCard
          title="ìºì‹œ íˆíŠ¸"
          value={`${stats.cacheHitRate.toFixed(1)}%`}
          icon="âš¡"
        />
        <StatCard
          title="ë¡œì»¬ ì²˜ë¦¬"
          value={`${stats.localProcessingRate.toFixed(1)}%`}
          icon="ğŸ¤–"
        />
        <StatCard
          title="ì›” ë¹„ìš©"
          value={`$${stats.monthlyCost.toFixed(2)}`}
          icon="ğŸ’°"
        />
      </div>

      <div className="grid grid-cols-2 gap-4">
        <PieChart data={[
          { name: "ìºì‹œ", value: stats.cache },
          { name: "Ollama", value: stats.ollama },
          { name: "Gemini", value: stats.gemini },
        ]} />

        <LineChart data={stats.dailyStats} />
      </div>
    </div>
  );
}
```

---

## ğŸ¯ êµ¬í˜„ ì „ëµ ë¹„êµ ë° ì¶”ì²œ

### ë°©ì•ˆ ë¹„êµ

#### 1ì•ˆ: Gemini ë¨¼ì € â†’ Ollama ì „í™˜
```
Phase 1 (Week 1-4): Gemini í´ë¼ìš°ë“œë¡œ ë¹ ë¥¸ í”„ë¡œí† íƒ€ì…
  â†“
Phase 2 (Week 5-6): Ollama ì„¤ì¹˜ ë° ë§ˆì´ê·¸ë ˆì´ì…˜
  â†“
Phase 3 (Week 7-9): í•˜ì´ë¸Œë¦¬ë“œ ìµœì í™”
```

**ì¥ì :**
- âœ… **ë¹ ë¥¸ ì‹œì‘**: API í‚¤ë§Œ ìˆìœ¼ë©´ ì¦‰ì‹œ ê°œë°œ ê°€ëŠ¥
- âœ… **ê²€ì¦ ìš©ì´**: í´ë¼ìš°ë“œ LLMìœ¼ë¡œ ì •í™•ë„ ë¨¼ì € í™•ì¸
- âœ… **ë¦¬ìŠ¤í¬ ìµœì†Œ**: Ollama ì„±ëŠ¥ì´ ë¶€ì¡±í•´ë„ í´ë°± ê°€ëŠ¥
- âœ… **ë‹¨ê³„ì  í•™ìŠµ**: LLM í†µí•© â†’ ë¡œì»¬ ìµœì í™” ìˆœì°¨ í•™ìŠµ
- âœ… **ìœ ì—°í•œ ë§ˆì´ê·¸ë ˆì´ì…˜**: ì›í•  ë•Œ ì „í™˜ ê°€ëŠ¥

**ë‹¨ì :**
- âš ï¸ ì´ˆê¸° ë¹„ìš© ë°œìƒ ($40/ì›” Ã— 1-2ê°œì›”)
- âš ï¸ ì½”ë“œ ìˆ˜ì • í•„ìš” (Gemini â†’ Ollama)
- âš ï¸ ì „í™˜ ì‘ì—… ì‹œê°„ ì†Œìš” (1ì£¼)

**íƒ€ì„ë¼ì¸:**
```
Week 1-2: Gemini + Chroma RAG êµ¬ì¶•
Week 3-4: ê¸°ë³¸ í™”ë©´ ìƒì„± ì™„ì„±
Week 5: Ollama ì„¤ì¹˜ ë° í…ŒìŠ¤íŠ¸
Week 6: Gemini â†’ Ollama ë§ˆì´ê·¸ë ˆì´ì…˜
Week 7-9: í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ êµ¬í˜„ ë° ìµœì í™”
```

**ì˜ˆìƒ ë¹„ìš©:**
- ê°œë°œ ê¸°ê°„ (2ê°œì›”): $40 Ã— 2 = $80
- ì´í›„ í•˜ì´ë¸Œë¦¬ë“œ: $3.2/ì›”

---

#### 2ì•ˆ: ì²˜ìŒë¶€í„° Ollama
```
Phase 1 (Week 1): Ollama + Chroma í™˜ê²½ êµ¬ì¶•
  â†“
Phase 2 (Week 2-6): ë¡œì»¬ Agent ê°œë°œ
  â†“
Phase 3 (Week 7-9): ì„±ëŠ¥ ìµœì í™”
```

**ì¥ì :**
- âœ… **ì™„ì „ ë¬´ë£Œ**: ê°œë°œë¶€í„° ìš´ì˜ê¹Œì§€ $0
- âœ… **ë°ì´í„° ë³´ì•ˆ**: ì²˜ìŒë¶€í„° ë¯¼ê° ì •ë³´ ë³´í˜¸
- âœ… **ì¼ê´€ëœ ì•„í‚¤í…ì²˜**: í•œ ë²ˆë§Œ êµ¬í˜„
- âœ… **ë¡œì»¬ ìµœì í™” ê²½í—˜**: ë¡œì»¬ LLM ë…¸í•˜ìš° ì¶•ì 

**ë‹¨ì :**
- âš ï¸ **ëŠë¦° ì‹œì‘**: í™˜ê²½ ì„¤ì • ì‹œê°„ ì†Œìš” (1-2ì¼)
- âš ï¸ **ì„±ëŠ¥ ë¶ˆí™•ì‹¤**: Ollama ì •í™•ë„ ì‚¬ì „ ê²€ì¦ ì–´ë ¤ì›€
- âš ï¸ **í•˜ë“œì›¨ì–´ ì˜ì¡´**: GPU ì—†ìœ¼ë©´ ë§¤ìš° ëŠë¦¼
- âš ï¸ **ë””ë²„ê¹… ì–´ë ¤ì›€**: ë¡œì»¬ LLMì€ ì—ëŸ¬ ë©”ì‹œì§€ ë¶ˆëª…í™•
- âš ï¸ **í•™ìŠµ ê³¡ì„ **: Ollama í”„ë¡¬í”„íŠ¸ ìµœì í™” ì‹œí–‰ì°©ì˜¤

**íƒ€ì„ë¼ì¸:**
```
Week 1: Ollama + Chroma í™˜ê²½ êµ¬ì¶• + ëª¨ë¸ ë‹¤ìš´ë¡œë“œ
Week 2-4: ë¡œì»¬ Agent ê°œë°œ ë° í”„ë¡¬í”„íŠ¸ íŠœë‹
Week 5-6: RAG í†µí•© ë° í…ŒìŠ¤íŠ¸
Week 7-9: ì„±ëŠ¥ ìµœì í™” (ì •í™•ë„ 85% ëª©í‘œ)
```

**ì˜ˆìƒ ë¹„ìš©:**
- ì „ì²´ ê°œë°œ/ìš´ì˜: $0 (OpenAI Embeddingsë§Œ $25/ì›”)

---

### ğŸ¯ JARVIS ì¶”ì²œ: **3ì•ˆ (í•˜ì´ë¸Œë¦¬ë“œ ë‹¨ê³„ë³„ ì ‘ê·¼)** â­â­â­â­â­

```
Phase 0 (Week 1): í™˜ê²½ ì¤€ë¹„
  - Gemini API í‚¤ ë°œê¸‰ (ì¦‰ì‹œ ì‚¬ìš©)
  - Ollama ì„¤ì¹˜ + ëª¨ë¸ ë‹¤ìš´ë¡œë“œ (ë°±ê·¸ë¼ìš´ë“œ)
  - ë‘ ê°œë¥¼ ë™ì‹œì— ì¤€ë¹„!

Phase 1 (Week 2-3): Geminië¡œ ë¹ ë¥¸ í”„ë¡œí† íƒ€ì…
  - RAG íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
  - ê¸°ë³¸ ë§¤í•‘ ê¸°ëŠ¥ ì™„ì„±
  - ì •í™•ë„ ë²¤ì¹˜ë§ˆí¬ í™•ë³´ (92% ëª©í‘œ)

Phase 2 (Week 4): Ollama ë³‘ë ¬ í…ŒìŠ¤íŠ¸
  - ë™ì¼í•œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¡œ Ollama ê²€ì¦
  - Gemini vs Ollama ì •í™•ë„ ë¹„êµ
  - í”„ë¡¬í”„íŠ¸ ìµœì í™”

Phase 3 (Week 5-6): í•˜ì´ë¸Œë¦¬ë“œ êµ¬í˜„
  - ì¶”ìƒí™” ë ˆì´ì–´ êµ¬í˜„ (LLM Provider ì¸í„°í˜ì´ìŠ¤)
  - ì‹ ë¢°ë„ ê¸°ë°˜ ë¼ìš°íŒ…
  - ìºì‹± ì „ëµ ì ìš©

Phase 4 (Week 7-9): ì ì§„ì  ì „í™˜
  - Ollama ë¹„ìœ¨ ì ì§„ì  ì¦ê°€ (0% â†’ 50% â†’ 80%)
  - ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ë° ì¡°ì •
  - ë¹„ìš©/ì„±ëŠ¥ ìµœì í™”
```

#### ì™œ 3ì•ˆì¸ê°€?

**1. ë¦¬ìŠ¤í¬ ì œë¡œ**
```
Geminiê°€ ë³´í—˜
  â†“
Ollama ì„±ëŠ¥ ì¢‹ìŒ â†’ ë¹„ìš© ì ˆê° ($40 â†’ $3.2)
Ollama ì„±ëŠ¥ ë‚˜ì¨ â†’ Gemini ê³„ì† ì‚¬ìš© (ê¸°ëŠ¥ì€ ë³´ì¥)
```

**2. ë¹ ë¥¸ ê²€ì¦**
```
Week 2-3: Geminië¡œ í•µì‹¬ ê¸°ëŠ¥ ì™„ì„±
  â†’ ê²½ì˜ì§„/ì‚¬ìš©ìì—ê²Œ ë°ëª¨ ê°€ëŠ¥
  â†’ í”„ë¡œì íŠ¸ ê°€ì¹˜ ì¦ëª…
```

**3. ìµœì ì˜ í•™ìŠµ**
```
Gemini ê²°ê³¼ = ì •ë‹µì§€
  â†“
Ollamaê°€ Geminië¥¼ ë”°ë¼ì¡ë„ë¡ íŠœë‹
  â†“
í”„ë¡¬í”„íŠ¸ ìµœì í™” ë°©í–¥ ëª…í™•
```

**4. ìœ ì—°í•œ ë¹„ìš© ì¡°ì ˆ**
```
ì´ˆê¸° (ê°œë°œ): Gemini 100% ($40/ì›”)
  â†“
ì¤‘ê¸° (ê²€ì¦): Gemini 50% + Ollama 50% ($20/ì›”)
  â†“
ì¥ê¸° (ìš´ì˜): Gemini 8% + Ollama 92% ($3.2/ì›”)
```

**5. ì ì§„ì  ì „í™˜**
```typescript
// ì¶”ìƒí™” ë ˆì´ì–´ë¡œ ì‰¬ìš´ ì „í™˜
interface LLMProvider {
  invoke(prompt: string): Promise<string>;
}

class GeminiProvider implements LLMProvider { ... }
class OllamaProvider implements LLMProvider { ... }

// í™˜ê²½ ë³€ìˆ˜ë¡œ ì „í™˜
const provider = process.env.LLM_PROVIDER === 'ollama' 
  ? new OllamaProvider() 
  : new GeminiProvider();

// ë˜ëŠ” í•˜ì´ë¸Œë¦¬ë“œ
const provider = new HybridProvider({
  primary: new OllamaProvider(),
  fallback: new GeminiProvider(),
  threshold: 0.80
});
```

---

### êµ¬í˜„ ë¡œë“œë§µ (3ì•ˆ ê¸°ì¤€)

#### Week 1: í™˜ê²½ ì¤€ë¹„ (ë³‘ë ¬)
```bash
# 1. Gemini ì¤€ë¹„ (5ë¶„)
export GEMINI_API_KEY=AIza...

# 2. Ollama ì¤€ë¹„ (30ë¶„, ë°±ê·¸ë¼ìš´ë“œ)
curl -fsSL https://ollama.com/install.sh | sh
ollama pull llama3.1:8b &

# 3. Docker Compose (10ë¶„)
docker-compose up -d
```

**ì‚°ì¶œë¬¼:**
- âœ… Gemini ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥
- âœ… Ollama ë°±ê·¸ë¼ìš´ë“œ ë‹¤ìš´ë¡œë“œ
- âœ… Chroma + Redis ì‹¤í–‰

---

#### Week 2-3: Gemini í”„ë¡œí† íƒ€ì…
```typescript
// src/lib/llm/provider.ts
export interface LLMProvider {
  name: string;
  invoke(prompt: string): Promise<string>;
  getCost(tokens: number): number;
}

// src/lib/llm/gemini-provider.ts
export class GeminiProvider implements LLMProvider {
  name = 'gemini';
  
  async invoke(prompt: string) {
    const result = await gemini.generateContent(prompt);
    return result.response.text();
  }
  
  getCost(tokens: number) {
    return tokens * 0.00001; // $0.01 per 1K tokens
  }
}

// ì‚¬ìš©
const llm: LLMProvider = new GeminiProvider();
const result = await llm.invoke(prompt);
```

**ì‚°ì¶œë¬¼:**
- âœ… RAG íŒŒì´í”„ë¼ì¸ ì™„ì„±
- âœ… ê¸°ë³¸ ë§¤í•‘ ê¸°ëŠ¥ ì‘ë™
- âœ… ì •í™•ë„ ë²¤ì¹˜ë§ˆí¬: 92%
- âœ… ë°ëª¨ ê°€ëŠ¥ ìƒíƒœ

---

#### Week 4: Ollama ë³‘ë ¬ í…ŒìŠ¤íŠ¸
```typescript
// src/lib/llm/ollama-provider.ts
export class OllamaProvider implements LLMProvider {
  name = 'ollama';
  
  async invoke(prompt: string) {
    const result = await ollama.invoke(prompt);
    return result;
  }
  
  getCost(tokens: number) {
    return 0; // ë¬´ë£Œ!
  }
}

// ë²¤ì¹˜ë§ˆí¬
const testCases = [...]; // Geminië¡œ ê²€ì¦ëœ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

const geminiResults = await runBenchmark(new GeminiProvider(), testCases);
const ollamaResults = await runBenchmark(new OllamaProvider(), testCases);

console.log('Gemini ì •í™•ë„:', geminiResults.accuracy); // 92%
console.log('Ollama ì •í™•ë„:', ollamaResults.accuracy); // 85%?
console.log('Ollama ê°œì„  í•„ìš”:', geminiResults.accuracy - ollamaResults.accuracy);
```

**ì‚°ì¶œë¬¼:**
- âœ… Ollama ì •í™•ë„ ì¸¡ì •
- âœ… í”„ë¡¬í”„íŠ¸ ìµœì í™” ë°©í–¥ íŒŒì•…
- âœ… Gemini vs Ollama ë¹„êµ ë¦¬í¬íŠ¸

---

#### Week 5-6: í•˜ì´ë¸Œë¦¬ë“œ êµ¬í˜„
```typescript
// src/lib/llm/hybrid-provider.ts
export class HybridProvider implements LLMProvider {
  name = 'hybrid';
  
  constructor(
    private primary: LLMProvider,   // Ollama
    private fallback: LLMProvider,  // Gemini
    private threshold: number = 0.80
  ) {}
  
  async invoke(prompt: string) {
    // 1ì°¨: Primary (Ollama)
    const start = Date.now();
    const result = await this.primary.invoke(prompt);
    const elapsed = Date.now() - start;
    
    // ì‹ ë¢°ë„ í‰ê°€
    const confidence = await this.evaluateConfidence(result);
    
    // í†µê³„ ê¸°ë¡
    await this.logStats({
      provider: this.primary.name,
      confidence,
      elapsed,
      cost: 0
    });
    
    // ì‹ ë¢°ë„ ë†’ìœ¼ë©´ ë°”ë¡œ ë°˜í™˜
    if (confidence >= this.threshold) {
      return result;
    }
    
    // 2ì°¨: Fallback (Gemini)
    console.log('âš ï¸ Confidence low, using fallback...');
    const fallbackResult = await this.fallback.invoke(prompt);
    
    await this.logStats({
      provider: this.fallback.name,
      confidence: 1.0,
      elapsed: Date.now() - start,
      cost: this.fallback.getCost(1000)
    });
    
    return fallbackResult;
  }
}

// ì‚¬ìš©
const llm = new HybridProvider(
  new OllamaProvider(),
  new GeminiProvider(),
  0.80
);
```

**ì‚°ì¶œë¬¼:**
- âœ… í•˜ì´ë¸Œë¦¬ë“œ Provider ì™„ì„±
- âœ… ì‹ ë¢°ë„ í‰ê°€ ë¡œì§
- âœ… í†µê³„ ìˆ˜ì§‘ ì‹œìŠ¤í…œ
- âœ… ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

---

#### Week 7-9: ì ì§„ì  ì „í™˜ ë° ìµœì í™”
```typescript
// í™˜ê²½ ë³€ìˆ˜ë¡œ Ollama ë¹„ìœ¨ ì¡°ì ˆ
// .env
OLLAMA_RATIO=0.0  // Week 7: Gemini 100%
OLLAMA_RATIO=0.5  // Week 8: Ollama 50%, Gemini 50%
OLLAMA_RATIO=0.8  // Week 9: Ollama 80%, Gemini 20%

// src/lib/llm/smart-provider.ts
export class SmartProvider implements LLMProvider {
  async invoke(prompt: string) {
    const random = Math.random();
    const ollamaRatio = parseFloat(process.env.OLLAMA_RATIO || '0');
    
    // A/B í…ŒìŠ¤íŠ¸
    if (random < ollamaRatio) {
      return this.hybrid.invoke(prompt); // Ollama ìš°ì„ 
    } else {
      return this.gemini.invoke(prompt); // Gemini ì§ì ‘
    }
  }
}
```

**ëª¨ë‹ˆí„°ë§:**
```typescript
// ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ
const stats = {
  week7: { ollama: 0%, gemini: 100%, accuracy: 92%, cost: $40 },
  week8: { ollama: 50%, gemini: 50%, accuracy: 90%, cost: $20 },
  week9: { ollama: 80%, gemini: 20%, accuracy: 89%, cost: $8 }
};

// ìµœì¢… ê²°ì •
if (stats.week9.accuracy >= 85%) {
  console.log('âœ… Ollama ì „í™˜ ì„±ê³µ!');
  process.env.OLLAMA_RATIO = '0.92'; // ìµœì¢…: 92% Ollama
} else {
  console.log('âš ï¸ Gemini ìœ ì§€ í•„ìš”');
  process.env.OLLAMA_RATIO = '0.5';
}
```

**ì‚°ì¶œë¬¼:**
- âœ… ì ì§„ì  ì „í™˜ ì™„ë£Œ
- âœ… ë¹„ìš©/ì„±ëŠ¥ ìµœì í™”
- âœ… í”„ë¡œë•ì…˜ ë°°í¬ ì¤€ë¹„

---

### ë¹„ìš© ì‹œë®¬ë ˆì´ì…˜ (3ì•ˆ)

| ê¸°ê°„ | Gemini ì‚¬ìš© | Ollama ì‚¬ìš© | ì›” ë¹„ìš© | ì •í™•ë„ |
|------|-------------|-------------|---------|--------|
| Week 1 (ì¤€ë¹„) | 0% | 0% | $0 | - |
| Week 2-3 (ê°œë°œ) | 100% | 0% | $40 | 92% |
| Week 4 (í…ŒìŠ¤íŠ¸) | 100% | 0% | $40 | 92% |
| Week 5-6 (í•˜ì´ë¸Œë¦¬ë“œ) | 50% | 50% | $20 | 91% |
| Week 7 (ì „í™˜ ì‹œì‘) | 50% | 50% | $20 | 90% |
| Week 8 (ì „í™˜ ì¤‘) | 20% | 80% | $8 | 89% |
| Week 9+ (ìš´ì˜) | 8% | 92% | **$3.2** | 88% |

**ì´ ê°œë°œ ë¹„ìš©**: $148 (9ì£¼)  
**ìš´ì˜ ë¹„ìš©**: $3.2/ì›”  
**ìˆœì´ìµ**: $412/ì›” (ìš´ì˜ ì‹œ)  
**íšŒìˆ˜ ê¸°ê°„**: 0.4ê°œì›” (2ì£¼!)

---

### ìµœì¢… ì¶”ì²œ ìš”ì•½

| ë°©ì•ˆ | ë¦¬ìŠ¤í¬ | ë¹„ìš© | ê°œë°œ ì†ë„ | í•™ìŠµ | ì¶”ì²œë„ |
|------|--------|------|-----------|------|--------|
| 1ì•ˆ (Gemini â†’ Ollama) | ë‚®ìŒ | ì¤‘ê°„ | ë¹ ë¦„ | ì¤‘ê°„ | â­â­â­â­ |
| 2ì•ˆ (Ollama ì „ìš©) | ë†’ìŒ | ìµœì € | ëŠë¦¼ | ë†’ìŒ | â­â­â­ |
| **3ì•ˆ (í•˜ì´ë¸Œë¦¬ë“œ)** | **ìµœì €** | **ìµœì €** | **ìµœê³ ** | **ìµœê³ ** | **â­â­â­â­â­** |

### JARVIS ìµœì¢… ì˜ê²¬

**3ì•ˆì„ ê°•ë ¥ ì¶”ì²œí•©ë‹ˆë‹¤!** ğŸ¯

**ì´ìœ :**
1. **ë¦¬ìŠ¤í¬ ì œë¡œ**: Geminiê°€ í•­ìƒ ë°±ì—…
2. **ë¹ ë¥¸ ì„±ê³¼**: 2-3ì£¼ ë‚´ ë°ëª¨ ê°€ëŠ¥
3. **ìµœì  ë¹„ìš©**: ì¥ê¸°ì ìœ¼ë¡œ $3.2/ì›”
4. **ë°°ì›€ì˜ ê¸°íšŒ**: ë‘ ëª¨ë¸ ëª¨ë‘ ê²½í—˜
5. **ìœ ì—°ì„± ìµœëŒ€**: ì–¸ì œë“  ì¡°ì ˆ ê°€ëŠ¥

**ì‹¤í–‰ ê³„íš:**
```bash
# ì˜¤ëŠ˜ ë°”ë¡œ ì‹œì‘!
# 1. Gemini API í‚¤ ë°œê¸‰ (5ë¶„)
https://aistudio.google.com/app/apikey

# 2. Ollama ì„¤ì¹˜ (ë°±ê·¸ë¼ìš´ë“œ, 30ë¶„)
curl -fsSL https://ollama.com/install.sh | sh
ollama pull llama3.1:8b &

# 3. ê°œë°œ ì‹œì‘ (Geminië¡œ)
npm run dev
```

**ì¤‘ìš”í•œ ì :**
> "ì™„ë²½ì„ ê¸°ë‹¤ë¦¬ì§€ ë§ê³ , ì‘ë™í•˜ëŠ” ê²ƒë¶€í„° ë§Œë“¤ì–´ë¼"
> 
> Geminië¡œ ë¹ ë¥´ê²Œ ì‹œì‘ â†’ ê°€ì¹˜ ì¦ëª… â†’ ì ì§„ì  ìµœì í™”
> 
> ì´ê²ƒì´ ì‹¤ì „ AI í”„ë¡œì íŠ¸ì˜ ì •ì„ì…ë‹ˆë‹¤! ğŸš€

---

**ì—…ë°ì´íŠ¸:** 2025-12-02 (êµ¬í˜„ ì „ëµ ë¹„êµ ë° 3ì•ˆ í•˜ì´ë¸Œë¦¬ë“œ ì¶”ì²œ)

**ì‘ì„±ì:** GitHub Copilot (JARVIS)  
**ì—…ë°ì´íŠ¸:** 2025-12-02 (RAG ê°•í™” í•™ìŠµ ì „ëµ ì¶”ê°€)  
**ê²€í†  í•„ìš”:** í”„ë¡œì íŠ¸ ë¦¬ë”, ì‚¬ìš©ì ëŒ€í‘œ
