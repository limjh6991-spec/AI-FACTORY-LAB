<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dowinsys.production.ProductionResultMapper">

    <!-- 생산 실적 관리 목록 조회 -->
    <select id="selectList" parameterType="map" resultType="map">
        SELECT
        result_id,
        prd_date,
        factory_cd,
        line_cd,
        shift_cd,
        item_cd,
        item_nm,
        spec,
        unit,
        plan_qty,
        prod_qty,
        good_qty,
        defect_qty,
        defect_type,
        defect_reason,
        start_time,
        end_time,
        work_time,
        stop_time,
        worker_id,
        worker_nm,
        team_cd,
        inspect_yn,
        inspect_result,
        inspector_id,
        remark,
        status,
        confirm_yn,
        reg_id,
        reg_dt,
        upd_id,
        upd_dt
        FROM unknown_table
        WHERE 1=1
        <if test="prdDateFrom != null and prdDateFrom != ''">
            AND prd_date &gt;= #{prdDateFrom}
        </if>
        <if test="prdDateTo != null and prdDateTo != ''">
            AND prd_date &lt;= #{prdDateTo}
        </if>
        <if test="factoryCd != null and factoryCd != ''">
            AND factory_cd = #{factoryCd}
        </if>
        <if test="lineCd != null and lineCd != ''">
            AND line_cd = #{lineCd}
        </if>
        <if test="shiftCd != null and shiftCd != ''">
            AND shift_cd = #{shiftCd}
        </if>
        <if test="itemCd != null and itemCd != ''">
            AND item_cd LIKE '%' + #{itemCd} + '%'
        </if>
        <if test="itemNm != null and itemNm != ''">
            AND item_nm LIKE '%' + #{itemNm} + '%'
        </if>
        <if test="workerId != null and workerId != ''">
            AND worker_id = #{workerId}
        </if>
        <if test="status != null and status != ''">
            AND status = #{status}
        </if>
        <if test="confirmYn != null and confirmYn != ''">
            AND confirm_yn = #{confirmYn}
        </if>
        ORDER BY prd_date DESC, result_id DESC
        <if test="pageSize != null and pageNum != null">
            OFFSET (#{pageNum} - 1) * #{pageSize} ROWS
            FETCH NEXT #{pageSize} ROWS ONLY
        </if>
    </select>

    <!-- 생산 실적 관리 전체 건수 조회 -->
    <select id="selectCount" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM unknown_table
        WHERE 1=1
        <if test="prdDateFrom != null and prdDateFrom != ''">
            AND prd_date &gt;= #{prdDateFrom}
        </if>
        <if test="prdDateTo != null and prdDateTo != ''">
            AND prd_date &lt;= #{prdDateTo}
        </if>
        <if test="factoryCd != null and factoryCd != ''">
            AND factory_cd = #{factoryCd}
        </if>
        <if test="lineCd != null and lineCd != ''">
            AND line_cd = #{lineCd}
        </if>
        <if test="shiftCd != null and shiftCd != ''">
            AND shift_cd = #{shiftCd}
        </if>
        <if test="itemCd != null and itemCd != ''">
            AND item_cd LIKE '%' + #{itemCd} + '%'
        </if>
        <if test="itemNm != null and itemNm != ''">
            AND item_nm LIKE '%' + #{itemNm} + '%'
        </if>
        <if test="workerId != null and workerId != ''">
            AND worker_id = #{workerId}
        </if>
        <if test="status != null and status != ''">
            AND status = #{status}
        </if>
        <if test="confirmYn != null and confirmYn != ''">
            AND confirm_yn = #{confirmYn}
        </if>
    </select>

    <!-- 생산 실적 관리 등록 -->
    <insert id="insert" parameterType="map">
        INSERT INTO unknown_table (
            prd_date,
            factory_cd,
            line_cd,
            shift_cd,
            item_cd,
            item_nm,
            spec,
            unit,
            plan_qty,
            prod_qty,
            good_qty,
            defect_qty,
            defect_type,
            defect_reason,
            start_time,
            end_time,
            work_time,
            stop_time,
            worker_id,
            worker_nm,
            team_cd,
            inspect_yn,
            inspect_result,
            inspector_id,
            remark,
            status,
            confirm_yn,
            reg_id,
            reg_dt,
            upd_id,
            upd_dt
        ) VALUES (
            #{prdDate},
            #{factoryCd},
            #{lineCd},
            #{shiftCd},
            #{itemCd},
            #{itemNm},
            #{spec},
            #{unit},
            #{planQty},
            #{prodQty},
            #{goodQty},
            #{defectQty},
            #{defectType},
            #{defectReason},
            #{startTime},
            #{endTime},
            #{workTime},
            #{stopTime},
            #{workerId},
            #{workerNm},
            #{teamCd},
            #{inspectYn},
            #{inspectResult},
            #{inspectorId},
            #{remark},
            #{status},
            #{confirmYn},
            #{regId},
            #{regDt},
            #{updId},
            #{updDt}
        )
    </insert>

    <!-- 생산 실적 관리 수정 -->
    <update id="update" parameterType="map">
        UPDATE unknown_table
        SET
            prd_date = #{prdDate},
            factory_cd = #{factoryCd},
            line_cd = #{lineCd},
            shift_cd = #{shiftCd},
            item_cd = #{itemCd},
            item_nm = #{itemNm},
            spec = #{spec},
            unit = #{unit},
            plan_qty = #{planQty},
            prod_qty = #{prodQty},
            good_qty = #{goodQty},
            defect_qty = #{defectQty},
            defect_type = #{defectType},
            defect_reason = #{defectReason},
            start_time = #{startTime},
            end_time = #{endTime},
            work_time = #{workTime},
            stop_time = #{stopTime},
            worker_id = #{workerId},
            worker_nm = #{workerNm},
            team_cd = #{teamCd},
            inspect_yn = #{inspectYn},
            inspect_result = #{inspectResult},
            inspector_id = #{inspectorId},
            remark = #{remark},
            status = #{status},
            confirm_yn = #{confirmYn},
            reg_id = #{regId},
            reg_dt = #{regDt},
            upd_id = #{updId},
            upd_dt = #{updDt}
        WHERE result_id = #{resultId}
    </update>

    <!-- 생산 실적 관리 삭제 -->
    <delete id="delete" parameterType="map">
        DELETE FROM unknown_table
        WHERE result_id = #{resultId}
    </delete>

    <!-- 생산 실적 관리 확정 -->
    <update id="confirm" parameterType="map">
        UPDATE unknown_table
        SET
            status = 'CONFIRM',
            confirm_yn = 'Y',
            confirm_date = GETDATE(),
            confirm_user = #{userId}
        WHERE result_id = #{resultId}
    </update>

</mapper>
