<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dowinsys.cost.CostManagementMapper">

    <!-- 원가 관리 목록 조회 -->
    <select id="selectList" parameterType="map" resultType="map">
        SELECT
        cost_id,
        factory_cd,
        factory_nm,
        item_cd,
        item_nm,
        item_spec,
        unit,
        cost_type,
        base_year,
        base_month,
        material_cost,
        labor_cost,
        overhead_cost,
        total_cost,
        profit_rate,
        selling_price,
        currency,
        exchange_rate,
        supplier_cd,
        supplier_nm,
        valid_from,
        valid_to,
        status,
        approval_status,
        approval_date,
        approval_user,
        remark,
        create_date,
        create_user,
        update_date,
        update_user
        FROM unknown_table
        WHERE 1=1
        <if test="prdDateFrom != null and prdDateFrom != ''">
            AND prd_date &gt;= #{prdDateFrom}
        </if>
        <if test="prdDateTo != null and prdDateTo != ''">
            AND prd_date &lt;= #{prdDateTo}
        </if>
        <if test="factoryCd != null and factoryCd != ''">
            AND factory_cd = #{factoryCd}
        </if>
        <if test="lineCd != null and lineCd != ''">
            AND line_cd = #{lineCd}
        </if>
        <if test="shiftCd != null and shiftCd != ''">
            AND shift_cd = #{shiftCd}
        </if>
        <if test="itemCd != null and itemCd != ''">
            AND item_cd LIKE '%' + #{itemCd} + '%'
        </if>
        <if test="itemNm != null and itemNm != ''">
            AND item_nm LIKE '%' + #{itemNm} + '%'
        </if>
        <if test="workerId != null and workerId != ''">
            AND worker_id = #{workerId}
        </if>
        <if test="status != null and status != ''">
            AND status = #{status}
        </if>
        <if test="confirmYn != null and confirmYn != ''">
            AND confirm_yn = #{confirmYn}
        </if>
        ORDER BY prd_date DESC, result_id DESC
        <if test="pageSize != null and pageNum != null">
            OFFSET (#{pageNum} - 1) * #{pageSize} ROWS
            FETCH NEXT #{pageSize} ROWS ONLY
        </if>
    </select>

    <!-- 원가 관리 전체 건수 조회 -->
    <select id="selectCount" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM unknown_table
        WHERE 1=1
        <if test="prdDateFrom != null and prdDateFrom != ''">
            AND prd_date &gt;= #{prdDateFrom}
        </if>
        <if test="prdDateTo != null and prdDateTo != ''">
            AND prd_date &lt;= #{prdDateTo}
        </if>
        <if test="factoryCd != null and factoryCd != ''">
            AND factory_cd = #{factoryCd}
        </if>
        <if test="lineCd != null and lineCd != ''">
            AND line_cd = #{lineCd}
        </if>
        <if test="shiftCd != null and shiftCd != ''">
            AND shift_cd = #{shiftCd}
        </if>
        <if test="itemCd != null and itemCd != ''">
            AND item_cd LIKE '%' + #{itemCd} + '%'
        </if>
        <if test="itemNm != null and itemNm != ''">
            AND item_nm LIKE '%' + #{itemNm} + '%'
        </if>
        <if test="workerId != null and workerId != ''">
            AND worker_id = #{workerId}
        </if>
        <if test="status != null and status != ''">
            AND status = #{status}
        </if>
        <if test="confirmYn != null and confirmYn != ''">
            AND confirm_yn = #{confirmYn}
        </if>
    </select>

    <!-- 원가 관리 등록 -->
    <insert id="insert" parameterType="map">
        INSERT INTO unknown_table (
            cost_id,
            factory_cd,
            factory_nm,
            item_cd,
            item_nm,
            item_spec,
            unit,
            cost_type,
            base_year,
            base_month,
            material_cost,
            labor_cost,
            overhead_cost,
            total_cost,
            profit_rate,
            selling_price,
            currency,
            exchange_rate,
            supplier_cd,
            supplier_nm,
            valid_from,
            valid_to,
            status,
            approval_status,
            approval_date,
            approval_user,
            remark,
            create_date,
            create_user,
            update_date,
            update_user
        ) VALUES (
            #{costId},
            #{factoryCd},
            #{factoryNm},
            #{itemCd},
            #{itemNm},
            #{itemSpec},
            #{unit},
            #{costType},
            #{baseYear},
            #{baseMonth},
            #{materialCost},
            #{laborCost},
            #{overheadCost},
            #{totalCost},
            #{profitRate},
            #{sellingPrice},
            #{currency},
            #{exchangeRate},
            #{supplierCd},
            #{supplierNm},
            #{validFrom},
            #{validTo},
            #{status},
            #{approvalStatus},
            #{approvalDate},
            #{approvalUser},
            #{remark},
            #{createDate},
            #{createUser},
            #{updateDate},
            #{updateUser}
        )
    </insert>

    <!-- 원가 관리 수정 -->
    <update id="update" parameterType="map">
        UPDATE unknown_table
        SET
            cost_id = #{costId},
            factory_cd = #{factoryCd},
            factory_nm = #{factoryNm},
            item_cd = #{itemCd},
            item_nm = #{itemNm},
            item_spec = #{itemSpec},
            unit = #{unit},
            cost_type = #{costType},
            base_year = #{baseYear},
            base_month = #{baseMonth},
            material_cost = #{materialCost},
            labor_cost = #{laborCost},
            overhead_cost = #{overheadCost},
            total_cost = #{totalCost},
            profit_rate = #{profitRate},
            selling_price = #{sellingPrice},
            currency = #{currency},
            exchange_rate = #{exchangeRate},
            supplier_cd = #{supplierCd},
            supplier_nm = #{supplierNm},
            valid_from = #{validFrom},
            valid_to = #{validTo},
            status = #{status},
            approval_status = #{approvalStatus},
            approval_date = #{approvalDate},
            approval_user = #{approvalUser},
            remark = #{remark},
            update_date = #{updateDate},
            update_user = #{updateUser}
        WHERE result_id = #{resultId}
    </update>

    <!-- 원가 관리 삭제 -->
    <delete id="delete" parameterType="map">
        DELETE FROM unknown_table
        WHERE result_id = #{resultId}
    </delete>

    <!-- 원가 관리 확정 -->
    <update id="confirm" parameterType="map">
        UPDATE unknown_table
        SET
            status = 'CONFIRM',
            confirm_yn = 'Y',
            confirm_date = GETDATE(),
            confirm_user = #{userId}
        WHERE result_id = #{resultId}
    </update>

</mapper>
