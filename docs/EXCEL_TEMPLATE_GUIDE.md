# Excel 템플릿 작성 가이드

> AI Factory Lab - 화면 생성기용 Excel 템플릿 작성 규칙

## 📋 개요

화면 생성기는 사용자가 작성한 Excel 템플릿을 분석하여 자동으로 화면(Grid, Form)을 생성합니다.
이 문서는 Excel 템플릿 작성 시 지켜야 할 규칙과 주의사항을 설명합니다.

---

## 📁 필수 시트 구성

템플릿 Excel 파일은 다음 4개 시트로 구성됩니다:

| 시트명 | 필수여부 | 설명 |
|--------|----------|------|
| `메타정보` | ✅ 필수 | 화면 기본 정보 (화면명, 설명 등) |
| `조회조건` | ✅ 필수 | 검색/필터 조건 정의 |
| `그리드컬럼` | ✅ 필수 | 그리드 헤더 및 컬럼 구조 (핵심!) |
| `샘플데이터` | 선택 | 미리보기용 예시 데이터 |

---

## 📝 시트별 작성 규칙

### 1. 메타정보 시트

| A열 (항목) | B열 (값) | 비고 |
|------------|----------|------|
| 화면정의서 | | 고정 텍스트 |
| 화면명 | 자재수불부 | **필수** |
| 화면명(영문) | Material Inventory Ledger | 선택 |
| 테이블명 | TB_INV_MATERIAL_LEDGER | **권장** - 쿼리 생성 시 사용 |
| 설명 | 자재의 입출고 현황... | 선택 |
| 버전 | 1.0.0 | 선택 |

> **📌 참고:**
> - `화면ID(screenCode)`는 사용자가 입력하지 않습니다.
> - 화면ID는 미리보기 확인 후 **메뉴 위치 결정 시 자동 생성**됩니다.
> - `테이블명`을 입력하면 AI가 해당 테이블 기준으로 쿼리를 생성합니다.

---

### 2. 조회조건 시트

**Row 1**: 제목 행 (무시됨)
**Row 2**: 헤더 행

| ID | 라벨 | 타입 | 필수여부 | 기본값 | 비고 |
|----|------|------|----------|--------|------|
| yyyymm | 년월 | select | Y | currentMonth | 조회 기간 |
| matcode | 자재코드 | select | N | | 전체/원재료/부재료 |

**지원 타입:**
- `text`: 텍스트 입력
- `select`: 드롭다운 선택
- `date`: 날짜 선택
- `dateRange`: 기간 선택 (시작~종료)
- `number`: 숫자 입력
- `checkbox`: 체크박스

---

### 3. 그리드컬럼 시트 ⭐ (가장 중요!)

실제 사용하는 Excel 양식 그대로 입력합니다. 파서가 셀 병합 구조를 분석하여 자동 해석합니다.

#### 기본 구조

```
┌─────────────────────────────────────────────────────────────────────┐
│ Row 1: [화면제목]                              [단위정보]            │
├─────────────────────────────────────────────────────────────────────┤
│ Row 2: [1차 헤더] - 그룹 헤더 (병합 셀)                              │
├─────────────────────────────────────────────────────────────────────┤
│ Row 3: [2차 헤더] - 상세 컬럼명                                      │
├─────────────────────────────────────────────────────────────────────┤
│ Row 4~: [합계행] 또는 [데이터행]                                     │
└─────────────────────────────────────────────────────────────────────┘
```

#### ⚠️ 중요 규칙

##### 규칙 1: 단일 컬럼은 Row 2~3 세로 병합

그룹이 없는 독립 컬럼(자재구분, 품번, 품명 등)은 **Row 2와 Row 3을 세로 병합**합니다.

```
     A열        B열        C열
┌──────────┬──────────┬──────────┐
│ 자재구분  │   품번   │   품명   │  ← Row 2
│  (병합)   │  (병합)  │  (병합)  │  ← Row 3 (병합됨)
└──────────┴──────────┴──────────┘
```

##### 규칙 2: 그룹 헤더는 Row 2에서 가로 병합

여러 컬럼을 묶는 그룹 헤더는 **Row 2에서 가로 병합**합니다.

```
        G열      H열      I열
┌────────────────────────────────┐
│           기초                 │  ← Row 2 (가로 병합)
├──────────┬─────────┬───────────┤
│ 기초수량  │ 기초금액 │ 기초단가  │  ← Row 3 (개별 컬럼)
└──────────┴─────────┴───────────┘
```

##### 규칙 3: 그룹명과 상세 컬럼명은 달라야 함 ❌

**잘못된 예:**
```
│     출고수량      │  ← Row 2 그룹명
├───────┬──────────┤
│출고수량│ 출고금액  │  ← Row 3 (그룹명과 동일! ❌)
```

**올바른 예:**
```
│       출고        │  ← Row 2 그룹명
├───────┬──────────┤
│출고수량│ 출고금액  │  ← Row 3 (그룹명과 다름 ✅)
```

> 💡 **이유**: 파서가 그룹 헤더와 상세 헤더를 구분할 때, 
> 동일한 이름이 있으면 단일 컬럼으로 오인할 수 있습니다.

##### 규칙 4: 상세 컬럼명 중복 금지 ❌

같은 그룹 내에서도 컬럼명이 중복되면 안 됩니다.

**잘못된 예:**
```
│       재고        │
├───────┬──────────┬─────────┐
│재고수량│ 재고수량  │ 재고단가 │  ← "재고수량" 중복! ❌
```

**올바른 예:**
```
│       재고        │
├───────┬──────────┬─────────┐
│재고수량│ 재고금액  │ 재고단가 │  ← 모두 다름 ✅
```

##### 규칙 5: 합계 행 표시

합계 행은 첫 번째 셀에 "합계"가 포함되어야 합니다.

```
│ 원재료 합계 │   │   │ ... │  ← "합계" 포함 ✅
│ 부재료 합계 │   │   │ ... │
│ 소모품 합계 │   │   │ ... │
```

---

## 🔄 필드명 자동 변환 규칙

파서는 한글 헤더를 영문 필드명으로 자동 변환합니다.

### 단일 컬럼 변환

| 한글 헤더 | 영문 필드명 |
|-----------|-------------|
| 자재구분 | materialType |
| 품번 | itemCode |
| 품명 | itemName |
| 대분류 | categoryL |
| 중분류 | categoryM |
| 규격 | spec |

### 그룹 컬럼 변환

| 그룹 | 상세 | 영문 필드명 |
|------|------|-------------|
| 기초 | 수량 | openQty |
| 기초 | 금액 | openAmt |
| 기초 | 단가 | openPrice |
| 입고 | 수량 | inQty |
| 입고 | 금액 | inAmt |
| 입고 | 단가 | inPrice |
| 입고 | 기타수량 | inEtcQty |
| 입고 | 기타금액 | inEtcAmt |
| 출고 | 수량 | outQty |
| 출고 | 금액 | outAmt |
| 출고 | 기타수량 | outEtcQty |
| 재고 | 수량 | closeQty |
| 재고 | 금액 | closeAmt |
| 재고 | 단가 | closePrice |

---

## 📊 타입 자동 추론

헤더명에 따라 컬럼 타입이 자동 결정됩니다.

| 헤더에 포함된 키워드 | 추론 타입 | 정렬 |
|---------------------|-----------|------|
| 금액, 단가, 원가 | currency | 우측 |
| 수량, 량, 개수 | number | 우측 |
| 일자, 날짜, 일시 | date | 중앙 |
| 그 외 | text | 좌측 |

---

## ✅ 체크리스트

템플릿 작성 완료 후 확인하세요:

- [ ] 메타정보 시트에 화면명이 입력되어 있는가?
- [ ] 조회조건 시트에 필수 조건이 정의되어 있는가?
- [ ] 그리드컬럼 시트의 단일 컬럼이 세로 병합되어 있는가?
- [ ] 그리드컬럼 시트의 그룹 헤더가 가로 병합되어 있는가?
- [ ] 그룹명과 상세 컬럼명이 동일하지 않은가?
- [ ] 상세 컬럼명에 중복이 없는가?
- [ ] 합계 행에 "합계" 텍스트가 포함되어 있는가?

---

## 📂 예시 템플릿

참고용 예시 파일:
- `data/sample_excel/SC004_자재수불부_템플릿.xlsx`

---

## 🔧 문제 해결

### Q: 컬럼이 인식되지 않아요
A: 셀 병합이 올바르게 되어있는지 확인하세요. 단일 컬럼은 세로 병합, 그룹은 가로 병합입니다.

### Q: 필드명이 이상하게 생성돼요
A: 그룹명과 상세 컬럼명이 동일한지 확인하세요. 동일하면 단일 컬럼으로 오인됩니다.

### Q: 그룹 구조가 제대로 안 나와요
A: Row 2의 그룹 헤더가 해당 컬럼들을 가로로 병합했는지 확인하세요.

---

*최종 수정: 2025-12-06*
*버전: 1.0.0*
